<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mission Control ‚Äî Dwayne</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{
--bg:#070d14;--surface:#0c1520;--surface2:#111d2b;--surface3:#172536;
--border:#1e2d3d;--border-hover:#2a3d52;--text:#e4e4e8;--text2:#7a8ba0;
--accent:#0D1B2A;--accent-light:#1a3050;
--yellow:#f0c040;--green:#40c080;--blue:#4080f0;--red:#f04060;--purple:#a060f0;
--radius:12px;
--glass:rgba(12,21,32,.6);--glass-border:rgba(255,255,255,.06);
}
body{font-family:'Inter',system-ui,sans-serif;background:var(--bg);color:var(--text);height:100dvh;overflow:hidden;display:flex;position:relative}
body::after{content:'';position:fixed;inset:0;pointer-events:none;z-index:0;opacity:.03;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E")}
a{color:var(--blue);text-decoration:none}
::-webkit-scrollbar{width:6px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:var(--surface3);border-radius:3px}::-webkit-scrollbar-thumb:hover{background:var(--border)}

/* Sidebar */
.sidebar{width:240px;background:var(--glass);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border-right:1px solid var(--glass-border);display:flex;flex-direction:column;flex-shrink:0;height:100vh;z-index:2}
.sidebar-logo{padding:20px;border-bottom:1px solid var(--glass-border)}
.sidebar-logo .title{font-size:11px;font-weight:700;letter-spacing:3px;color:var(--blue);text-transform:uppercase}
.sidebar-logo .sub{display:block;font-size:13px;font-weight:600;color:var(--text);margin-top:4px}
.nav{flex:1;padding:8px 12px;overflow-y:auto}
.nav-item{display:flex;align-items:center;gap:10px;padding:9px 14px;border-radius:8px;cursor:pointer;color:var(--text2);font-size:13px;font-weight:500;transition:all .2s cubic-bezier(.4,0,.2,1);position:relative}
.nav-item:hover{background:rgba(255,255,255,.04);color:var(--text)}
.nav-item.active{background:rgba(64,128,240,.12);color:#fff}
.nav-item.active::before{content:'';position:absolute;left:-12px;top:50%;transform:translateY(-50%);width:3px;height:18px;background:var(--blue);border-radius:0 3px 3px 0}
.nav-item svg{width:16px;height:16px;opacity:.5;flex-shrink:0}.nav-item.active svg{opacity:1}
.nav-badge{position:absolute;right:10px;font-size:10px;font-weight:700;background:rgba(64,128,240,.15);color:var(--blue);padding:2px 7px;border-radius:10px;min-width:20px;text-align:center}
.nav-item.active .nav-badge{background:rgba(255,255,255,.15);color:#fff}
.sidebar-footer{padding:14px;border-top:1px solid var(--glass-border)}
.btn-logout{width:100%;padding:8px;background:transparent;border:1px solid var(--glass-border);border-radius:6px;color:var(--text2);font-size:12px;cursor:pointer;font-family:inherit;transition:all .15s}
.btn-logout:hover{background:rgba(255,255,255,.04);color:var(--text)}

/* Main */
.main{flex:1;overflow-y:auto;-webkit-overflow-scrolling:touch;padding:32px 40px;position:relative;z-index:1;min-height:0}
.section{display:none;animation:fadeIn .4s cubic-bezier(.4,0,.2,1)}.section.active{display:block}
@keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
@keyframes cardIn{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}

/* Login */
#login{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;z-index:100;background:linear-gradient(-45deg,#0a0a0f,#0d1520,#0a1228,#0f0a1a);background-size:400% 400%;animation:grad 15s ease infinite}
#login.hidden{display:none}
@keyframes grad{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
.login-box{background:rgba(12,21,32,.7);backdrop-filter:blur(24px);-webkit-backdrop-filter:blur(24px);border:1px solid var(--glass-border);border-radius:16px;padding:48px;width:360px;text-align:center;animation:loginIn .6s cubic-bezier(.4,0,.2,1)}
@keyframes loginIn{from{opacity:0;transform:translateY(20px) scale(.96)}to{opacity:1;transform:translateY(0) scale(1)}}
.login-box h1{font-size:20px;margin-bottom:4px;font-weight:700}
.login-box .login-sub{font-size:11px;font-weight:600;letter-spacing:2px;color:var(--blue);text-transform:uppercase;margin-bottom:24px}
.login-box input{width:100%;padding:12px 16px;background:var(--surface2);border:1px solid var(--border);border-radius:8px;color:var(--text);font-size:14px;font-family:inherit;outline:none;transition:all .3s}
.login-box input:focus{border-color:var(--blue);box-shadow:0 0 0 3px rgba(64,128,240,.15)}
.login-box button{width:100%;padding:12px;margin-top:12px;background:var(--blue);border:none;border-radius:8px;color:#fff;font-size:14px;font-weight:600;cursor:pointer;font-family:inherit;transition:all .15s}
.login-box button:hover{background:#5090ff}
.login-box button:active{transform:scale(.97)}
.login-error{color:var(--red);font-size:12px;margin-top:8px;display:none}

/* Glass card base */
.glass-card{background:var(--glass);backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px);border:1px solid var(--glass-border);border-radius:var(--radius);transition:all .25s cubic-bezier(.4,0,.2,1)}
.glass-card:hover{border-color:var(--border-hover);box-shadow:0 4px 24px rgba(0,0,0,.2),inset 0 1px 0 rgba(255,255,255,.03)}

/* Page */
.page-title{font-size:24px;font-weight:700;margin-bottom:4px;letter-spacing:-.02em}
.page-sub{color:var(--text2);font-size:14px;margin-bottom:28px}
.clock{font-size:13px;color:var(--text2);margin-bottom:24px;font-variant-numeric:tabular-nums}

/* Mission */
.mission-statement{background:linear-gradient(135deg,rgba(10,22,40,.8),rgba(22,40,64,.6),rgba(26,48,80,.5));backdrop-filter:blur(12px);border:1px solid var(--glass-border);border-radius:var(--radius);padding:28px;margin-bottom:28px;position:relative;overflow:hidden}
.mission-statement::before{content:'';position:absolute;top:-50%;right:-50%;width:200%;height:200%;background:radial-gradient(circle at 70% 30%,rgba(64,128,240,.08),transparent 60%);pointer-events:none}
.mission-statement h2{font-size:11px;color:var(--text2);font-weight:600;margin-bottom:8px;text-transform:uppercase;letter-spacing:2px}
.mission-statement p{font-size:18px;font-weight:500;line-height:1.6;position:relative}
.mission-statement .tag{display:inline-block;margin-top:12px;font-size:12px;color:var(--blue);font-weight:600;padding:4px 12px;background:rgba(64,128,240,.1);border-radius:20px;border:1px solid rgba(64,128,240,.15)}

/* Stats */
.stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:14px;margin-bottom:28px}
.stat-card{background:var(--glass);backdrop-filter:blur(12px);border:1px solid var(--glass-border);border-radius:var(--radius);padding:20px;position:relative;overflow:hidden;opacity:0;animation:cardIn .5s cubic-bezier(.4,0,.2,1) forwards;transition:all .25s cubic-bezier(.4,0,.2,1)}
.stat-card:nth-child(1){animation-delay:.05s}.stat-card:nth-child(2){animation-delay:.1s}.stat-card:nth-child(3){animation-delay:.15s}.stat-card:nth-child(4){animation-delay:.2s}.stat-card:nth-child(5){animation-delay:.25s}
.stat-card:hover{border-color:var(--border-hover);transform:translateY(-2px);box-shadow:0 8px 24px rgba(0,0,0,.2)}
.stat-card::before{content:'';position:absolute;left:0;top:0;bottom:0;width:3px;border-radius:3px 0 0 3px}
.stat-card:nth-child(1)::before{background:linear-gradient(180deg,var(--yellow),rgba(240,192,64,.2))}.stat-card:nth-child(2)::before{background:linear-gradient(180deg,var(--green),rgba(64,192,128,.2))}.stat-card:nth-child(3)::before{background:linear-gradient(180deg,var(--blue),rgba(64,128,240,.2))}.stat-card:nth-child(4)::before{background:linear-gradient(180deg,var(--purple),rgba(160,96,240,.2))}.stat-card:nth-child(5)::before{background:linear-gradient(180deg,var(--red),rgba(240,64,96,.2))}
.stat-card .label{font-size:11px;color:var(--text2);text-transform:uppercase;letter-spacing:1px;margin-bottom:8px;font-weight:500}
.stat-card .value{font-size:28px;font-weight:700}

/* Filter/Search */
.filter-bar{display:flex;align-items:center;gap:12px;margin-bottom:20px;flex-wrap:wrap}
.search-input{padding:9px 14px 9px 36px;background:var(--surface);border:1px solid var(--border);border-radius:8px;color:var(--text);font-size:13px;font-family:inherit;outline:none;width:260px;transition:all .25s}
.search-input:focus{border-color:var(--blue);box-shadow:0 0 0 3px rgba(64,128,240,.1)}
.search-wrap{position:relative}.search-wrap svg{position:absolute;left:11px;top:50%;transform:translateY(-50%);width:16px;height:16px;color:var(--text2);pointer-events:none}
.filter-chip{padding:6px 14px;background:var(--surface);border:1px solid var(--border);border-radius:20px;color:var(--text2);font-size:12px;font-weight:600;cursor:pointer;transition:all .2s;user-select:none}
.filter-chip:hover{background:var(--surface2);color:var(--text)}.filter-chip:active{transform:scale(.95)}.filter-chip.active{background:rgba(64,128,240,.15);color:var(--blue);border-color:rgba(64,128,240,.3)}

/* Tasks */
.task-section-title{font-size:12px;font-weight:600;text-transform:uppercase;letter-spacing:1.5px;color:var(--text2);margin:24px 0 12px;padding-bottom:8px;border-bottom:1px solid var(--border)}.task-section-title:first-child{margin-top:0}
.task{background:var(--glass);backdrop-filter:blur(8px);border:1px solid var(--glass-border);border-radius:8px;padding:14px 18px;margin-bottom:8px;transition:all .25s cubic-bezier(.4,0,.2,1);opacity:0;animation:cardIn .4s cubic-bezier(.4,0,.2,1) forwards}
.task:hover{border-color:var(--border-hover);transform:translateY(-2px);box-shadow:0 4px 16px rgba(0,0,0,.2)}
.task-row{display:flex;align-items:center;gap:12px}
.task.completed-local .task-name{text-decoration:line-through;opacity:.5}
.badge{font-size:11px;font-weight:600;padding:3px 10px;border-radius:20px;text-transform:uppercase;letter-spacing:.5px;flex-shrink:0}
.badge.high{background:rgba(240,64,96,.15);color:var(--red)}.badge.medium{background:rgba(240,192,64,.15);color:var(--yellow)}.badge.low{background:rgba(64,128,240,.15);color:var(--blue)}
.badge.in-progress{background:rgba(240,192,64,.15);color:var(--yellow)}.badge.completed{background:rgba(64,192,128,.15);color:var(--green)}.badge.waiting{background:rgba(64,128,240,.15);color:var(--blue)}.badge.blocked{background:rgba(240,64,96,.15);color:var(--red)}.badge.todo{background:rgba(152,152,176,.12);color:var(--text2)}
.task-name{font-size:14px;font-weight:500;flex:1;min-width:0}
.task-cat{font-size:11px;color:var(--text2);margin-left:4px}
.task-due{font-size:11px;color:var(--text2);white-space:nowrap}
.task-actions{display:flex;align-items:center;gap:6px;flex-shrink:0}
.task-btn{padding:4px 10px;background:var(--surface2);border:1px solid var(--border);border-radius:6px;color:var(--text2);font-size:11px;font-weight:600;cursor:pointer;font-family:inherit;transition:all .15s;white-space:nowrap}
.task-btn:hover{background:var(--surface3);color:var(--text)}.task-btn:active{transform:scale(.9)}
.task-btn.done{border-color:rgba(64,192,128,.3);color:var(--green)}.task-btn.done:hover{background:rgba(64,192,128,.15)}
.task-btn.done.is-done{background:rgba(64,192,128,.15);color:var(--green)}
.task-note-input{width:100%;padding:8px 12px;background:var(--surface2);border:1px solid var(--border);border-radius:6px;color:var(--text);font-size:12px;font-family:inherit;outline:none;resize:none;margin-top:8px;display:none}
.task-note{margin-top:8px;padding:8px 12px;background:var(--surface2);border-radius:6px;font-size:12px;color:var(--text2);line-height:1.5}

/* Avatars */
.avatar{width:26px;height:26px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:10px;font-weight:700;flex-shrink:0;color:#fff;letter-spacing:.5px;cursor:pointer;transition:transform .2s}
.avatar:hover{transform:scale(1.15)}
.avatar.unassigned{background:var(--surface3);color:var(--text2);border:1px dashed var(--border)}
.assign-pos{position:relative}
.assign-dropdown{position:absolute;top:100%;right:0;background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:6px;min-width:160px;z-index:20;box-shadow:0 8px 24px rgba(0,0,0,.4);display:none;animation:dropIn .15s ease}
.assign-dropdown.open{display:block}
@keyframes dropIn{from{opacity:0;transform:translateY(-4px)}to{opacity:1;transform:translateY(0)}}
.assign-option{display:flex;align-items:center;gap:8px;padding:6px 10px;border-radius:6px;cursor:pointer;font-size:13px;color:var(--text2);transition:background .1s}
.assign-option:hover{background:var(--surface2);color:var(--text)}

/* Activity Feed */
.feed-item{background:var(--glass);backdrop-filter:blur(8px);border:1px solid var(--glass-border);border-radius:var(--radius);padding:20px;margin-bottom:12px;transition:all .25s;opacity:0;animation:cardIn .5s cubic-bezier(.4,0,.2,1) forwards}
.feed-item:nth-child(1){animation-delay:.05s}.feed-item:nth-child(2){animation-delay:.1s}.feed-item:nth-child(3){animation-delay:.15s}
.feed-item:hover{border-color:var(--border-hover)}
.feed-item .feed-date{font-size:12px;color:var(--blue);margin-bottom:8px;font-weight:600;letter-spacing:.5px}
.feed-item .feed-content{font-size:14px;line-height:1.7}

/* Documents */
.doc-card{background:var(--glass);backdrop-filter:blur(8px);border:1px solid var(--glass-border);border-radius:var(--radius);padding:16px 20px;margin-bottom:8px;display:flex;align-items:center;gap:14px;transition:all .25s;opacity:0;animation:cardIn .4s cubic-bezier(.4,0,.2,1) forwards;cursor:default}
.doc-card:hover{border-color:var(--border-hover);transform:translateY(-1px)}
.doc-icon{width:36px;height:36px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:16px;flex-shrink:0}
.doc-icon.pdf{background:rgba(240,64,96,.12)}.doc-icon.md{background:rgba(64,128,240,.12)}
.doc-title{font-size:14px;font-weight:500;flex:1}.doc-cat{font-size:11px;color:var(--text2)}.doc-date{font-size:11px;color:var(--text2)}

/* Agents */
.agents-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:16px}
.agent-card{background:var(--glass);backdrop-filter:blur(12px);border:1px solid var(--glass-border);border-radius:var(--radius);padding:24px;transition:all .25s cubic-bezier(.4,0,.2,1);opacity:0;animation:cardIn .5s cubic-bezier(.4,0,.2,1) forwards}
.agent-card:nth-child(1){animation-delay:.05s}.agent-card:nth-child(2){animation-delay:.1s}.agent-card:nth-child(3){animation-delay:.15s}
.agent-card:hover{border-color:var(--border-hover);transform:translateY(-3px);box-shadow:0 8px 24px rgba(0,0,0,.2)}
.agent-card .agent-name{font-size:18px;font-weight:700;margin-bottom:4px}
.agent-card .agent-role{font-size:13px;color:var(--text2);margin-bottom:14px}
.agent-card .agent-desc{font-size:14px;line-height:1.6}
.agent-status{display:inline-block;font-size:11px;font-weight:600;padding:3px 10px;border-radius:20px;margin-bottom:12px;letter-spacing:.5px;text-transform:uppercase}
.agent-status.active{background:rgba(64,192,128,.15);color:var(--green);box-shadow:0 0 12px rgba(64,192,128,.1)}
.agent-status.standby{background:rgba(64,128,240,.15);color:var(--blue)}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}
.agent-status.active::before{content:'';display:inline-block;width:6px;height:6px;border-radius:50%;background:var(--green);margin-right:6px;animation:pulse 2s ease-in-out infinite}
.agent-status.standby::before{content:'';display:inline-block;width:6px;height:6px;border-radius:50%;background:var(--blue);margin-right:6px}

/* Business Cards */
.biz-card{background:var(--glass);backdrop-filter:blur(12px);border:1px solid var(--glass-border);border-radius:var(--radius);padding:24px;margin-bottom:16px;transition:all .25s;cursor:pointer;text-decoration:none;display:block;color:var(--text);opacity:0;animation:cardIn .5s cubic-bezier(.4,0,.2,1) forwards}
.biz-card:hover{border-color:var(--border-hover);transform:translateY(-3px);box-shadow:0 8px 24px rgba(0,0,0,.2)}
.biz-card h3{font-size:18px;font-weight:700;margin-bottom:6px}.biz-card p{font-size:14px;color:var(--text2);line-height:1.6}
.biz-card .biz-link{font-size:12px;color:var(--blue);margin-top:10px;display:inline-block}

/* Health */
.health-bar{height:6px;border-radius:3px;background:var(--surface3);margin:4px 0 8px;overflow:hidden}
.health-bar-fill{height:100%;border-radius:3px;transition:width .6s ease}

/* Travel */
.travel-card{background:var(--glass);backdrop-filter:blur(12px);border:1px solid var(--glass-border);border-radius:var(--radius);padding:0;margin-bottom:16px;overflow:hidden;transition:all .25s;opacity:0;animation:cardIn .5s cubic-bezier(.4,0,.2,1) forwards}
.travel-card:hover{border-color:var(--border-hover)}
.travel-card-header{padding:20px 24px;display:flex;align-items:center;justify-content:space-between;cursor:pointer;user-select:none}
.travel-card-header:hover{background:rgba(255,255,255,.02)}
.travel-dest{font-size:17px;font-weight:700}.travel-dates{font-size:13px;color:var(--text2);margin-top:2px}
.travel-badge{display:inline-block;font-size:11px;font-weight:700;padding:3px 10px;border-radius:12px;text-transform:uppercase;letter-spacing:.5px}
.travel-badge.business{background:rgba(64,128,240,.15);color:var(--blue)}.travel-badge.personal{background:rgba(160,96,240,.15);color:var(--purple)}.travel-badge.mixed{background:rgba(240,192,64,.15);color:var(--yellow)}
.travel-status{font-size:11px;font-weight:600;padding:3px 10px;border-radius:12px;margin-left:8px}
.travel-status.upcoming{background:rgba(64,128,240,.12);color:var(--blue)}.travel-status.in-progress{background:rgba(64,192,128,.12);color:var(--green)}.travel-status.completed{background:rgba(152,152,176,.12);color:var(--text2)}
.travel-details{display:none;padding:0 24px 20px;border-top:1px solid var(--glass-border)}.travel-details.open{display:block}
.travel-section{margin-top:16px}
.travel-section-title{font-size:12px;font-weight:600;color:var(--text2);text-transform:uppercase;letter-spacing:1px;margin-bottom:8px}
.flight-route{display:flex;align-items:center;gap:12px;padding:12px 16px;background:var(--surface2);border-radius:8px;margin-bottom:8px}
.flight-airport{font-size:20px;font-weight:700;letter-spacing:1px}
.flight-arrow{flex:1;display:flex;flex-direction:column;align-items:center;gap:2px}
.flight-arrow .line{width:100%;height:1px;background:var(--border);position:relative}
.flight-arrow .line::after{content:'‚úà';position:absolute;right:-4px;top:-9px;font-size:14px}
.flight-arrow .flight-num{font-size:11px;color:var(--text2);font-weight:600}
.flight-time{font-size:12px;color:var(--text2)}
.flight-conf{font-size:11px;color:var(--blue);font-weight:600;margin-top:2px}
.hotel-card{padding:12px 16px;background:var(--surface2);border-radius:8px;margin-bottom:8px}
.hotel-name{font-size:14px;font-weight:600}.hotel-detail{font-size:12px;color:var(--text2);margin-top:4px}
.itin-day{padding:10px 16px;background:var(--surface2);border-radius:8px;margin-bottom:8px}
.itin-date{font-size:12px;font-weight:600;color:var(--blue);margin-bottom:6px}
.itin-item{font-size:13px;color:var(--text);padding:2px 0}
.travel-notes{padding:12px 16px;background:var(--surface2);border-radius:8px;font-size:13px;color:var(--text);line-height:1.6}

/* Reading */
.reading-item{background:var(--glass);backdrop-filter:blur(8px);border:1px solid var(--glass-border);border-radius:var(--radius);padding:16px 20px;margin-bottom:10px;display:flex;align-items:center;gap:14px;transition:all .25s;opacity:0;animation:cardIn .4s cubic-bezier(.4,0,.2,1) forwards}
.reading-item:hover{border-color:var(--border-hover)}
.reading-status{font-size:10px;font-weight:700;padding:3px 8px;border-radius:10px;text-transform:uppercase;letter-spacing:.5px;flex-shrink:0}
.reading-status.reading{background:rgba(64,192,128,.15);color:var(--green)}.reading-status.queued{background:rgba(152,152,176,.12);color:var(--text2)}.reading-status.completed{background:rgba(64,128,240,.15);color:var(--blue)}

/* Ski */
.ski-session{background:var(--glass);backdrop-filter:blur(8px);border:1px solid var(--glass-border);border-radius:8px;padding:14px 18px;margin-bottom:8px;transition:all .25s;opacity:0;animation:cardIn .4s cubic-bezier(.4,0,.2,1) forwards}
.ski-session:hover{border-color:var(--border-hover)}

/* Calls */
.call-item{background:var(--glass);backdrop-filter:blur(8px);border:1px solid var(--glass-border);border-radius:var(--radius);padding:20px;margin-bottom:12px;transition:all .25s}
.call-item:hover{border-color:var(--border-hover)}
.call-header{display:flex;align-items:center;gap:10px;margin-bottom:10px;flex-wrap:wrap}
.call-title{font-size:15px;font-weight:600;flex:1;min-width:200px}
.call-date{font-size:12px;color:var(--text2)}
.call-badge{font-size:11px;font-weight:600;padding:3px 10px;border-radius:20px;text-transform:uppercase;letter-spacing:.5px}
.call-badge.cellars{background:rgba(240,192,64,.15);color:var(--yellow)}.call-badge.solveworks{background:rgba(64,128,240,.15);color:var(--blue)}.call-badge.unknown{background:var(--surface3);color:var(--text2)}
.call-takeaways{list-style:none;padding:0}.call-takeaways li{padding:4px 0 4px 16px;position:relative;font-size:13px;line-height:1.6}.call-takeaways li::before{content:'‚Üí';position:absolute;left:0;color:var(--text2)}
.call-expand{font-size:12px;color:var(--blue);cursor:pointer;margin-top:8px;font-weight:500}.call-expand:hover{text-decoration:underline}
.call-full{display:none;margin-top:12px;padding:16px;background:var(--surface2);border-radius:8px;font-size:13px;line-height:1.7}.call-full.open{display:block}

/* Security */
.security-card{background:var(--glass);backdrop-filter:blur(12px);border:1px solid var(--glass-border);border-radius:var(--radius);padding:20px;margin-bottom:12px;transition:all .25s}
.security-card:hover{border-color:var(--border-hover)}
.security-status-badge{display:inline-block;font-size:12px;font-weight:600;padding:4px 12px;border-radius:20px;margin-bottom:12px;letter-spacing:.5px}
.security-status-badge.ok{background:rgba(64,192,128,.15);color:var(--green);box-shadow:0 0 12px rgba(64,192,128,.1)}
.security-status-badge.warn{background:rgba(240,192,64,.15);color:var(--yellow)}.security-status-badge.alert{background:rgba(240,64,96,.15);color:var(--red)}

/* Sync footer */
.sync-footer{position:fixed;bottom:0;left:240px;right:0;padding:8px 20px;background:var(--glass);backdrop-filter:blur(12px);border-top:1px solid var(--glass-border);font-size:11px;color:var(--text2);display:flex;align-items:center;gap:8px;z-index:10}
.sync-dot{width:6px;height:6px;border-radius:50%;flex-shrink:0}.sync-dot.fresh{background:var(--green);animation:syncPulse 2s ease-in-out infinite}.sync-dot.stale{background:var(--yellow)}.sync-dot.old{background:var(--red)}
@keyframes syncPulse{0%,100%{opacity:1;transform:scale(1)}50%{opacity:.7;transform:scale(1.3)}}

/* Empty */
.empty-state{text-align:center;padding:60px 20px;color:var(--text2)}.empty-state .empty-icon{font-size:36px;opacity:.3;margin-bottom:12px}.empty-state .empty-title{font-size:16px;font-weight:600;color:var(--text);opacity:.5;margin-bottom:8px}.empty-state p{font-size:14px;line-height:1.6}

/* Toast */
.toast{position:fixed;bottom:60px;left:50%;transform:translateX(-50%) translateY(20px);background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:10px 20px;font-size:13px;box-shadow:0 8px 24px rgba(0,0,0,.4);opacity:0;transition:all .4s cubic-bezier(.175,.885,.32,1.275);z-index:60;pointer-events:none;white-space:nowrap}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0)}

/* FAB */
.fab{position:fixed;bottom:28px;right:28px;width:52px;height:52px;border-radius:50%;background:var(--blue);color:#fff;border:none;font-size:24px;cursor:pointer;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 16px rgba(64,128,240,.4);z-index:30;transition:all .2s;font-family:inherit}
.fab:hover{transform:scale(1.1);box-shadow:0 6px 24px rgba(64,128,240,.5)}.fab:active{transform:scale(.95)}

/* Modal */
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.6);backdrop-filter:blur(4px);z-index:50;display:flex;align-items:center;justify-content:center;opacity:0;pointer-events:none;transition:opacity .25s}
.modal-overlay.open{opacity:1;pointer-events:auto}
.modal{background:var(--surface);border:1px solid var(--border);border-radius:16px;padding:32px;width:480px;max-width:90vw;max-height:85vh;overflow-y:auto;transform:translateY(20px) scale(.96);transition:all .3s cubic-bezier(.4,0,.2,1)}
.modal-overlay.open .modal{transform:translateY(0) scale(1)}
.modal h2{font-size:18px;font-weight:700;margin-bottom:20px}
.modal label{display:block;font-size:11px;font-weight:500;color:var(--text2);text-transform:uppercase;letter-spacing:1px;margin-bottom:6px;margin-top:16px}.modal label:first-of-type{margin-top:0}
.modal input[type="text"],.modal textarea,.modal select{width:100%;padding:10px 14px;background:var(--surface2);border:1px solid var(--border);border-radius:8px;color:var(--text);font-size:14px;font-family:inherit;outline:none}
.modal textarea{resize:vertical;min-height:60px}
.modal-actions{display:flex;gap:10px;margin-top:24px;justify-content:flex-end}
.modal-btn{padding:10px 20px;border-radius:8px;font-size:14px;font-weight:600;cursor:pointer;font-family:inherit;border:none;transition:all .15s}
.modal-btn.primary{background:var(--blue);color:#fff}.modal-btn.primary:hover{background:#5090ff}
.modal-btn.secondary{background:var(--surface2);color:var(--text2);border:1px solid var(--border)}.modal-btn.secondary:hover{background:var(--surface3);color:var(--text)}

/* Mobile */
.menu-toggle{display:none;position:fixed;top:12px;left:12px;z-index:50;background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:8px 12px;color:var(--text);cursor:pointer;font-size:18px}
.mobile-tabs{display:none;position:fixed;bottom:0;left:0;right:0;background:var(--glass);backdrop-filter:blur(20px);border-top:1px solid var(--glass-border);z-index:40;padding:4px 0;padding-bottom:env(safe-area-inset-bottom,4px)}
.mobile-tabs-inner{display:flex;justify-content:space-around;align-items:center}
.mobile-tab{display:flex;flex-direction:column;align-items:center;gap:2px;padding:6px 8px;border-radius:8px;cursor:pointer;color:var(--text2);font-size:10px;font-weight:500;transition:all .2s;border:none;background:none;font-family:inherit;flex:1}
.mobile-tab svg{width:20px;height:20px}.mobile-tab.active{color:var(--blue)}.mobile-tab:active{transform:scale(.9)}
@media(max-width:1024px){
  body{height:auto;overflow:auto;display:block;-webkit-overflow-scrolling:touch}
  .sidebar{position:fixed;left:-260px;top:0;height:100%;z-index:40;transition:left .3s cubic-bezier(.4,0,.2,1)}
  .sidebar.open{left:0}
  .menu-toggle{display:block}
  .mobile-tabs{display:block}
  .main{padding:20px 16px;padding-top:56px;padding-bottom:72px;overflow:visible;height:auto;min-height:auto}
  .section.active{display:block;overflow:visible}
  .stats-grid{grid-template-columns:1fr 1fr}.agents-grid{grid-template-columns:1fr}
  .sync-footer{display:none}.fab{bottom:80px;right:16px}
  .filter-bar{flex-direction:column;align-items:stretch}.search-input{width:100%}
}
@media(min-width:1025px) and (pointer:coarse){
  body{height:auto;overflow:auto;-webkit-overflow-scrolling:touch}
  .main{overflow:visible;height:auto;min-height:auto}
}
/* Meetings */
.meeting-card{background:var(--glass);backdrop-filter:blur(12px);border:1px solid var(--glass-border);border-radius:var(--radius);padding:20px;margin-bottom:12px;opacity:0;animation:cardIn .4s cubic-bezier(.4,0,.2,1) forwards;transition:all .25s;border-left:3px solid transparent;cursor:pointer}
.meeting-card:hover{border-color:var(--border-hover);transform:translateY(-2px);box-shadow:0 4px 16px rgba(0,0,0,.2)}
.meeting-card.today{border-left-color:var(--green)}
.meeting-card.past{opacity:.5}
.meeting-card .meeting-header{display:flex;align-items:flex-start;justify-content:space-between;gap:12px}
.meeting-card .meeting-title{font-size:15px;font-weight:600;margin-bottom:4px}
.meeting-card .meeting-meta{font-size:12px;color:var(--text2);display:flex;flex-wrap:wrap;gap:12px;margin-top:6px}
.meeting-badge{font-size:10px;font-weight:700;padding:2px 8px;border-radius:10px;text-transform:uppercase;letter-spacing:.5px}
.meeting-badge.today-badge{background:rgba(64,192,128,.15);color:var(--green)}
.meeting-badge.upcoming-badge{background:rgba(64,128,240,.15);color:var(--blue)}
.meeting-badge.past-badge{background:rgba(122,139,160,.15);color:var(--text2)}
.meeting-attendees{display:flex;gap:4px;flex-wrap:wrap;margin-top:8px}
.meeting-attendee{font-size:11px;padding:2px 8px;background:var(--surface2);border:1px solid var(--border);border-radius:12px;color:var(--text2)}
.meeting-details{max-height:0;overflow:hidden;transition:max-height .3s cubic-bezier(.4,0,.2,1)}
.meeting-card.expanded .meeting-details{max-height:600px}
.meeting-prep{margin-top:16px;padding-top:12px;border-top:1px solid var(--border)}
.meeting-prep h4{font-size:11px;text-transform:uppercase;letter-spacing:1px;color:var(--text2);margin-bottom:8px}
.prep-item{display:flex;align-items:flex-start;gap:8px;padding:8px 0;font-size:13px}
.prep-dot{width:8px;height:8px;border-radius:50%;margin-top:4px;flex-shrink:0}
.prep-dot.pending{background:var(--yellow)}.prep-dot.complete{background:var(--green)}.prep-dot.failed{background:var(--red)}
.prep-item .prep-response{font-size:12px;color:var(--text2);margin-top:4px;padding-left:16px}
.prep-input-wrap{display:flex;gap:8px;margin-top:12px}
.prep-input{flex:1;padding:8px 12px;background:var(--surface);border:1px solid var(--border);border-radius:8px;color:var(--text);font-size:13px;font-family:inherit;outline:none;transition:border-color .2s}
.prep-input:focus{border-color:var(--blue)}
.prep-submit{padding:8px 16px;background:var(--blue);border:none;border-radius:8px;color:#fff;font-size:12px;font-weight:600;cursor:pointer;font-family:inherit;transition:all .15s;white-space:nowrap}
.prep-submit:hover{background:#5090ff}
.toast{position:fixed;bottom:24px;right:24px;background:var(--surface2);border:1px solid var(--border);border-radius:8px;padding:12px 20px;color:var(--text);font-size:13px;z-index:1000;animation:cardIn .3s;pointer-events:none}

/* Travel Research */
.travel-research { margin-top: 16px; }
.research-toggle{display:flex;align-items:center;gap:8px;padding:12px 16px;background:var(--surface2);border-radius:8px;cursor:pointer;transition:all .2s;user-select:none;margin-bottom:4px}
.research-toggle:hover{background:var(--surface3)}
.research-toggle .arrow{transition:transform .3s;font-size:10px;color:var(--text2)}
.research-toggle.open .arrow{transform:rotate(90deg)}
.research-badge{font-size:10px;font-weight:700;padding:2px 8px;border-radius:10px;background:rgba(64,192,128,.12);color:var(--green);margin-left:auto}
.research-content{display:none;padding:12px 0}
.research-content.open{display:block}
.research-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:10px;margin-bottom:16px}
.rest-card{background:var(--surface2);border:1px solid var(--glass-border);border-radius:10px;padding:14px 16px;transition:all .2s}
.rest-card:hover{border-color:var(--border-hover);transform:translateY(-1px)}
.rest-card .rest-name{font-size:14px;font-weight:600;margin-bottom:4px}
.rest-card .rest-meta{display:flex;align-items:center;gap:8px;flex-wrap:wrap;margin-bottom:6px}
.cuisine-badge{font-size:10px;font-weight:700;padding:2px 8px;border-radius:10px;background:rgba(64,128,240,.12);color:var(--blue);text-transform:uppercase;letter-spacing:.3px}
.price-badge{font-size:12px;color:var(--green);font-weight:700}
.star-rating{font-size:11px;color:var(--yellow)}
.rest-card .rest-note{font-size:12px;color:var(--text2);line-height:1.5}
.rest-card .rest-book{display:inline-block;margin-top:8px;font-size:11px;color:var(--blue);font-weight:600;text-decoration:none}
.rest-card .rest-book:hover{text-decoration:underline}
.act-group{margin-bottom:14px}
.act-group-title{font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:var(--text2);margin-bottom:8px;display:flex;align-items:center;gap:6px}
.act-card{background:var(--surface2);border:1px solid var(--glass-border);border-radius:10px;padding:12px 16px;margin-bottom:6px;transition:all .2s}
.act-card:hover{border-color:var(--border-hover)}
.act-card .act-name{font-size:13px;font-weight:600;margin-bottom:2px}
.act-card .act-desc{font-size:12px;color:var(--text2);line-height:1.5}
.act-card a{color:var(--blue);font-size:11px;font-weight:600;text-decoration:none}
.tips-list{list-style:none;counter-reset:tips}
.tips-list li{counter-increment:tips;padding:8px 12px 8px 36px;background:var(--surface2);border-radius:8px;margin-bottom:4px;font-size:13px;color:var(--text);position:relative;line-height:1.5}
.tips-list li::before{content:counter(tips);position:absolute;left:12px;top:8px;font-size:11px;font-weight:700;color:var(--blue);background:rgba(64,128,240,.12);width:18px;height:18px;border-radius:50%;display:flex;align-items:center;justify-content:center}
.weather-widget{display:flex;align-items:center;gap:16px;padding:16px;background:linear-gradient(135deg,var(--surface2),var(--surface3));border-radius:10px;border:1px solid var(--glass-border)}
.weather-temps{text-align:center}
.weather-temps .high{font-size:28px;font-weight:700;color:var(--text)}
.weather-temps .low{font-size:13px;color:var(--text2)}
.weather-conditions{font-size:13px;color:var(--text2);line-height:1.6;flex:1}
.research-empty{padding:20px;text-align:center;background:var(--surface2);border-radius:10px;color:var(--text2);font-size:13px}
.research-input { display: flex; gap: 8px; margin-top: 12px; }
.research-input input { flex: 1; padding: 10px 14px; background: var(--surface); border: 1px solid var(--border); border-radius: 8px; color: var(--text); font-size: 13px; font-family: inherit; }
.research-input button { padding: 10px 18px; background: var(--blue); border: none; border-radius: 8px; color: #fff; font-weight: 600; cursor: pointer; font-size: 13px; }
</style>
</head>
<body>

<div id="login">
  <div class="login-box">
    <h1>Mission Control</h1>
    <div class="login-sub">Dwayne Schofield</div>
    <input type="password" id="pw" placeholder="Password" autofocus>
    <button onclick="tryLogin()">Enter</button>
    <div class="login-error" id="login-error">Incorrect password</div>
  </div>
</div>

<button class="menu-toggle" onclick="document.querySelector('.sidebar').classList.toggle('open')">‚ò∞</button>

<nav class="sidebar">
  <div class="sidebar-logo">
    <div class="title">MISSION CONTROL</div>
    <span class="sub">Dwayne Schofield</span>
  </div>
  <div class="nav" id="nav"></div>
  <div class="sidebar-footer"><button class="btn-logout" onclick="logout()">‚Üê Logout</button></div>
</nav>

<div class="main" id="main-content"></div>

<button class="fab" onclick="openNewTaskModal()" title="New Task">+</button>

<div class="mobile-tabs"><div class="mobile-tabs-inner">
  <button class="mobile-tab active" data-section="dashboard" onclick="showSection('dashboard')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg>Home</button>
  <button class="mobile-tab" data-section="tasks" onclick="showSection('tasks')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 11l3 3L22 4"/><path d="M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11"/></svg>Tasks</button>
  <button class="mobile-tab" data-section="agents" onclick="showSection('agents')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="8" r="4"/><path d="M20 21a8 8 0 10-16 0"/></svg>Agents</button>
  <button class="mobile-tab" data-section="health" onclick="showSection('health')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 00-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 00-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 000-7.78z"/></svg>Health</button>
  <button class="mobile-tab" data-section="travel" onclick="showSection('travel')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 16v-2l-8-5V3.5a1.5 1.5 0 00-3 0V9l-8 5v2l8-2.5V19l-2 1.5V22l3.5-1 3.5 1v-1.5L13 19v-5.5l8 2.5z"/></svg>Travel</button>
</div></div>

<div class="modal-overlay" id="modal-new-task"><div class="modal">
  <h2>New Task</h2>
  <label>Task Name</label><input type="text" id="new-task-name" placeholder="What needs to be done?">
  <label>Priority</label><select id="new-task-priority"><option value="medium">Medium</option><option value="high">High</option><option value="low">Low</option></select>
  <label>Category</label><select id="new-task-category"><option value="SolveWorks">SolveWorks</option><option value="7 Cellars">7 Cellars</option><option value="Personal">Personal</option></select>
  <label>Notes</label><textarea id="new-task-notes" placeholder="Additional context..."></textarea>
  <div class="modal-actions"><button class="modal-btn secondary" onclick="closeModal('modal-new-task')">Cancel</button><button class="modal-btn primary" onclick="createTask()">Create</button></div>
</div></div>

<div class="sync-footer"><span class="sync-dot fresh" id="sync-dot"></span><span id="sync-text">Synced</span></div>
<div class="toast" id="toast"></div>

<script>
const HASH='07954b8b15e56d7e66ede0af0774af7f501481892808554c66818b539317a33e';
const TZ='America/Halifax';
const TEAM=[
  {id:'dwayne',name:'Dwayne',initials:'DW',color:'#4080f0'},
  {id:'mika',name:'Mika',initials:'MK',color:'#40c080'},
  {id:'sage',name:'Sage',initials:'SG',color:'#f0c040'},
  {id:'reece',name:'Reece',initials:'RC',color:'#bc8cff'}
];
const SECTIONS=[
  {id:'dashboard',icon:'<rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/>',label:'Dashboard'},
  {id:'activity',icon:'<polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/>',label:'Activity Feed'},
  {id:'tasks',icon:'<path d="M9 11l3 3L22 4"/><path d="M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11"/>',label:'Tasks',badge:'tasks-badge'},
  {id:'meetings',icon:'<rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/>',label:'Meetings',badge:'meetings-badge'},
  {id:'documents',icon:'<path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/>',label:'Documents',badge:'docs-badge'},
  {id:'agents',icon:'<circle cx="12" cy="8" r="4"/><path d="M20 21a8 8 0 10-16 0"/>',label:'Agents'},
  {id:'7cellars',icon:'<path d="M8 2h8l1 6H7L8 2z"/><path d="M7 8v12a2 2 0 002 2h6a2 2 0 002-2V8"/>',label:'7 Cellars'},
  {id:'solveworks',icon:'<circle cx="12" cy="12" r="10"/><path d="M8 12l3 3 5-5"/>',label:'SolveWorks'},
  {id:'health',icon:'<path d="M20.84 4.61a5.5 5.5 0 00-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 00-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 000-7.78z"/>',label:'Health'},
  {id:'travel',icon:'<path d="M21 16v-2l-8-5V3.5a1.5 1.5 0 00-3 0V9l-8 5v2l8-2.5V19l-2 1.5V22l3.5-1 3.5 1v-1.5L13 19v-5.5l8 2.5z"/>',label:'Travel',badge:'travel-badge'},
  {id:'reading',icon:'<path d="M2 3h6a4 4 0 014 4v14a3 3 0 00-3-3H2z"/><path d="M22 3h-6a4 4 0 00-4 4v14a3 3 0 013-3h7z"/>',label:'Reading List'},
  {id:'calls',icon:'<path d="M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07 19.5 19.5 0 01-6-6 19.79 19.79 0 01-3.07-8.67A2 2 0 014.11 2h3a2 2 0 012 1.72c.12.8.36 1.58.7 2.81a2 2 0 01-.45 2.11L8.09 9.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45c1.23.34 2.01.58 2.81.7A2 2 0 0122 16.92z"/>',label:'Calls',badge:'calls-badge'},
  {id:'security',icon:'<path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>',label:'Security'}
];

let allTasks=[],localTasks=[],localState={},activeFilter='all';

// Build nav & sections
(function(){
  let navH='',mainH='';
  SECTIONS.forEach((s,i)=>{
    navH+=`<div class="nav-item${i===0?' active':''}" data-section="${s.id}" onclick="showSection('${s.id}')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">${s.icon}</svg>${s.label}${s.badge?`<span class="nav-badge" id="${s.badge}">0</span>`:''}</div>`;
    mainH+=`<div class="section${i===0?' active':''}" id="sec-${s.id}"></div>`;
  });
  document.getElementById('nav').innerHTML=navH;
  document.getElementById('main-content').innerHTML=mainH;
})();

/* AUTH */
async function sha256(s){const d=new TextEncoder().encode(s);const h=await crypto.subtle.digest('SHA-256',d);return Array.from(new Uint8Array(h)).map(b=>b.toString(16).padStart(2,'0')).join('')}
document.getElementById('pw').addEventListener('keydown',e=>{if(e.key==='Enter')tryLogin()});
async function tryLogin(){if(await sha256(document.getElementById('pw').value)===HASH){localStorage.setItem('mc_auth_dwayne','1');document.getElementById('login').classList.add('hidden');init()}else{document.getElementById('login-error').style.display='block'}}
function logout(){localStorage.removeItem('mc_auth_dwayne');location.reload()}

/* NAV */
function showSection(id){
  document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));
  document.querySelectorAll('.mobile-tab').forEach(t=>t.classList.remove('active'));
  const sec=document.getElementById('sec-'+id);if(sec){sec.style.animation='none';sec.offsetHeight;sec.style.animation='fadeIn .4s cubic-bezier(.4,0,.2,1)';sec.classList.add('active')}
  document.querySelector(`.nav-item[data-section="${id}"]`)?.classList.add('active');
  document.querySelector(`.mobile-tab[data-section="${id}"]`)?.classList.add('active');
  document.querySelector('.sidebar').classList.remove('open');
}

/* UTILS */
function esc(s){if(s==null)return'';const d=document.createElement('div');d.textContent=s;return d.innerHTML}
function taskKey(t){return 'task:'+btoa(unescape(encodeURIComponent(t.title||t.name||t.task||''))).slice(0,40)}
function saveLS(k,v){localStorage.setItem(k,JSON.stringify(v))}
function loadLS(k){try{return JSON.parse(localStorage.getItem(k)||'null')}catch(e){return null}}
function toast(msg){const t=document.getElementById('toast');t.textContent=msg;t.classList.remove('show');void t.offsetWidth;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),2600)}
function avatarHTML(id,sz){
  if(!id)return `<span class="avatar unassigned"${sz?` style="width:${sz}px;height:${sz}px;font-size:${sz*.38}px"`:''}>?</span>`;
  const m=TEAM.find(x=>x.id===id);if(!m)return `<span class="avatar unassigned">${esc(id[0].toUpperCase())}</span>`;
  return `<span class="avatar" style="background:${m.color}${sz?`;width:${sz}px;height:${sz}px;font-size:${sz*.38}px`:''}">${m.initials}</span>`;
}
function emptyHTML(icon,title,desc){return `<div class="empty-state"><div class="empty-icon">${icon}</div><div class="empty-title">${title}</div><p>${desc}</p></div>`}
function closeModal(id){document.getElementById(id).classList.remove('open')}
function openModal(id){document.getElementById(id).classList.add('open')}
document.querySelectorAll('.modal-overlay').forEach(o=>{o.addEventListener('click',e=>{if(e.target===o)o.classList.remove('open')})});
document.addEventListener('keydown',e=>{if(e.key==='Escape')document.querySelectorAll('.modal-overlay.open').forEach(o=>o.classList.remove('open'))});
document.addEventListener('click',e=>{if(!e.target.closest('.assign-pos'))document.querySelectorAll('.assign-dropdown.open').forEach(d=>d.classList.remove('open'))});
async function loadJSON(p){try{const r=await fetch(p+'?_='+Date.now());if(!r.ok)return null;return r.json()}catch(e){return null}}

/* DASHBOARD */
function renderDashboard(){
  document.getElementById('sec-dashboard').innerHTML=`
    <h1 class="page-title">Dashboard</h1>
    <div class="clock" id="clock"></div>
    <div class="mission-statement"><h2>Mission</h2><p>Build an autonomous organization of AI agents that does work for me and produces value 24/7</p><span class="tag">üéØ Autonomous Operations</span></div>
    <div class="stats-grid">
      <div class="stat-card"><div class="label">In Progress</div><div class="value" style="color:var(--yellow)" id="stat-progress">‚Äî</div></div>
      <div class="stat-card"><div class="label">Completed</div><div class="value" style="color:var(--green)" id="stat-completed">‚Äî</div></div>
      <div class="stat-card"><div class="label">Todo / Waiting</div><div class="value" style="color:var(--blue)" id="stat-waiting">‚Äî</div></div>
      <div class="stat-card"><div class="label">Active Agents</div><div class="value" style="color:var(--purple)" id="stat-agents">1</div></div>
      <div class="stat-card"><div class="label">Upcoming Trips</div><div class="value" style="color:var(--red)" id="stat-trips">0</div></div>
    </div>`;
  updateClock();setInterval(updateClock,1000);
}
function updateClock(){const el=document.getElementById('clock');if(el)el.textContent=new Date().toLocaleString('en-US',{timeZone:TZ,weekday:'long',year:'numeric',month:'long',day:'numeric',hour:'2-digit',minute:'2-digit',second:'2-digit'})+' (Atlantic)'}

/* TASKS */
function renderTasks(){
  const search=(document.getElementById('task-search')?.value||'').toLowerCase();
  const tasks=[...allTasks.map(t=>({...t,_key:taskKey(t)})),...localTasks.map(t=>({...t,_key:taskKey(t)}))];
  const g={ip:[],blocked:[],todo:[],done:[]};
  tasks.forEach(t=>{
    const st=localState[t._key]||{};const name=(t.title||t.name||t.task||'').toLowerCase();
    const cat=(t.category||'').toLowerCase();
    if(search&&!name.includes(search)&&!cat.includes(search))return;
    if(activeFilter!=='all'){
      const assignee=st.assignee||t.assignee||'';
      if(activeFilter==='unassigned'&&assignee)return;
      if(activeFilter!=='unassigned'&&assignee!==activeFilter)return;
    }
    if(st.done){g.done.push(t);return}
    const s=(t.status||'').toLowerCase();
    if(s==='blocked')g.blocked.push(t);
    else if(s.includes('progress'))g.ip.push(t);
    else if(s.includes('complet')||s.includes('done'))g.done.push(t);
    else g.todo.push(t);
  });
  let html='',idx=0;
  const renderGroup=(title,arr)=>{if(!arr.length)return;html+=`<div class="task-section-title">${title} (${arr.length})</div>`;arr.forEach(t=>{html+=taskHTML(t,idx++)})};
  renderGroup('In Progress',g.ip);renderGroup('Blocked',g.blocked);renderGroup('Todo',g.todo);renderGroup('Completed',g.done);
  document.getElementById('tasks-list').innerHTML=html||emptyHTML('üìã','No tasks','Create a task with the + button');
  const b=document.getElementById('tasks-badge');if(b)b.textContent=g.ip.length+g.blocked.length+g.todo.length;
  const sp=document.getElementById('stat-progress');if(sp){sp.textContent=g.ip.length;document.getElementById('stat-completed').textContent=g.done.length;document.getElementById('stat-waiting').textContent=g.todo.length+g.blocked.length}
}
function taskHTML(t,idx){
  const key=t._key,st=localState[key]||{},isDone=st.done,assignee=st.assignee||t.assignee||'',note=st.note||'',name=t.title||t.name||t.task||'';
  const s=(t.status||'').toLowerCase();let bc='todo',bt='Todo';
  if(isDone||s.includes('complet')){bc='completed';bt='Done'}else if(s==='blocked'){bc='blocked';bt='Blocked'}else if(s.includes('progress')){bc='in-progress';bt='In Progress'}else if(s==='todo'){bc='todo';bt='Todo'}
  const pri=t.priority||'medium';
  const ek=esc(key);
  let dueStr='';if(t.due){const d=new Date(t.due+'T00:00:00');dueStr=d.toLocaleDateString('en-US',{month:'short',day:'numeric'})}
  return `<div class="task ${isDone?'completed-local':''}" style="animation-delay:${Math.min(idx*40,400)}ms"><div class="task-row"><span class="badge ${pri}">${pri}</span><span class="badge ${bc}">${bt}</span><span class="task-name">${esc(name)}${t.category?` <span class="task-cat">${esc(t.category)}</span>`:''}</span>${dueStr?`<span class="task-due">üìÖ ${dueStr}</span>`:''}<div class="task-actions"><button class="task-btn ${isDone?'done is-done':'done'}" onclick="toggleDone('${ek}')">‚úì</button><button class="task-btn" onclick="toggleNote('${ek}')" title="Note">üí¨</button><div class="assign-pos"><span onclick="toggleAssign('${ek}')">${avatarHTML(assignee)}</span><div class="assign-dropdown" id="assign-${ek}"><div class="assign-option" onclick="assignTask('${ek}','')"><span class="avatar unassigned" style="width:22px;height:22px;font-size:9px">?</span> Unassigned</div>${TEAM.map(m=>`<div class="assign-option" onclick="assignTask('${ek}','${m.id}')">${avatarHTML(m.id,22)} ${esc(m.name)}</div>`).join('')}</div></div></div></div>${note?`<div class="task-note">${esc(note)}</div>`:''}<textarea class="task-note-input" id="note-${ek}" placeholder="Add a note..." onblur="saveNote('${ek}',this)" onkeydown="if(event.key==='Enter'&&!event.shiftKey){event.preventDefault();this.blur()}">${esc(note)}</textarea></div>`;
}
function toggleDone(k){if(!localState[k])localState[k]={};localState[k].done=!localState[k].done;saveLS('mc_state_dwayne',localState);renderTasks();toast(localState[k].done?'Done ‚úì':'Unmarked')}
function toggleNote(k){const el=document.getElementById('note-'+k);if(!el)return;el.style.display=el.style.display==='block'?'none':'block';if(el.style.display==='block')el.focus()}
function saveNote(k,el){if(!localState[k])localState[k]={};localState[k].note=el.value.trim();saveLS('mc_state_dwayne',localState);renderTasks()}
function toggleAssign(k){const d=document.getElementById('assign-'+k);if(!d)return;document.querySelectorAll('.assign-dropdown.open').forEach(x=>{if(x!==d)x.classList.remove('open')});d.classList.toggle('open')}
function assignTask(k,mid){if(!localState[k])localState[k]={};localState[k].assignee=mid;saveLS('mc_state_dwayne',localState);renderTasks();toast(`Assigned to ${mid?TEAM.find(m=>m.id===mid)?.name||mid:'nobody'}`)}
function openNewTaskModal(){openModal('modal-new-task');setTimeout(()=>document.getElementById('new-task-name').focus(),100)}
function createTask(){
  const name=document.getElementById('new-task-name').value.trim();if(!name){toast('Name required');return}
  const t={title:name,status:'todo',priority:document.getElementById('new-task-priority').value,category:document.getElementById('new-task-category').value};
  localTasks.push(t);saveLS('mc_local_tasks_dwayne',localTasks);
  const notes=document.getElementById('new-task-notes').value.trim();
  if(notes){localState[taskKey(t)]={note:notes};saveLS('mc_state_dwayne',localState)}
  closeModal('modal-new-task');renderTasks();toast('Task created ‚úì');
  document.getElementById('new-task-name').value='';document.getElementById('new-task-notes').value='';
}
function setFilter(id,el){activeFilter=id;document.querySelectorAll('#task-filters .filter-chip').forEach(c=>c.classList.remove('active'));if(el)el.classList.add('active');renderTasks()}

/* MEETINGS */
async function renderMeetings(user){
  const data=await loadJSON('data/meetings.json');
  const meetings=data?.meetings||[];
  const now=new Date();const todayStr=now.toISOString().slice(0,10);
  const upcomingCount=meetings.filter(m=>new Date(m.datetime)>=now||m.datetime.slice(0,10)===todayStr).length;
  const badge=document.getElementById('meetings-badge');if(badge)badge.textContent=upcomingCount||'0';

  let html=`<h1 class="page-title">Meetings</h1><p class="page-sub">Upcoming meetings with AI-powered prep requests</p>`;
  if(!meetings.length){
    html+=emptyHTML('üìÖ','No meetings synced yet','Connect your calendar to see upcoming meetings and add AI-powered prep requests.');
  } else {
    const sorted=[...meetings].sort((a,b)=>new Date(a.datetime)-new Date(b.datetime));
    sorted.forEach((m,i)=>{
      const d=new Date(m.datetime);const mDate=m.datetime.slice(0,10);
      const isToday=mDate===todayStr;const isPast=d<now&&!isToday;
      const status=isToday?'today':isPast?'past':'upcoming';
      const badgeClass=isToday?'today-badge':isPast?'past-badge':'upcoming-badge';
      const badgeText=isToday?'Today':isPast?'Completed':'Upcoming';
      const timeStr=d.toLocaleString('en-US',{weekday:'short',month:'short',day:'numeric',hour:'numeric',minute:'2-digit'});
      // Merge localStorage prep with JSON prep
      const lsKey=`meeting_prep_${m.id}`;const localPrep=JSON.parse(localStorage.getItem(lsKey)||'[]');
      const allPrep=[...(m.prep||[]),...localPrep];
      html+=`<div class="meeting-card ${status}${isPast?' past':''}" style="animation-delay:${i*0.08}s" onclick="toggleMeeting(this)">
        <div class="meeting-header"><div><div class="meeting-title">${esc(m.title)}</div>
        <div class="meeting-meta"><span>üìÖ ${timeStr}</span><span>‚è± ${esc(m.duration)}</span><span>üìç ${esc(m.location)}</span>${m.category?`<span>üè∑ ${esc(m.category)}</span>`:''}</div>
        <div class="meeting-attendees">${m.attendees.map(a=>`<span class="meeting-attendee">${esc(a)}</span>`).join('')}</div>
        </div><span class="meeting-badge ${badgeClass}">${badgeText}</span></div>
        <div class="meeting-details"><div class="meeting-prep"><h4>Prep Requests</h4>
        <div id="prep-list-${m.id}">${allPrep.length?allPrep.map(p=>`<div class="prep-item"><span class="prep-dot ${p.status}"></span><div><div>${esc(p.request)}</div>${p.status==='complete'&&p.response?`<div class="prep-response">${esc(p.response)}</div>`:''}</div></div>`).join(''):'<div style="font-size:12px;color:var(--text2)">No prep requests yet</div>'}</div>
        <!-- TODO: Wire to agent API for actual research execution -->
        <div class="prep-input-wrap"><input class="prep-input" id="prep-input-${m.id}" placeholder="Add a prep request..." onclick="event.stopPropagation()" onkeydown="if(event.key==='Enter'){event.stopPropagation();submitPrep('${m.id}')}"><button class="prep-submit" onclick="event.stopPropagation();submitPrep('${m.id}')">Submit</button></div>
        </div></div></div>`;
    });
  }
  document.getElementById('sec-meetings').innerHTML=html;
}
function toggleMeeting(el){el.classList.toggle('expanded')}
function submitPrep(meetingId){
  const input=document.getElementById('prep-input-'+meetingId);if(!input||!input.value.trim())return;
  const req={request:input.value.trim(),status:'pending',response:''};
  const lsKey=`meeting_prep_${meetingId}`;const existing=JSON.parse(localStorage.getItem(lsKey)||'[]');
  existing.push(req);localStorage.setItem(lsKey,JSON.stringify(existing));
  const list=document.getElementById('prep-list-'+meetingId);
  list.innerHTML+=`<div class="prep-item"><span class="prep-dot pending"></span><div><div>${esc(req.request)}</div></div></div>`;
  input.value='';showToast('Prep request submitted');
}
function showToast(msg){const t=document.createElement('div');t.className='toast';t.textContent=msg;document.body.appendChild(t);setTimeout(()=>t.remove(),2500)}

/* INIT */
async function init(){
  localState=loadLS('mc_state_dwayne')||{};localTasks=loadLS('mc_local_tasks_dwayne')||[];
  renderDashboard();

  // Tasks
  document.getElementById('sec-tasks').innerHTML=`<h1 class="page-title">Tasks</h1><p class="page-sub">Track work across 7 Cellars, SolveWorks & Personal</p><div class="filter-bar"><div class="search-wrap"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/></svg><input type="text" class="search-input" id="task-search" placeholder="Search tasks..." oninput="renderTasks()"></div><div id="task-filters" style="display:flex;gap:6px;flex-wrap:wrap"></div></div><div id="tasks-list"></div>`;
  let fh='<div class="filter-chip active" data-filter="all" onclick="setFilter(\'all\',this)">All</div>';
  TEAM.forEach(m=>{fh+=`<div class="filter-chip" data-filter="${m.id}" onclick="setFilter('${m.id}',this)">${esc(m.name)}</div>`});
  fh+='<div class="filter-chip" data-filter="unassigned" onclick="setFilter(\'unassigned\',this)">Unassigned</div>';
  document.getElementById('task-filters').innerHTML=fh;
  const tasks=await loadJSON('data/tasks.json');
  if(tasks)allTasks=tasks.tasks||[];
  renderTasks();

  // Meetings
  try { await renderMeetings('dwayne'); } catch(e){console.error('Meetings error:',e)}

  // Activity
  try {
  const mem=await loadJSON('data/memory-recent.json');
  const entries=mem?.entries||[];
  document.getElementById('sec-activity').innerHTML=`<h1 class="page-title">Activity Feed</h1><p class="page-sub">Recent updates from Mika</p>`+(entries.length?entries.map((e,i)=>`<div class="feed-item" style="animation-delay:${i*0.08}s"><div class="feed-date">${esc(e.date)}</div><div class="feed-content">${esc(e.summary)}</div></div>`).join(''):emptyHTML('üì°','No activity yet','Activity will appear here as Mika logs updates'));
  } catch(e){console.error('Activity error:',e)}

  // Documents
  try {
  const docs=await loadJSON('data/documents.json');
  const docFolders=docs?.folders||(docs?.documents?[{name:'Documents',files:docs.documents.map(d=>({name:(d.title||d.name||'Untitled')+(d.type?'.'+d.type:''),path:d.path||''}))}]:Array.isArray(docs)?docs:[]);
  const docList=docs?.documents||[];
  let dhtml=`<h1 class="page-title">Documents</h1><p class="page-sub">Key files and reference docs</p>`;
  if(docList.length){
    const db=document.getElementById('docs-badge');if(db)db.textContent=docList.length;
    docList.forEach((d,i)=>{
      const iconClass=d.type==='pdf'?'pdf':'md';const emoji=d.type==='pdf'?'üìï':'üìÑ';
      dhtml+=`<div class="doc-card" style="animation-delay:${i*0.06}s"><div class="doc-icon ${iconClass}">${emoji}</div><div style="flex:1;min-width:0"><div class="doc-title">${esc(d.title)}</div><div class="doc-cat">${esc(d.category)}</div></div><div class="doc-date">${esc(d.updated||'')}</div></div>`;
    });
  } else {dhtml+=emptyHTML('üìÅ','No documents','Documents will appear once synced')}
  document.getElementById('sec-documents').innerHTML=dhtml;
  } catch(e){console.error('Documents error:',e)}

  // Agents
  try {
  const agents=await loadJSON('data/agents.json');
  const agentList=agents?.agents||[];
  document.getElementById('sec-agents').innerHTML=`<h1 class="page-title">Agents</h1><p class="page-sub">Autonomous team members</p><div class="agents-grid">${agentList.length?agentList.map((a,i)=>`<div class="agent-card" style="animation-delay:${i*0.08}s"><span class="agent-status ${a.status==='active'?'active':'standby'}">${esc(a.status)}</span><div class="agent-name">${esc(a.name)}</div><div class="agent-role">${esc(a.role)}</div><div class="agent-desc">${esc(a.description||a.desc||'')}</div></div>`).join(''):emptyHTML('ü§ñ','No agents','Agent profiles will appear once configured')}</div>`;
  const sa=document.getElementById('stat-agents');if(sa)sa.textContent=agentList.filter(a=>a.status==='active').length;
  } catch(e){console.error('Agents error:',e)}

  // 7 Cellars
  try {
  const cellars=await loadJSON('data/7cellars.json');
  document.getElementById('sec-7cellars').innerHTML=`<h1 class="page-title">7 Cellars</h1><p class="page-sub">Premium wine import & distribution ‚Äî Grand Cayman</p>${cellars?`<a class="biz-card" href="${esc(cellars.url)}" target="_blank"><h3>üç∑ ${esc(cellars.name)}</h3><p>${esc(cellars.description)}</p><span class="biz-link">Visit ${esc(cellars.url)} ‚Üí</span></a>`:emptyHTML('üç∑','No data','Run sync to load 7 Cellars data')}`;
  } catch(e){console.error('7Cellars error:',e)}

  // SolveWorks
  try {
  const sw=await loadJSON('data/solveworks.json');
  document.getElementById('sec-solveworks').innerHTML=`<h1 class="page-title">SolveWorks</h1><p class="page-sub">AI-powered autonomous operations</p>${sw?`<a class="biz-card" href="${esc(sw.url)}" target="_blank"><h3>‚ö° ${esc(sw.name)}</h3><p>${esc(sw.description)}</p><span class="biz-link">Visit ${esc(sw.url)} ‚Üí</span></a>`:emptyHTML('‚ö°','No data','Run sync to load SolveWorks data')}`;
  } catch(e){console.error('SolveWorks error:',e)}

  // Health
  try {
  const h=await loadJSON('data/health.json');
  let hhtml=`<h1 class="page-title">Health Dashboard</h1><p class="page-sub">Oura Ring ‚Äî recovery, readiness, and performance</p>`;
  if(h&&h.sleep!==undefined){
    hhtml+=`<div class="stats-grid">
      <div class="stat-card"><div class="label">Sleep Score</div><div class="value" style="color:var(--purple)">${h.sleep}</div><div class="health-bar"><div class="health-bar-fill" style="width:${h.sleep}%;background:var(--purple)"></div></div></div>
      <div class="stat-card"><div class="label">HRV</div><div class="value" style="color:var(--blue)">${h.hrv}</div></div>
      <div class="stat-card"><div class="label">Readiness</div><div class="value" style="color:var(--green)">${h.readiness}</div><div class="health-bar"><div class="health-bar-fill" style="width:${h.readiness}%;background:var(--green)"></div></div></div>
      <div class="stat-card"><div class="label">Steps</div><div class="value" style="color:var(--yellow)">${(h.steps||0).toLocaleString()}</div></div>
    </div>`;
    if(h.sleepDetail){const s=h.sleepDetail;hhtml+=`<div class="task-section-title">Sleep Breakdown</div><div class="feed-item"><div class="feed-content"><strong>${s.totalHours}h total</strong> ¬∑ Efficiency ${s.efficiency}%<br>Deep: ${s.deepMin}min ¬∑ REM: ${s.remMin}min ¬∑ Light: ${s.lightMin}min<br>Restfulness: ${s.restfulness} ¬∑ Latency score: ${s.latency}</div></div>`}
    if(h.activityDetail){const a=h.activityDetail;hhtml+=`<div class="task-section-title">Activity</div><div class="feed-item"><div class="feed-content">Calories: ${a.calories} ¬∑ High: ${a.activeMin}min ¬∑ Med: ${a.mediumMin}min ¬∑ Low: ${a.lowMin}min</div></div>`}
    if(h.recoveryDetail){const r=h.recoveryDetail;hhtml+=`<div class="task-section-title">Recovery</div><div class="feed-item"><div class="feed-content">HRV avg: ${r.hrvAvg} ¬∑ Resting HR: ${r.restingHR?.toFixed(1)} ¬∑ Temp deviation: ${r.tempDeviation}¬∞</div></div>`}
    if(h.trends?.length){
      hhtml+=`<div class="task-section-title">7-Day Trends</div><div class="stats-grid">`;
      h.trends.slice(-7).forEach(t=>{hhtml+=`<div class="stat-card" style="padding:14px"><div class="label">${esc(t.date)}</div><div style="font-size:12px;margin-top:6px"><span style="color:var(--purple)">üí§${t.sleep}</span> ¬∑ <span style="color:var(--green)">‚ö°${t.readiness}</span> ¬∑ <span style="color:var(--yellow)">üëü${(t.steps||0).toLocaleString()}</span></div></div>`});
      hhtml+=`</div>`;
    }
  } else {hhtml+=emptyHTML('üí§','No health data','Connect Oura Ring to track sleep, HRV, readiness')}
  document.getElementById('sec-health').innerHTML=hhtml;
  } catch(e){console.error('Health error:',e)}

  // Travel (Darryl-style)
  try {
  const travel=await loadJSON('data/travel.json');
  const trips=travel?.trips||[];
  let thtml=`<h1 class="page-title">Travel</h1><p class="page-sub">Upcoming trips and itineraries</p>`;
  const stTrips=document.getElementById('stat-trips');
  if(trips.length){
    const upcoming=trips.filter(t=>t.status==='upcoming'||t.status==='in-progress');
    if(stTrips)stTrips.textContent=upcoming.length;
    const tb=document.getElementById('travel-badge');if(tb&&upcoming.length){tb.textContent=upcoming.length}

    trips.forEach((trip,i)=>{
      const purposeClass=trip.purpose||'business';
      const statusClass=(trip.status||'upcoming').replace(' ','-');
      const statusLabel={'upcoming':'Upcoming','in-progress':'In Progress','completed':'Completed'}[statusClass]||trip.status;
      let dateStr='';
      if(trip.startDate&&trip.endDate){
        const start=new Date(trip.startDate+'T00:00:00');const end=new Date(trip.endDate+'T00:00:00');
        dateStr=start.toLocaleDateString('en-US',{month:'short',day:'numeric'})+' ‚Äì '+end.toLocaleDateString('en-US',{month:'short',day:'numeric',year:'numeric'});
      }
      thtml+=`<div class="travel-card" style="animation-delay:${i*0.08}s"><div class="travel-card-header" onclick="this.nextElementSibling.classList.toggle('open')"><div><div class="travel-dest">${esc(trip.destination)}</div><div class="travel-dates">${esc(dateStr)}</div></div><div><span class="travel-badge ${purposeClass}">${purposeClass}</span><span class="travel-status ${statusClass}">${statusLabel}</span></div></div><div class="travel-details">`;
      if(trip.flights?.length){
        thtml+=`<div class="travel-section"><div class="travel-section-title">‚úàÔ∏è Flights</div>`;
        trip.flights.forEach(f=>{
          thtml+=`<div class="flight-route"><div><div class="flight-airport">${esc(f.from)}</div><div class="flight-time">${esc(f.depart)}</div></div><div class="flight-arrow"><div class="flight-num">${esc(f.airline||'')} ${esc(f.flightNum||'')}</div><div class="line"></div><div class="flight-time">${esc(f.date||'')}</div></div><div><div class="flight-airport">${esc(f.to)}</div><div class="flight-time">${esc(f.arrive||'')}</div></div></div>`;
          if(f.confirmation)thtml+=`<div class="flight-conf">Confirmation: ${esc(f.confirmation)}</div>`;
        });
        thtml+=`</div>`;
      }
      if(trip.hotels?.length){
        thtml+=`<div class="travel-section"><div class="travel-section-title">üè® Hotels</div>`;
        trip.hotels.forEach(ho=>{
          thtml+=`<div class="hotel-card"><div class="hotel-name">${esc(ho.name)}</div><div class="hotel-detail">Check-in: ${esc(ho.checkIn)} ¬∑ Check-out: ${esc(ho.checkOut)}</div>`;
          if(ho.confirmation)thtml+=`<div class="hotel-detail" style="color:var(--blue)">Confirmation: ${esc(ho.confirmation)}</div>`;
          if(ho.address)thtml+=`<div class="hotel-detail">${esc(ho.address)}</div>`;
          thtml+=`</div>`;
        });
        thtml+=`</div>`;
      }
      if(trip.itinerary?.length){
        thtml+=`<div class="travel-section"><div class="travel-section-title">üìã Itinerary</div>`;
        trip.itinerary.forEach(day=>{
          thtml+=`<div class="itin-day"><div class="itin-date">${esc(day.date)}</div>`;
          (day.items||[]).forEach(item=>{thtml+=`<div class="itin-item">‚Ä¢ ${esc(item)}</div>`});
          thtml+=`</div>`;
        });
        thtml+=`</div>`;
      }
      // üîç Trip Research (rich format)
      {
        const r=trip.research;
        const hasResearch=r&&typeof r==='object'&&!Array.isArray(r)&&(r.restaurants?.length||r.activities?.length);
        const tripId=(trip.destination||'').replace(/[^a-zA-Z0-9]/g,'_');
        thtml+=`<div class="travel-section travel-research"><div class="travel-section-title">üîç Trip Research</div>`;
        thtml+=`<div class="research-toggle" onclick="this.classList.toggle('open');this.nextElementSibling.classList.toggle('open')"><span class="arrow">‚ñ∂</span> <span>${hasResearch?'View Researched Recommendations':'Trip Research'}</span>${hasResearch?`<span class="research-badge">AI Researched ‚Ä¢ ${r.lastUpdated||'Recently'}</span>`:''}</div>`;
        thtml+=`<div class="research-content">`;
        if(hasResearch){
          if(r.restaurants?.length){
            thtml+=`<div style="margin-bottom:6px"><div class="act-group-title">üçΩÔ∏è Restaurants (${r.restaurants.length})</div></div><div class="research-grid">`;
            r.restaurants.forEach(rest=>{
              const stars='‚òÖ'.repeat(Math.floor(rest.rating||0))+(rest.rating%1>=.5?'¬Ω':'');
              thtml+=`<div class="rest-card"><div class="rest-name">${esc(rest.name)}</div><div class="rest-meta"><span class="cuisine-badge">${esc(rest.cuisine)}</span><span class="price-badge">${esc(rest.priceRange)}</span><span class="star-rating">${stars} ${rest.rating}</span></div><div class="rest-note">${esc(rest.note)}</div>${rest.bookingUrl?`<a class="rest-book" href="${esc(rest.bookingUrl)}" target="_blank">Book / Reserve ‚Üí</a>`:''}</div>`;
            });
            thtml+=`</div>`;
          }
          if(r.activities?.length){
            const typeIcons={skiing:'‚õ∑Ô∏è',spa:'üßñ',nightlife:'üç∫',entertainment:'üé≠',shopping:'üõçÔ∏è',dining:'üçΩÔ∏è'};
            const grouped={};
            r.activities.forEach(a=>{const t=a.type||'other';if(!grouped[t])grouped[t]=[];grouped[t].push(a)});
            Object.entries(grouped).forEach(([type,acts])=>{
              thtml+=`<div class="act-group"><div class="act-group-title">${typeIcons[type]||'üìå'} ${type.charAt(0).toUpperCase()+type.slice(1)}</div>`;
              acts.forEach(a=>{
                thtml+=`<div class="act-card"><div class="act-name">${esc(a.name)}</div><div class="act-desc">${esc(a.description)}</div>${a.url?`<a href="${esc(a.url)}" target="_blank">Learn more ‚Üí</a>`:''}</div>`;
              });
              thtml+=`</div>`;
            });
          }
          if(r.localTips?.length){
            thtml+=`<div style="margin-bottom:6px"><div class="act-group-title">üí° Local Tips</div></div><ol class="tips-list">`;
            r.localTips.forEach(tip=>{thtml+=`<li>${esc(tip)}</li>`});
            thtml+=`</ol>`;
          }
          if(r.weather){
            thtml+=`<div style="margin-bottom:6px;margin-top:14px"><div class="act-group-title">üå§Ô∏è Weather</div></div><div class="weather-widget"><div class="weather-temps"><div class="high">${r.weather.avgHigh}¬∞C</div><div class="low">Low ${r.weather.avgLow}¬∞C</div></div><div class="weather-conditions">${esc(r.weather.conditions)}</div></div>`;
          }
        } else {
          thtml+=`<div class="research-empty">ü§ñ Your agent will prepare personalized recommendations before your trip</div>`;
        }
        thtml+=`</div></div>`;
      }
      if(trip.notes)thtml+=`<div class="travel-section"><div class="travel-section-title">üìù Notes</div><div class="travel-notes">${esc(trip.notes)}</div></div>`;
      thtml+=`</div></div>`;
    });
  } else {thtml+=emptyHTML('‚úàÔ∏è','No trips planned','Travel itineraries will appear here')}
  document.getElementById('sec-travel').innerHTML=thtml;
  } catch(e){console.error('Travel error:',e)}

  // Reading List
  try {
  const reading=await loadJSON('data/reading-list.json');
  const items=reading?.items||[];
  let rhtml=`<h1 class="page-title">Reading List</h1><p class="page-sub">Books and references</p>`;
  if(items.length){items.forEach((a,i)=>{
    rhtml+=`<div class="reading-item" style="animation-delay:${i*0.06}s"><span class="reading-status ${a.status||'queued'}">${esc(a.status||'queued')}</span><div style="flex:1"><div style="font-size:14px;font-weight:500">${esc(a.title)}</div><div style="font-size:12px;color:var(--text2)">${esc(a.category||'')}</div></div></div>`;
  })} else {rhtml+=emptyHTML('üìö','Nothing to read','Articles will appear here when saved')}
  document.getElementById('sec-reading').innerHTML=rhtml;
  } catch(e){console.error('Reading error:',e)}

  // Ski Log
  try {
  const ski=await loadJSON('data/ski-log.json');
  let skhtml=`<h1 class="page-title">Ski Log</h1><p class="page-sub">Season ${esc(ski?.season||'2025-2026')}</p>`;
  if(ski){
    skhtml+=`<div class="stats-grid"><div class="stat-card"><div class="label">Days Skied</div><div class="value" style="color:var(--blue)">${ski.daysSkied||0}</div></div><div class="stat-card"><div class="label">Favorite Mountain</div><div class="value" style="font-size:16px;color:var(--green)">${esc(ski.favoriteMountain||'‚Äî')}</div></div></div>`;
    if(ski.sessions?.length){ski.sessions.forEach((s,i)=>{skhtml+=`<div class="ski-session" style="animation-delay:${i*0.06}s"><div style="display:flex;gap:12px;align-items:center;flex-wrap:wrap"><strong>‚õ∑ ${esc(s.date)}</strong><span style="color:var(--blue)">${esc(s.mountain)}</span><span class="badge waiting">${esc(s.conditions||'')}</span></div>${s.notes?`<div style="font-size:13px;color:var(--text2);margin-top:6px">${esc(s.notes)}</div>`:''}${s.csia?`<div style="font-size:12px;color:var(--purple);margin-top:4px">CSIA: ${esc(s.csia)}</div>`:''}</div>`})}
    else skhtml+=emptyHTML('‚õ∑','No sessions logged','Ski sessions will appear here');
  } else {skhtml+=emptyHTML('‚õ∑','No ski data','Connect your ski log')}
  document.getElementById('sec-ski').innerHTML=skhtml;
  } catch(e){console.error('Ski error:',e)}

  // Call Recordings
  try {
  const calls=await loadJSON('data/call-analyses.json');
  const callList=calls?.analyses||[];
  const bizMap={'7 Cellars':'cellars','7cellars':'cellars',SolveWorks:'solveworks',solveworks:'solveworks'};
  let chtml=`<h1 class="page-title">Call Recordings</h1><p class="page-sub">Meeting recordings and analyses</p>`;
  if(callList.length){
    const cb=document.getElementById('calls-badge');if(cb)cb.textContent=callList.length;
    callList.forEach((a,i)=>{const biz=a.business||'Unknown';chtml+=`<div class="call-item"><div class="call-header"><div class="call-title">üìû ${esc(a.contact||a.title||'Call')}</div><span class="call-badge ${bizMap[biz]||'unknown'}">${esc(biz)}</span><span class="call-date">${esc(a.date||'')}</span></div>${(a.takeaways||[]).length?`<ul class="call-takeaways">${a.takeaways.slice(0,4).map(t=>`<li>${esc(t)}</li>`).join('')}</ul>`:''}${a.fullAnalysis?`<div class="call-expand" onclick="document.getElementById('cf-${i}').classList.toggle('open')">View full analysis ‚ñæ</div><div class="call-full" id="cf-${i}">${marked.parse(a.fullAnalysis)}</div>`:''}</div>`});
  } else {chtml+=emptyHTML('üìû','No call recordings','Send recordings to Mika for analysis')}
  document.getElementById('sec-calls').innerHTML=chtml;
  } catch(e){console.error('Calls error:',e)}

  // Security
  try {
  const sec=await loadJSON('data/security.json');
  let shtml=`<h1 class="page-title">Security Status</h1><p class="page-sub">System security and audit results</p>`;
  if(sec){
    const st=sec.status||'ok',bc=st==='ok'?'ok':st==='warn'?'warn':'alert',bt=st==='ok'?'All Clear':st==='warn'?'Warning':'Alert';
    shtml+=`<div class="security-card"><span class="security-status-badge ${bc}">üõ° ${bt}</span>`;
    if(sec.lastCheck)shtml+=`<div style="font-size:12px;color:var(--text2);margin-bottom:12px">Last check: ${esc(sec.lastCheck)}</div>`;
    if(sec.details)shtml+=`<div style="font-size:14px;line-height:1.7">${marked.parse(sec.details)}</div>`;
    if(sec.checks?.length){shtml+='<div style="margin-top:12px">';sec.checks.forEach(c=>{shtml+=`<div style="padding:6px 0;font-size:13px;border-bottom:1px solid var(--border)">${c.pass?'‚úÖ':'‚ùå'} ${esc(c.name||c.check||'')} <span style="color:var(--text2);float:right">${esc(c.detail||'')}</span></div>`});shtml+='</div>'}
    shtml+='</div>';
  } else {shtml+=emptyHTML('üõ°','No security data','Security checks will populate when audits are run')}
  document.getElementById('sec-security').innerHTML=shtml;
  } catch(e){console.error('Security error:',e)}
}

if(localStorage.getItem('mc_auth_dwayne')==='1'){document.getElementById('login').classList.add('hidden');init()}
</script>
<script src="../shared/interactivity.js"></script>
</body>
</html>