<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mission Control ‚Äî Brody</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{
--bg:#070d14;--surface:#0c1520;--surface2:#111d2b;--surface3:#172536;
--border:#2a2a3a;--text:#e4e4e8;--text2:#9898b0;--accent:#0D1B2A;
--accent-light:#1a3050;--yellow:#f0c040;--green:#40c080;--blue:#4080f0;
--red:#f04060;--purple:#a060f0;--radius:10px;
}
body{font-family:'Inter',system-ui,sans-serif;background:var(--bg);color:var(--text);height:100dvh;overflow:hidden;display:flex;position:relative}
body::after{content:'';position:fixed;inset:0;pointer-events:none;z-index:0;opacity:.03;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E")}
a{color:var(--blue);text-decoration:none}
::-webkit-scrollbar{width:6px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:var(--surface3);border-radius:3px}
::-webkit-scrollbar-thumb:hover{background:var(--border)}

/* Login */
#login{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;z-index:100;background:linear-gradient(-45deg,#0a0a0f,#0d1520,#0a1228,#0f0a1a);background-size:400% 400%;animation:loginGradient 15s ease infinite}
#login.hidden{display:none}
@keyframes loginGradient{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
.login-box{background:rgba(18,18,26,.7);backdrop-filter:blur(24px);-webkit-backdrop-filter:blur(24px);border:1px solid rgba(42,42,58,.6);border-radius:16px;padding:48px;width:360px;text-align:center;animation:loginBoxIn .6s cubic-bezier(.4,0,.2,1)}
@keyframes loginBoxIn{from{opacity:0;transform:translateY(20px) scale(.96)}to{opacity:1;transform:translateY(0) scale(1)}}
.login-box h1{font-size:20px;margin-bottom:8px;font-weight:700}
.login-box p{color:var(--text2);font-size:13px;margin-bottom:24px}
.login-box input{width:100%;padding:12px 16px;background:var(--surface2);border:1px solid var(--border);border-radius:8px;color:var(--text);font-size:14px;font-family:inherit;outline:none;transition:all .3s}
.login-box input:focus{border-color:var(--blue);box-shadow:0 0 0 3px rgba(64,128,240,.15)}
.login-box button{width:100%;padding:12px;margin-top:12px;background:var(--accent-light);border:none;border-radius:8px;color:#fff;font-size:14px;font-weight:600;cursor:pointer;font-family:inherit;transition:all .15s}
.login-box button:hover{background:#224070}
.login-box button:active{transform:scale(.97)}
.login-error{color:var(--red);font-size:12px;margin-top:8px;display:none}
@keyframes shake{0%,100%{transform:translateX(0)}20%,60%{transform:translateX(-6px)}40%,80%{transform:translateX(6px)}}

/* Sidebar */
.sidebar{width:240px;background:var(--surface);border-right:1px solid var(--border);display:flex;flex-direction:column;flex-shrink:0;height:100vh;z-index:2;transition:transform .3s cubic-bezier(.4,0,.2,1)}
.sidebar-logo{padding:20px;font-size:15px;font-weight:700;letter-spacing:1px;color:var(--text2);border-bottom:1px solid var(--border)}
.sidebar-logo span{color:var(--text)}
.sidebar-logo .sub{display:block;font-size:10px;font-weight:500;letter-spacing:2px;color:var(--text2);margin-top:4px;text-transform:uppercase}
.nav{flex:1;padding:12px}
.nav-item{display:flex;align-items:center;gap:10px;padding:10px 14px;border-radius:8px;cursor:pointer;color:var(--text2);font-size:14px;font-weight:500;transition:all .2s cubic-bezier(.4,0,.2,1);position:relative}
.nav-item:hover{background:var(--surface2);color:var(--text)}
.nav-item.active{background:var(--accent-light);color:#fff}
.nav-item.active::before{content:'';position:absolute;left:-12px;top:50%;transform:translateY(-50%);width:3px;height:20px;background:var(--blue);border-radius:0 3px 3px 0}
.nav-item svg{width:18px;height:18px;opacity:.6}
.nav-item.active svg{opacity:1}
.nav-badge{position:absolute;right:10px;font-size:11px;font-weight:700;background:var(--surface3);color:var(--text2);padding:2px 8px;border-radius:10px;min-width:24px;text-align:center}
.nav-item.active .nav-badge{background:rgba(255,255,255,.15);color:#fff}
.sidebar-footer{padding:16px;border-top:1px solid var(--border)}
.btn-logout{width:100%;padding:8px;background:var(--surface2);border:1px solid var(--border);border-radius:6px;color:var(--text2);font-size:13px;cursor:pointer;font-family:inherit;transition:all .15s}
.btn-logout:hover{background:var(--surface3);color:var(--text)}

/* Main */
.main{flex:1;overflow-y:auto;-webkit-overflow-scrolling:touch;padding:32px 40px;position:relative;z-index:1;min-height:0}
.section{display:none}
.section.active{display:block;animation:fadeInSection .4s cubic-bezier(.4,0,.2,1)}
@keyframes fadeInSection{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
@keyframes cardIn{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}

.page-title{font-size:24px;font-weight:700;margin-bottom:4px;letter-spacing:-.02em}
.page-sub{color:var(--text2);font-size:14px;margin-bottom:28px}

/* Stats */
.stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:16px;margin-bottom:28px}
.stat-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:20px;position:relative;overflow:hidden;transition:all .25s cubic-bezier(.4,0,.2,1);opacity:0;animation:cardIn .5s cubic-bezier(.4,0,.2,1) forwards}
.stat-card:nth-child(1){animation-delay:.05s}
.stat-card:nth-child(2){animation-delay:.1s}
.stat-card:nth-child(3){animation-delay:.15s}
.stat-card:nth-child(4){animation-delay:.2s}
.stat-card:hover{border-color:#3a3a4a;box-shadow:inset 0 0 30px rgba(255,255,255,.02)}
.stat-card::before{content:'';position:absolute;left:0;top:0;bottom:0;width:3px;border-radius:3px 0 0 3px}
.stat-card:nth-child(1)::before{background:linear-gradient(180deg,var(--blue),rgba(64,128,240,.3))}
.stat-card:nth-child(2)::before{background:linear-gradient(180deg,var(--green),rgba(64,192,128,.3))}
.stat-card:nth-child(3)::before{background:linear-gradient(180deg,var(--yellow),rgba(240,192,64,.3))}
.stat-card:nth-child(4)::before{background:linear-gradient(180deg,var(--purple),rgba(160,96,240,.3))}
.stat-card .label{font-size:11px;color:var(--text2);text-transform:uppercase;letter-spacing:1px;margin-bottom:8px;font-weight:500}
.stat-card .value{font-size:28px;font-weight:700}
.stat-card .value.blue{color:var(--blue)}
.stat-card .value.green{color:var(--green)}
.stat-card .value.yellow{color:var(--yellow)}
.stat-card .value.purple{color:var(--purple)}

/* Kanban */
.kanban-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:20px;flex-wrap:wrap;gap:12px}
.kanban-header h2{font-size:18px;font-weight:700}
.btn-add{padding:9px 18px;background:var(--blue);border:none;border-radius:8px;color:#fff;font-size:13px;font-weight:600;cursor:pointer;font-family:inherit;transition:all .15s;display:flex;align-items:center;gap:6px}
.btn-add:hover{background:#5090ff}
.btn-add:active{transform:scale(.96)}
.kanban-columns{display:flex;gap:14px;overflow-x:auto;padding-bottom:16px;min-height:400px}
.kanban-col{min-width:220px;width:220px;flex-shrink:0;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);display:flex;flex-direction:column;max-height:72vh}
.kanban-col-header{padding:14px 14px 10px;font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:1px;display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid var(--border)}
.kanban-col-header .kc-count{font-size:11px;font-weight:600;background:var(--surface2);padding:2px 8px;border-radius:10px;color:var(--text2)}
.kanban-col-body{flex:1;overflow-y:auto;padding:10px;min-height:60px;transition:background .2s}
.kanban-col-body.drag-over{background:rgba(64,128,240,.08);border-radius:0 0 var(--radius) var(--radius)}
.kanban-card{background:rgba(20,30,46,.8);backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px);border:1px solid var(--border);border-radius:8px;padding:12px;margin-bottom:8px;cursor:grab;transition:all .2s;user-select:none}
.kanban-card:active{cursor:grabbing}
.kanban-card:hover{border-color:#3a3a4a;box-shadow:0 4px 16px rgba(0,0,0,.3)}
.kanban-card.dragging{opacity:.4;transform:scale(.96)}
.kanban-card.active-glow{box-shadow:0 0 12px rgba(64,192,128,.2);border-color:rgba(64,192,128,.3)}
.kanban-card .kc-name{font-size:14px;font-weight:700;margin-bottom:2px}
.kanban-card .kc-company{font-size:12px;color:var(--text2);margin-bottom:6px}
.kanban-card .kc-notes{font-size:11px;color:var(--text2);line-height:1.5;margin-bottom:8px;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
.kanban-card .kc-meta{display:flex;align-items:center;gap:6px;flex-wrap:wrap}
.kanban-card .kc-date{font-size:10px;color:var(--text2);margin-left:auto}

/* Kanban Modal */
.kanban-modal{position:fixed;inset:0;background:rgba(0,0,0,.6);backdrop-filter:blur(4px);z-index:150;display:none;align-items:center;justify-content:center}
.kanban-modal.open{display:flex}
.kanban-modal-content{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:28px;max-width:520px;width:90%;max-height:80vh;overflow-y:auto;animation:cardIn .3s ease;position:relative}
.kanban-modal-content h2{font-size:18px;font-weight:700;margin-bottom:16px}
.km-close{position:absolute;top:16px;right:20px;font-size:22px;color:var(--text2);cursor:pointer;background:none;border:none;line-height:1}
.km-close:hover{color:var(--text)}
.km-field{margin-bottom:14px}
.km-field label{display:block;font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:var(--text2);margin-bottom:6px}
.km-field input,.km-field textarea,.km-field select{width:100%;padding:10px 14px;background:var(--surface2);border:1px solid var(--border);border-radius:8px;color:var(--text);font-size:13px;font-family:inherit;outline:none;transition:border-color .2s}
.km-field input:focus,.km-field textarea:focus,.km-field select:focus{border-color:var(--blue)}
.km-field textarea{resize:vertical;min-height:80px}
.km-field select option{background:var(--surface2);color:var(--text)}
.km-actions{display:flex;gap:10px;margin-top:4px}
.km-save{flex:1;padding:10px;background:var(--blue);border:none;border-radius:8px;color:#fff;font-size:13px;font-weight:600;cursor:pointer;font-family:inherit;transition:all .15s}
.km-save:hover{background:#5090ff}
.km-delete{padding:10px 18px;background:transparent;border:1px solid var(--red);border-radius:8px;color:var(--red);font-size:13px;font-weight:600;cursor:pointer;font-family:inherit;transition:all .15s}
.km-delete:hover{background:rgba(240,64,96,.15)}
.km-stage-row{display:flex;flex-wrap:wrap;gap:6px;margin-top:4px}
.km-stage-btn{padding:6px 14px;border-radius:20px;border:1px solid var(--border);background:transparent;color:var(--text2);font-size:12px;font-weight:600;cursor:pointer;font-family:inherit;transition:all .15s}
.km-stage-btn:hover{background:var(--surface2);color:var(--text)}
.km-stage-btn.active{color:#fff}

/* Toast */
.kanban-toast{position:fixed;bottom:30px;left:50%;transform:translateX(-50%) translateY(100px);background:var(--surface2);border:1px solid var(--border);border-radius:8px;padding:10px 20px;font-size:13px;color:var(--text);z-index:200;transition:transform .3s cubic-bezier(.4,0,.2,1);pointer-events:none}
.kanban-toast.show{transform:translateX(-50%) translateY(0)}

/* Calendly Events */
.cal-events-list{display:flex;flex-direction:column;gap:12px;margin-top:8px}
.cal-event-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:18px 20px;display:flex;align-items:center;gap:16px;transition:all .2s cubic-bezier(.4,0,.2,1)}
.cal-event-card:hover{border-color:#3a3a4a;box-shadow:0 4px 16px rgba(0,0,0,.2)}
.cal-event-avatar{width:44px;height:44px;border-radius:50%;background:linear-gradient(135deg,#4080f0,#6a5af9);display:flex;align-items:center;justify-content:center;font-size:18px;font-weight:700;color:#fff;flex-shrink:0}
.cal-event-info{flex:1;min-width:0}
.cal-event-name{font-size:15px;font-weight:700;margin-bottom:2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.cal-event-type{font-size:12px;color:var(--text2);margin-bottom:4px}
.cal-event-time{font-size:13px;color:var(--accent);font-weight:600}
.cal-event-duration{font-size:12px;color:var(--text2)}
.cal-event-badge{display:inline-block;font-size:11px;font-weight:600;padding:2px 8px;border-radius:20px;background:rgba(64,128,240,.15);color:#4080f0;border:1px solid rgba(64,128,240,.3);margin-left:8px}
.cal-join-btn{display:inline-flex;align-items:center;gap:6px;padding:8px 16px;background:#4080f0;color:#fff;border-radius:8px;font-size:13px;font-weight:600;text-decoration:none;flex-shrink:0;transition:background .2s}
.cal-join-btn:hover{background:#5590ff}
.cal-empty-state{text-align:center;padding:60px 20px;color:var(--text2)}
.cal-empty-state .cal-empty-icon{font-size:48px;margin-bottom:12px}
.cal-empty-state p{font-size:15px}
.cal-sync-info{font-size:12px;color:var(--text3,#555);margin-top:16px;text-align:right}

/* Documents */
.docs-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:16px}
.doc-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:20px;transition:all .25s cubic-bezier(.4,0,.2,1);opacity:0;animation:cardIn .5s cubic-bezier(.4,0,.2,1) forwards;display:flex;flex-direction:column;gap:12px}
.doc-card:nth-child(1){animation-delay:.05s}
.doc-card:nth-child(2){animation-delay:.1s}
.doc-card:nth-child(3){animation-delay:.15s}
.doc-card:nth-child(4){animation-delay:.2s}
.doc-card:nth-child(5){animation-delay:.25s}
.doc-card:hover{border-color:#3a3a4a;transform:translateY(-2px);box-shadow:0 4px 16px rgba(0,0,0,.2)}
.doc-card .doc-icon{width:44px;height:44px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:22px;flex-shrink:0}
.doc-card .doc-title{font-size:15px;font-weight:700}
.doc-card .doc-desc{font-size:13px;color:var(--text2);line-height:1.5;flex:1}
.doc-card .doc-meta{font-size:11px;color:var(--text2);font-weight:600;text-transform:uppercase;letter-spacing:.5px}
.doc-open{display:inline-block;padding:8px 18px;background:var(--surface2);border:1px solid var(--border);border-radius:6px;color:var(--text);font-size:12px;font-weight:600;cursor:pointer;text-decoration:none;transition:all .15s;font-family:inherit;border:none}
.doc-open:hover{background:var(--surface3);color:var(--text)}

/* Email */
.email-connect-banner{background:linear-gradient(135deg,#0a1628,#162840);border:1px solid var(--border);border-radius:var(--radius);padding:20px 24px;margin-bottom:20px;display:flex;align-items:center;justify-content:space-between;gap:16px;flex-wrap:wrap}
.email-connect-banner p{font-size:14px;color:var(--text2)}
.email-connect-banner strong{color:var(--text)}
.btn-connect{padding:9px 18px;background:var(--blue);border:none;border-radius:8px;color:#fff;font-size:13px;font-weight:600;cursor:pointer;font-family:inherit;transition:all .15s;white-space:nowrap}
.btn-connect:hover{background:#5090ff}
.email-toolbar{display:flex;align-items:center;gap:10px;margin-bottom:16px;flex-wrap:wrap}
.email-filter-chip{padding:6px 14px;background:var(--surface);border:1px solid var(--border);border-radius:20px;color:var(--text2);font-size:12px;font-weight:600;cursor:pointer;transition:all .2s}
.email-filter-chip.active{background:var(--accent-light);color:#fff;border-color:var(--accent-light)}
.email-item{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:16px 20px;margin-bottom:10px;transition:all .25s cubic-bezier(.4,0,.2,1);opacity:0;animation:cardIn .4s cubic-bezier(.4,0,.2,1) forwards;display:grid;grid-template-columns:auto 1fr auto;gap:12px;align-items:center}
.email-item:nth-child(1){animation-delay:.05s}
.email-item:nth-child(2){animation-delay:.1s}
.email-item:nth-child(3){animation-delay:.15s}
.email-item:nth-child(4){animation-delay:.2s}
.email-item:nth-child(5){animation-delay:.25s}
.email-item:hover{border-color:#3a3a4a;box-shadow:inset 0 0 30px rgba(255,255,255,.015)}
.email-item.unread .email-subject{font-weight:700}
.email-avatar{width:38px;height:38px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:13px;font-weight:700;color:#fff;flex-shrink:0}
.email-body{min-width:0}
.email-from{font-size:13px;font-weight:600;margin-bottom:2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.email-subject{font-size:13px;color:var(--text);margin-bottom:2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.email-preview{font-size:12px;color:var(--text2);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.email-actions{display:flex;flex-direction:column;align-items:flex-end;gap:8px;flex-shrink:0}
.email-time{font-size:11px;color:var(--text2);white-space:nowrap}
.email-btns{display:flex;gap:4px}
.email-btn{padding:4px 10px;background:var(--surface2);border:1px solid var(--border);border-radius:6px;color:var(--text2);font-size:11px;font-weight:600;cursor:pointer;font-family:inherit;transition:all .15s;white-space:nowrap}
.email-btn:hover{background:var(--surface3);color:var(--text)}
.email-btn.reply{border-color:rgba(64,128,240,.3);color:var(--blue)}
.email-btn.reply:hover{background:rgba(64,128,240,.15)}
.email-btn.flag{border-color:rgba(240,192,64,.3);color:var(--yellow)}
.email-btn.flag:hover{background:rgba(240,192,64,.15)}
.email-unread-dot{width:8px;height:8px;border-radius:50%;background:var(--blue);flex-shrink:0;align-self:center}

/* Health Monitor */
.health-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:16px;margin-bottom:24px}
.health-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:24px;transition:all .25s cubic-bezier(.4,0,.2,1);opacity:0;animation:cardIn .5s cubic-bezier(.4,0,.2,1) forwards}
.health-card:nth-child(1){animation-delay:.05s}
.health-card:nth-child(2){animation-delay:.1s}
.health-card:hover{border-color:#3a3a4a;transform:translateY(-2px);box-shadow:0 4px 16px rgba(0,0,0,.2)}
.health-card .hc-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px}
.health-card .hc-name{font-size:18px;font-weight:700}
.health-card .hc-agent{font-size:13px;color:var(--text2);margin-top:2px}
.status-dot{width:12px;height:12px;border-radius:50%;flex-shrink:0}
.status-dot.online{background:var(--green);box-shadow:0 0 8px rgba(64,192,128,.5);animation:pulseDot 2s ease-in-out infinite}
.status-dot.offline{background:var(--red);box-shadow:0 0 8px rgba(240,64,96,.4)}
.status-dot.warning{background:var(--yellow);box-shadow:0 0 8px rgba(240,192,64,.4)}
@keyframes pulseDot{0%,100%{opacity:1}50%{opacity:.6}}
.status-badge{display:inline-flex;align-items:center;gap:6px;font-size:12px;font-weight:700;padding:4px 12px;border-radius:20px;text-transform:uppercase;letter-spacing:.5px}
.status-badge.online{background:rgba(64,192,128,.15);color:var(--green)}
.status-badge.offline{background:rgba(240,64,96,.15);color:var(--red)}
.status-badge.warning{background:rgba(240,192,64,.15);color:var(--yellow)}
.hc-ip{font-size:12px;color:var(--text2);font-family:monospace;margin-top:10px;padding:6px 12px;background:var(--surface2);border-radius:6px;display:inline-block}
.hc-lastseen{font-size:12px;color:var(--text2);margin-top:8px}
.health-update-note{font-size:12px;color:var(--text2);margin-top:16px;padding:10px 16px;background:var(--surface2);border-radius:8px}

/* Mobile menu toggle */
.menu-toggle{display:none;position:fixed;top:16px;left:16px;z-index:10;background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:8px 12px;color:var(--text);cursor:pointer;font-size:16px}
@media(max-width:768px){
  body{flex-direction:column}
  .sidebar{position:fixed;top:0;left:0;bottom:0;transform:translateX(-100%);z-index:50}
  .sidebar.open{transform:translateX(0);box-shadow:4px 0 24px rgba(0,0,0,.5)}
  .main{padding:60px 20px 20px}
  .menu-toggle{display:block}
  .kanban-columns{flex-direction:column}
  .kanban-col{min-width:100%;width:100%;max-height:none}
  .email-item{grid-template-columns:1fr}
  .email-btns{display:none}
}
</style>
</head>
<body>

<div id="login">
  <div class="login-box">
    <h1>Mission Control</h1>
    <p>Brody Schofield ‚Äî SolveWorks Install Specialist</p>
    <input type="password" id="pw" placeholder="Password" autofocus>
    <button onclick="tryLogin()">Enter</button>
    <div class="login-error" id="login-error">Incorrect password</div>
  </div>
</div>

<button class="menu-toggle" onclick="document.querySelector('.sidebar').classList.toggle('open')">‚ò∞</button>

<nav class="sidebar">
  <div class="sidebar-logo">
    <span>BRODY</span>
    <span class="sub">Mission Control</span>
  </div>
  <div class="nav">
    <div class="nav-item active" data-section="pipeline" onclick="showSection('pipeline')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="4" rx="1"/><rect x="3" y="10" width="12" height="4" rx="1"/><rect x="3" y="17" width="8" height="4" rx="1"/></svg>
      Pipeline <span class="nav-badge" id="pipeline-badge">0</span>
    </div>
    <div class="nav-item" data-section="calendly" onclick="showSection('calendly')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
      Calendly
    </div>
    <div class="nav-item" data-section="documents" onclick="showSection('documents')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
      Documents <span class="nav-badge" id="docs-badge">5</span>
    </div>
    <div class="nav-item" data-section="email" onclick="showSection('email')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
      Email <span class="nav-badge" id="email-badge">5</span>
    </div>
    <div class="nav-item" data-section="health" onclick="showSection('health')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>
      Client Health <span class="nav-badge" id="health-badge">2</span>
    </div>
  </div>
  <div class="sidebar-footer">
    <button class="btn-logout" onclick="logout()">Sign Out</button>
  </div>
</nav>

<main class="main">

  <!-- PIPELINE -->
  <div class="section active" id="sec-pipeline">
    <div class="kanban-header">
      <div>
        <h1 class="page-title">Pipeline</h1>
        <p class="page-sub" style="margin-bottom:0">Your CRM ‚Äî drag cards between stages</p>
      </div>
      <button class="btn-add" onclick="openAddModal()">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
        Add Lead
      </button>
    </div>

    <div class="stats-grid" id="pipeline-stats"></div>
    <div class="kanban-columns" id="kanban-board"></div>
  </div>

  <!-- CALENDLY -->
  <div class="section" id="sec-calendly">
    <h1 class="page-title">Scheduled Calls</h1>
    <p class="page-sub">Upcoming bookings ‚Äî <a href="https://calendly.com/brody1schofield" target="_blank">calendly.com/brody1schofield</a></p>
    <div id="cal-events-container">
      <div class="cal-empty-state">
        <div class="cal-empty-icon">üìÖ</div>
        <p>Loading upcoming bookings‚Ä¶</p>
      </div>
    </div>
  </div>

  <!-- DOCUMENTS -->
  <div class="section" id="sec-documents">
    <h1 class="page-title">Documents</h1>
    <p class="page-sub">SolveWorks resources & templates</p>
    <div class="docs-grid" id="docs-grid"></div>
  </div>

  <!-- EMAIL -->
  <div class="section" id="sec-email">
    <h1 class="page-title">Email Triage</h1>
    <p class="page-sub">brody@solveworks.io</p>
    <div class="email-toolbar">
      <div class="email-filter-chip active" onclick="filterEmail('all',this)">All</div>
      <div class="email-filter-chip" onclick="filterEmail('unread',this)">Unread</div>
      <div class="email-filter-chip" onclick="filterEmail('flagged',this)">Flagged</div>
      <span style="flex:1"></span>
      <span id="email-updated" style="font-size:11px;color:var(--text2)"></span>
    </div>
    <div id="email-list"></div>
  </div>

  <!-- CLIENT HEALTH -->
  <div class="section" id="sec-health">
    <h1 class="page-title">Client Health</h1>
    <p class="page-sub">Real-time agent status for active SolveWorks clients</p>
    <div class="health-grid" id="health-grid"></div>
    <div class="health-update-note">
      üì° Status data pulled from <code style="background:var(--surface3);padding:2px 6px;border-radius:4px;font-size:11px">brody/data/client-health.json</code> ‚Äî updated by sync.sh on a cron schedule.
    </div>
  </div>

</main>

<!-- Kanban Modal -->
<div class="kanban-modal" id="kanban-modal" onclick="if(event.target===this)closeModal()">
  <div class="kanban-modal-content">
    <button class="km-close" onclick="closeModal()">√ó</button>
    <h2 id="modal-title">Add Lead</h2>
    <div class="km-field">
      <label>Client Name</label>
      <input type="text" id="km-name" placeholder="e.g. Sarah Chen">
    </div>
    <div class="km-field">
      <label>Company</label>
      <input type="text" id="km-company" placeholder="e.g. Acme Corp">
    </div>
    <div class="km-field">
      <label>Stage</label>
      <div class="km-stage-row" id="km-stage-row"></div>
    </div>
    <div class="km-field">
      <label>Notes</label>
      <textarea id="km-notes" placeholder="Discovery call notes, pain points, next steps..."></textarea>
    </div>
    <div class="km-actions">
      <button class="km-save" onclick="saveModal()">Save Lead</button>
      <button class="km-delete" id="km-delete-btn" onclick="deleteModal()" style="display:none">Delete</button>
    </div>
  </div>
</div>

<div class="kanban-toast" id="kanban-toast"></div>

<script>
// ‚îÄ‚îÄ Auth ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const HASH='22fd6a1a5f4737d07bcab3655d7130c382d65f8c52428bdef5c7df0161b75c57';
async function sha256(s){const d=new TextEncoder().encode(s);const h=await crypto.subtle.digest('SHA-256',d);return Array.from(new Uint8Array(h)).map(b=>b.toString(16).padStart(2,'0')).join('')}
document.getElementById('pw').addEventListener('keydown',e=>{if(e.key==='Enter')tryLogin()});
async function tryLogin(){
  const pw=document.getElementById('pw').value;
  if(await sha256(pw)===HASH){
    localStorage.setItem('mc_auth_brody','1');
    document.getElementById('login').classList.add('hidden');
    init();
  } else {
    document.getElementById('login-error').style.display='block';
    document.getElementById('pw').style.animation='shake .4s ease';
    setTimeout(()=>document.getElementById('pw').style.animation='',400);
  }
}
function logout(){localStorage.removeItem('mc_auth_brody');location.reload()}

// ‚îÄ‚îÄ Nav ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function showSection(id){
  document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));
  document.getElementById('sec-'+id).classList.add('active');
  document.querySelector(`.nav-item[data-section="${id}"]`).classList.add('active');
  document.querySelector('.sidebar').classList.remove('open');
}

// ‚îÄ‚îÄ Utils ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function esc(s){return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;')}
function uid(){return Date.now().toString(36)+Math.random().toString(36).slice(2)}
function showToast(msg){const t=document.getElementById('kanban-toast');t.textContent=msg;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),2400)}

// ‚îÄ‚îÄ Pipeline / Kanban ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const STAGES=[
  {id:'call-booked',  label:'Call Booked',   color:'var(--blue)',   bg:'rgba(64,128,240,.15)'},
  {id:'discovery',    label:'Discovery Done', color:'var(--purple)', bg:'rgba(160,96,240,.15)'},
  {id:'install-done', label:'Install Done',   color:'var(--yellow)', bg:'rgba(240,192,64,.15)'},
  {id:'active',       label:'Active Client',  color:'var(--green)',  bg:'rgba(64,192,128,.15)'},
  {id:'churned',      label:'Churned',        color:'var(--red)',    bg:'rgba(240,64,96,.15)'},
];

let leads=[];
function saveLeads(){localStorage.setItem('brody_leads_v2',JSON.stringify(leads))}
function loadLeads(){try{leads=JSON.parse(localStorage.getItem('brody_leads_v2')||'[]')}catch(e){leads=[]}}

function renderPipelineStats(){
  const active=leads.filter(l=>l.stage==='active').length;
  const total=leads.filter(l=>l.stage!=='churned').length;
  const churned=leads.filter(l=>l.stage==='churned').length;
  const installs=leads.filter(l=>l.stage==='install-done'||l.stage==='active').length;
  document.getElementById('pipeline-stats').innerHTML=`
    <div class="stat-card"><div class="label">Total Leads</div><div class="value blue">${total}</div></div>
    <div class="stat-card"><div class="label">Active Clients</div><div class="value green">${active}</div></div>
    <div class="stat-card"><div class="label">Installs Done</div><div class="value yellow">${installs}</div></div>
    <div class="stat-card"><div class="label">Churned</div><div class="value purple">${churned}</div></div>
  `;
  document.getElementById('pipeline-badge').textContent=total;
}

function renderKanban(){
  renderPipelineStats();
  const board=document.getElementById('kanban-board');
  board.innerHTML=STAGES.map(st=>{
    const cards=leads.filter(l=>l.stage===st.id);
    const cardHtml=cards.map(l=>`
      <div class="kanban-card${st.id==='active'?' active-glow':''}" draggable="true" data-id="${esc(l.id)}"
        ondragstart="dragStart(event)" onclick="openEditModal('${esc(l.id)}')">
        <div class="kc-name">${esc(l.name)}</div>
        ${l.company?`<div class="kc-company">${esc(l.company)}</div>`:''}
        ${l.notes?`<div class="kc-notes">${esc(l.notes)}</div>`:''}
        <div class="kc-meta">
          <span style="font-size:10px;font-weight:700;padding:2px 8px;border-radius:10px;background:${st.bg};color:${st.color}">${st.label}</span>
          <span class="kc-date">${l.date||''}</span>
        </div>
      </div>
    `).join('');
    return `
      <div class="kanban-col">
        <div class="kanban-col-header" style="color:${st.color}">
          ${st.label} <span class="kc-count">${cards.length}</span>
        </div>
        <div class="kanban-col-body" data-stage="${st.id}"
          ondragover="event.preventDefault();this.classList.add('drag-over')"
          ondragleave="this.classList.remove('drag-over')"
          ondrop="handleDrop(event,this)">
          ${cardHtml}
        </div>
      </div>
    `;
  }).join('');
}

// Drag and drop
let _dragId=null;
function dragStart(e){
  const card=e.target.closest('.kanban-card');
  _dragId=card.dataset.id;
  card.classList.add('dragging');
  e.dataTransfer.effectAllowed='move';
}
function handleDrop(e,col){
  e.preventDefault();
  col.classList.remove('drag-over');
  const newStage=col.dataset.stage;
  const lead=leads.find(l=>l.id===_dragId);
  if(lead&&lead.stage!==newStage){
    lead.stage=newStage;
    lead.date=new Date().toLocaleDateString('en-US',{month:'short',day:'numeric'});
    saveLeads();
    renderKanban();
    showToast(`Moved to ${STAGES.find(s=>s.id===newStage).label}`);
  }
  _dragId=null;
}
document.addEventListener('dragend',()=>{document.querySelectorAll('.kanban-card.dragging').forEach(c=>c.classList.remove('dragging'))});

// Modal
let _editId=null;
function buildStageRow(selected){
  return STAGES.map(s=>`<button class="km-stage-btn${selected===s.id?' active':''}" style="${selected===s.id?'background:'+s.color+';border-color:'+s.color+';':''}" onclick="selectStage('${s.id}')">${s.label}</button>`).join('');
}
function selectStage(id){
  document.querySelectorAll('.km-stage-btn').forEach(b=>{
    const st=STAGES.find(s=>s.id===id);
    if(b.textContent===st.label){b.classList.add('active');b.style.background=st.color;b.style.borderColor=st.color}
    else{b.classList.remove('active');b.style.background='';b.style.borderColor=''}
  });
  document.getElementById('km-stage-row').dataset.selected=id;
}
function openAddModal(){
  _editId=null;
  document.getElementById('modal-title').textContent='Add Lead';
  document.getElementById('km-name').value='';
  document.getElementById('km-company').value='';
  document.getElementById('km-notes').value='';
  document.getElementById('km-delete-btn').style.display='none';
  document.getElementById('km-stage-row').innerHTML=buildStageRow('call-booked');
  document.getElementById('km-stage-row').dataset.selected='call-booked';
  document.getElementById('kanban-modal').classList.add('open');
  setTimeout(()=>document.getElementById('km-name').focus(),100);
}
function openEditModal(id){
  const lead=leads.find(l=>l.id===id);
  if(!lead)return;
  _editId=id;
  document.getElementById('modal-title').textContent='Edit Lead';
  document.getElementById('km-name').value=lead.name||'';
  document.getElementById('km-company').value=lead.company||'';
  document.getElementById('km-notes').value=lead.notes||'';
  document.getElementById('km-delete-btn').style.display='block';
  document.getElementById('km-stage-row').innerHTML=buildStageRow(lead.stage);
  document.getElementById('km-stage-row').dataset.selected=lead.stage;
  document.getElementById('kanban-modal').classList.add('open');
}
function closeModal(){document.getElementById('kanban-modal').classList.remove('open')}
function saveModal(){
  const name=document.getElementById('km-name').value.trim();
  if(!name){showToast('Client name is required');return}
  const stage=document.getElementById('km-stage-row').dataset.selected||'call-booked';
  if(_editId){
    const lead=leads.find(l=>l.id===_editId);
    lead.name=name;lead.company=document.getElementById('km-company').value.trim();
    lead.notes=document.getElementById('km-notes').value.trim();lead.stage=stage;
  } else {
    leads.push({id:uid(),name,company:document.getElementById('km-company').value.trim(),notes:document.getElementById('km-notes').value.trim(),stage,date:new Date().toLocaleDateString('en-US',{month:'short',day:'numeric'})});
  }
  saveLeads();renderKanban();closeModal();showToast(_editId?'Lead updated':'Lead added');
}
function deleteModal(){
  if(!_editId)return;
  leads=leads.filter(l=>l.id!==_editId);
  saveLeads();renderKanban();closeModal();showToast('Lead deleted');
}

// ‚îÄ‚îÄ Documents ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const DOCS=[
  {icon:'üìÑ',color:'#1a3050',title:'Proposal Template',desc:'Standard SolveWorks client proposal with pricing and scope.',meta:'Template ¬∑ DOCX',href:'https://solveworks.io/proposals/'},
  {icon:'üöÄ',color:'#0a2a1a',title:'Deployment Playbook',desc:'Step-by-step agent installation and configuration guide.',meta:'Playbook ¬∑ PDF',href:'https://solveworks.io/docs/deployment-playbook'},
  {icon:'‚úÖ',color:'#1a2a0a',title:'Post-Install Checklist',desc:'Verification checklist after every client agent deployment.',meta:'Checklist ¬∑ PDF',href:'https://solveworks.io/docs/post-install-verification'},
  {icon:'üéØ',color:'#1a1a2a',title:'Discovery Call Template',desc:'Structured discovery call framework and question bank.',meta:'Template ¬∑ PDF',href:'https://solveworks.io/docs/discovery-call-template'},
  {icon:'üí∞',color:'#2a1a0a',title:'Pricing Sheet',desc:'Setup: $1,500 one-time ¬∑ Monthly: $250/mo. Custom enterprise on request.',meta:'Internal ¬∑ Hardcoded'},
];

function renderDocs(){
  document.getElementById('docs-grid').innerHTML=DOCS.map((d,i)=>`
    <div class="doc-card">
      <div class="doc-icon" style="background:${d.color}">${d.icon}</div>
      <div>
        <div class="doc-title">${d.title}</div>
        <div class="doc-desc" style="margin-top:6px">${d.desc}</div>
      </div>
      <div style="display:flex;align-items:center;justify-content:space-between;margin-top:4px">
        <span class="doc-meta">${d.meta}</span>
        ${d.href?`<a href="${d.href}" target="_blank" class="doc-open">Open ‚Üí</a>`:`<button class="doc-open" onclick="showToast('Pricing: Setup $1,500 + $250/mo')">View Pricing</button>`}
      </div>
    </div>
  `).join('');
}

// ‚îÄ‚îÄ Email ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const AVATAR_COLORS=['#1a3050','#0a2a1a','#1a1a3a','#2a0a0a','#2a1a0a','#0a1a2a','#1a2a0a','#2a0a2a','#0a2a2a','#1a1a1a'];
let EMAILS=[];
let emailFilter='all';

function emailInitials(name){
  const p=name.trim().split(/\s+/);
  return p.length>=2?(p[0][0]+p[p.length-1][0]).toUpperCase():name.slice(0,2).toUpperCase();
}
function emailTimeLabel(dateStr){
  const d=new Date(dateStr);
  const now=new Date();
  const diffMs=now-d;
  const diffDays=Math.floor(diffMs/86400000);
  if(diffDays===0){
    return d.toLocaleTimeString([],{hour:'numeric',minute:'2-digit'});
  } else if(diffDays===1){
    return 'Yesterday';
  } else if(diffDays<7){
    return d.toLocaleDateString([],{weekday:'short'});
  } else {
    return d.toLocaleDateString([],{month:'short',day:'numeric'});
  }
}
function filterEmail(f,el){
  emailFilter=f;
  document.querySelectorAll('.email-filter-chip').forEach(c=>c.classList.remove('active'));
  el.classList.add('active');
  renderEmails();
}
function renderEmails(){
  const list=document.getElementById('email-list');
  let filtered=EMAILS;
  if(emailFilter==='unread')filtered=EMAILS.filter(e=>e.unread);
  if(emailFilter==='flagged')filtered=EMAILS.filter(e=>e.flagged);
  if(!filtered.length){
    list.innerHTML=`<div style="text-align:center;padding:40px;color:var(--text2);font-size:14px;">No emails${emailFilter!=='all'?' in this filter':''}</div>`;
    return;
  }
  list.innerHTML=filtered.map((e,i)=>`
    <div class="email-item${e.unread?' unread':''}" style="animation-delay:${i*0.05}s">
      <div class="email-avatar" style="background:${e.color||AVATAR_COLORS[i%AVATAR_COLORS.length]}">${esc(e.avatar||emailInitials(e.from_name||'?'))}</div>
      <div class="email-body">
        <div class="email-from">${esc(e.from_name||e.from_email||'Unknown')}${e.sent?' <span style="font-size:10px;font-weight:700;padding:1px 6px;border-radius:8px;background:rgba(64,128,240,.15);color:#4080f0;border:1px solid rgba(64,128,240,.3);vertical-align:middle;margin-left:5px">SENT</span>':''}</div>
        <div class="email-subject">${esc(e.subject||'(no subject)')}${e.flagged?' <span style="color:var(--yellow);font-size:11px">üö©</span>':''}</div>
        <div class="email-preview">${esc(e.preview||'')}</div>
      </div>
      <div class="email-actions">
        <span class="email-time">${emailTimeLabel(e.date)}</span>
        ${e.unread?'<span class="email-unread-dot"></span>':''}
      </div>
    </div>
  `).join('');
  document.getElementById('email-badge').textContent=EMAILS.filter(e=>e.unread).length||'';
}
async function loadEmails(){
  try{
    const r=await fetch('data/emails.json?t='+Date.now());
    const data=await r.json();
    EMAILS=data.emails||[];
    const upd=document.getElementById('email-updated');
    if(upd&&data.updated){
      const d=new Date(data.updated);
      upd.textContent='Updated '+d.toLocaleTimeString([],{hour:'numeric',minute:'2-digit'});
    }
  } catch(e){
    console.warn('emails.json not loaded',e);
    EMAILS=[];
  }
  renderEmails();
}

// ‚îÄ‚îÄ Client Health ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function renderHealth(){
  let data={clients:[],updated:null};
  try{
    const r=await fetch('data/client-health.json?t='+Date.now());
    data=await r.json();
  } catch(e){
    // fallback static
    data={clients:[
      {name:'Darryl',agent:'Brit',ip:'100.83.184.91',status:'online',lastSeen:'2026-02-27T15:00:00Z'},
      {name:'Drew',agent:'Freedom',ip:'100.124.57.91',status:'online',lastSeen:'2026-02-27T15:00:00Z'}
    ],updated:'2026-02-27T15:00:00Z'};
  }
  document.getElementById('health-grid').innerHTML=data.clients.map((c,i)=>{
    const lastSeen=c.lastSeen?new Date(c.lastSeen).toLocaleString('en-US',{month:'short',day:'numeric',hour:'numeric',minute:'2-digit'}):'Unknown';
    return `
      <div class="health-card">
        <div class="hc-header">
          <div>
            <div class="hc-name">${esc(c.name)}</div>
            <div class="hc-agent">Agent: ${esc(c.agent)}</div>
          </div>
          <div class="status-badge ${c.status}">
            <span class="status-dot ${c.status}"></span>
            ${c.status.charAt(0).toUpperCase()+c.status.slice(1)}
          </div>
        </div>
        <div class="hc-ip">üåê ${esc(c.ip)}</div>
        <div class="hc-lastseen">Last seen: ${lastSeen}</div>
      </div>
    `;
  }).join('');
  document.getElementById('health-badge').textContent=data.clients.length;
  if(data.updated){
    document.querySelector('.health-update-note').innerHTML+=`<br>Last sync: ${new Date(data.updated).toLocaleString('en-US',{month:'short',day:'numeric',hour:'numeric',minute:'2-digit'})}`;
  }
}

// ‚îÄ‚îÄ Calendly Events ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function renderCalendly(){
  const container=document.getElementById('cal-events-container');
  let data={events:[],updated:null};
  try{
    const r=await fetch('data/calendly.json?t='+Date.now());
    if(!r.ok) throw new Error('not found');
    data=await r.json();
  } catch(e){
    container.innerHTML='<div class="cal-empty-state"><div class="cal-empty-icon">üìÖ</div><p>No upcoming bookings</p></div>';
    return;
  }

  const events=data.events||[];
  if(events.length===0){
    container.innerHTML='<div class="cal-empty-state"><div class="cal-empty-icon">üìÖ</div><p>No upcoming bookings</p></div>';
    return;
  }

  // AST = UTC-4
  const toAST=(iso)=>{
    const d=new Date(iso);
    return d.toLocaleString('en-US',{timeZone:'America/Halifax',month:'short',day:'numeric',weekday:'short',hour:'numeric',minute:'2-digit',hour12:true});
  };
  const durationMins=(s,e)=>{
    const diff=(new Date(e)-new Date(s))/60000;
    return diff>=60?`${diff/60}h`:`${diff}m`;
  };
  const initials=(name)=>name.split(' ').map(p=>p[0]||'').join('').slice(0,2).toUpperCase()||'?';

  const now=new Date();
  const upcoming=events.filter(ev=>new Date(ev.end_time)>now);
  const past=events.filter(ev=>new Date(ev.end_time)<=now);

  let html='<div class="cal-events-list">';

  if(upcoming.length){
    html+=`<div style="font-size:12px;font-weight:700;color:var(--text2);text-transform:uppercase;letter-spacing:.08em;margin-bottom:4px">Upcoming (${upcoming.length})</div>`;
    upcoming.forEach(ev=>{
      const dur=durationMins(ev.start_time,ev.end_time);
      const joinBtn=ev.join_url?`<a class="cal-join-btn" href="${esc(ev.join_url)}" target="_blank">‚ñ∂ Join</a>`:'';
      html+=`
        <div class="cal-event-card">
          <div class="cal-event-avatar">${esc(initials(ev.invitee_name))}</div>
          <div class="cal-event-info">
            <div class="cal-event-name">${esc(ev.invitee_name)}<span class="cal-event-badge">${esc(ev.name)}</span></div>
            ${ev.invitee_email?`<div class="cal-event-type">${esc(ev.invitee_email)}</div>`:''}
            <div class="cal-event-time">${toAST(ev.start_time)} AST <span class="cal-event-duration">¬∑ ${dur}</span></div>
          </div>
          ${joinBtn}
        </div>`;
    });
  }

  if(past.length){
    html+=`<div style="font-size:12px;font-weight:700;color:var(--text2);text-transform:uppercase;letter-spacing:.08em;margin:16px 0 4px">Past (${past.length})</div>`;
    past.forEach(ev=>{
      const dur=durationMins(ev.start_time,ev.end_time);
      html+=`
        <div class="cal-event-card" style="opacity:.55">
          <div class="cal-event-avatar" style="background:linear-gradient(135deg,#444,#333)">${esc(initials(ev.invitee_name))}</div>
          <div class="cal-event-info">
            <div class="cal-event-name">${esc(ev.invitee_name)}<span class="cal-event-badge" style="background:rgba(255,255,255,.06);color:var(--text2);border-color:rgba(255,255,255,.1)">${esc(ev.name)}</span></div>
            ${ev.invitee_email?`<div class="cal-event-type">${esc(ev.invitee_email)}</div>`:''}
            <div class="cal-event-time" style="color:var(--text2)">${toAST(ev.start_time)} AST <span class="cal-event-duration">¬∑ ${dur}</span></div>
          </div>
        </div>`;
    });
  }

  html+='</div>';
  if(data.updated){
    html+=`<div class="cal-sync-info">Synced ${new Date(data.updated).toLocaleString('en-US',{month:'short',day:'numeric',hour:'numeric',minute:'2-digit'})}</div>`;
  }
  container.innerHTML=html;
  // Update nav badge
  const badge=document.querySelector('.nav-item[data-section="calendly"] .nav-badge');
  if(badge) badge.textContent=upcoming.length;
}

// ‚îÄ‚îÄ Init ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function init(){
  loadLeads();
  // seed real clients if empty
  if(leads.length===0){
    leads=[
      {id:uid(),name:'Darryl Hicks',company:'Revaly',notes:'Mac Mini installed. Brit agent running. Tailscale connected.',stage:'active',date:'Feb 21'},
      {id:uid(),name:'Drew Millington',company:'Nmbr / SystemsbyAI',notes:'Mac Mini installed. Freedom agent running. Tailscale connected.',stage:'active',date:'Feb 25'},
    ];
    saveLeads();
  }
  renderKanban();
  renderDocs();
  loadEmails();
  renderHealth();
  renderCalendly();
}

if(localStorage.getItem('mc_auth_brody')==='1'){document.getElementById('login').classList.add('hidden');init()}
</script>
</body>
</html>
