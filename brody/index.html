<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mission Control ‚Äî Sunday</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{
--bg:#070d14;--surface:#0c1520;--surface2:#111d2b;--surface3:#172536;
--border:#2a2a3a;--text:#e4e4e8;--text2:#9898b0;--accent:#0D1B2A;
--accent-light:#1a3050;--yellow:#f0c040;--green:#40c080;--blue:#4080f0;
--red:#f04060;--purple:#a060f0;--radius:10px;
}
body{font-family:'Inter',system-ui,sans-serif;background:var(--bg);color:var(--text);height:100dvh;overflow:hidden;display:flex;position:relative}
body::after{content:'';position:fixed;inset:0;pointer-events:none;z-index:0;opacity:.03;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E")}
a{color:var(--blue);text-decoration:none}
::-webkit-scrollbar{width:6px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:var(--surface3);border-radius:3px}
::-webkit-scrollbar-thumb:hover{background:var(--border)}
.sidebar{width:240px;background:var(--surface);border-right:1px solid var(--border);display:flex;flex-direction:column;flex-shrink:0;height:100vh;z-index:2}
.sidebar-logo{padding:20px;font-size:15px;font-weight:700;letter-spacing:1px;color:var(--text2);border-bottom:1px solid var(--border)}
.sidebar-logo span{color:var(--text)}
.sidebar-logo .sub{display:block;font-size:10px;font-weight:500;letter-spacing:2px;color:var(--text2);margin-top:4px;text-transform:uppercase}
.nav{flex:1;padding:12px;position:relative}
.nav-item{display:flex;align-items:center;gap:10px;padding:10px 14px;border-radius:8px;cursor:pointer;color:var(--text2);font-size:14px;font-weight:500;transition:all .2s cubic-bezier(.4,0,.2,1);position:relative}
.nav-item:hover{background:var(--surface2);color:var(--text)}
.nav-item.active{background:var(--accent-light);color:#fff}
.nav-item.active::before{content:'';position:absolute;left:-12px;top:50%;transform:translateY(-50%);width:3px;height:20px;background:var(--blue);border-radius:0 3px 3px 0;transition:all .3s cubic-bezier(.4,0,.2,1)}
.nav-item svg{width:18px;height:18px;opacity:.6;transition:opacity .2s}
.nav-item.active svg{opacity:1}
.nav-badge{position:absolute;right:10px;font-size:11px;font-weight:700;background:var(--surface3);color:var(--text2);padding:2px 8px;border-radius:10px;min-width:24px;text-align:center;transition:all .2s}
.nav-item.active .nav-badge{background:rgba(255,255,255,.15);color:#fff}
.sidebar-footer{padding:16px;border-top:1px solid var(--border)}
.btn-logout{width:100%;padding:8px;background:var(--surface2);border:1px solid var(--border);border-radius:6px;color:var(--text2);font-size:13px;cursor:pointer;font-family:inherit;transition:all .15s}
.btn-logout:hover{background:var(--surface3);color:var(--text)}
.btn-logout:active{transform:scale(.97)}
.main{flex:1;overflow-y:auto;-webkit-overflow-scrolling:touch;padding:32px 40px;position:relative;z-index:1;min-height:0}
.section{display:none;animation:fadeInSection .4s cubic-bezier(.4,0,.2,1)}
.section.active{display:block}
@keyframes fadeInSection{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
#login{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;z-index:100;background:linear-gradient(-45deg,#0a0a0f,#0d1520,#0a1228,#0f0a1a);background-size:400% 400%;animation:loginGradient 15s ease infinite}
#login.hidden{display:none}
@keyframes loginGradient{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
.login-box{background:rgba(18,18,26,.7);backdrop-filter:blur(24px);-webkit-backdrop-filter:blur(24px);border:1px solid rgba(42,42,58,.6);border-radius:16px;padding:48px;width:360px;text-align:center;animation:loginBoxIn .6s cubic-bezier(.4,0,.2,1)}
@keyframes loginBoxIn{from{opacity:0;transform:translateY(20px) scale(.96)}to{opacity:1;transform:translateY(0) scale(1)}}
.login-box h1{font-size:20px;margin-bottom:8px;font-weight:700}
.login-box p{color:var(--text2);font-size:13px;margin-bottom:24px}
.login-box input{width:100%;padding:12px 16px;background:var(--surface2);border:1px solid var(--border);border-radius:8px;color:var(--text);font-size:14px;font-family:inherit;outline:none;transition:all .3s cubic-bezier(.4,0,.2,1)}
.login-box input:focus{border-color:var(--blue);box-shadow:0 0 0 3px rgba(64,128,240,.15)}
.login-box button{width:100%;padding:12px;margin-top:12px;background:var(--accent);border:none;border-radius:8px;color:#fff;font-size:14px;font-weight:600;cursor:pointer;font-family:inherit;transition:all .15s}
.login-box button:hover{background:var(--accent-light)}
.login-box button:active{transform:scale(.97)}
.login-error{color:var(--red);font-size:12px;margin-top:8px;display:none}
.page-title{font-size:24px;font-weight:700;margin-bottom:4px;letter-spacing:-.02em}
.page-sub{color:var(--text2);font-size:14px;margin-bottom:28px;font-weight:400}
.mission-statement{background:linear-gradient(135deg,#0a1628,#162840,#1a3050);border:1px solid var(--border);border-radius:var(--radius);padding:28px;margin-bottom:28px;position:relative;overflow:hidden}
.mission-statement::before{content:'';position:absolute;top:0;right:0;width:200px;height:200px;background:radial-gradient(circle,rgba(64,128,240,.1),transparent);pointer-events:none}
.mission-statement h2{font-size:12px;color:var(--text2);font-weight:500;margin-bottom:8px;text-transform:uppercase;letter-spacing:2px}
.mission-statement p{font-size:18px;font-weight:500;line-height:1.6}
.mission-statement .mission-target{display:inline-block;margin-top:12px;font-size:13px;color:var(--blue);font-weight:600;padding:4px 12px;background:rgba(64,128,240,.1);border-radius:20px}
.stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:16px;margin-bottom:28px}
.stat-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:20px;position:relative;overflow:hidden;transition:all .25s cubic-bezier(.4,0,.2,1);opacity:0;animation:cardIn .5s cubic-bezier(.4,0,.2,1) forwards}
.stat-card:nth-child(1){animation-delay:.05s}.stat-card:nth-child(2){animation-delay:.1s}.stat-card:nth-child(3){animation-delay:.15s}.stat-card:nth-child(4){animation-delay:.2s}
.stat-card:hover{border-color:#3a3a4a;box-shadow:inset 0 0 30px rgba(255,255,255,.02)}
.stat-card::before{content:'';position:absolute;left:0;top:0;bottom:0;width:3px;border-radius:3px 0 0 3px}
.stat-card:nth-child(1)::before{background:linear-gradient(180deg,var(--yellow),rgba(240,192,64,.3))}
.stat-card:nth-child(2)::before{background:linear-gradient(180deg,var(--green),rgba(64,192,128,.3))}
.stat-card:nth-child(3)::before{background:linear-gradient(180deg,var(--blue),rgba(64,128,240,.3))}
.stat-card:nth-child(4)::before{background:linear-gradient(180deg,var(--purple),rgba(160,96,240,.3))}
.stat-card .label{font-size:11px;color:var(--text2);text-transform:uppercase;letter-spacing:1px;margin-bottom:8px;font-weight:500}
.stat-card .value{font-size:28px;font-weight:700;text-shadow:0 1px 2px rgba(0,0,0,.3)}
.stat-card .value.yellow{color:var(--yellow)}.stat-card .value.green{color:var(--green)}.stat-card .value.blue{color:var(--blue)}
.clock{font-size:13px;color:var(--text2);margin-bottom:24px;font-variant-numeric:tabular-nums}
@keyframes cardIn{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}
.feed-item{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:20px;margin-bottom:16px;transition:all .25s;opacity:0;animation:cardIn .5s cubic-bezier(.4,0,.2,1) forwards}
.feed-item:hover{border-color:#3a3a4a;box-shadow:inset 0 0 30px rgba(255,255,255,.015)}
.feed-item .feed-date{font-size:12px;color:var(--text2);margin-bottom:10px;font-weight:600;text-transform:uppercase;letter-spacing:1px}
.feed-item .feed-content{font-size:14px;line-height:1.7;color:var(--text);font-weight:400}
.feed-item .feed-content h1,.feed-item .feed-content h2,.feed-item .feed-content h3{margin:12px 0 6px;font-size:15px;font-weight:600}
.feed-item .feed-content ul{padding-left:20px;margin:6px 0}
.feed-item .feed-content code{background:var(--surface3);padding:2px 6px;border-radius:4px;font-size:12px}
.task-section-title{font-size:13px;font-weight:600;text-transform:uppercase;letter-spacing:1.5px;color:var(--text2);margin:24px 0 12px;padding-bottom:8px;border-bottom:1px solid var(--border)}
.task-section-title:first-child{margin-top:0}
.task-kanban-columns{display:flex;gap:14px;overflow-x:auto;padding-bottom:12px;min-height:300px}
.task-kanban-col{min-width:280px;flex:1;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);display:flex;flex-direction:column;max-height:70vh}
.task-kanban-col .kanban-col-header{padding:14px 16px 10px;font-size:12px;font-weight:700;text-transform:uppercase;letter-spacing:1px;display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid var(--border)}
.task-kanban-col .kanban-col-body{flex:1;overflow-y:auto;padding:10px;min-height:60px;transition:background .2s}
.task-kanban-col .kanban-col-body.drag-over{background:rgba(64,128,240,.08)}
.kc-count{font-size:11px;font-weight:600;background:var(--surface2);padding:2px 8px;border-radius:10px;color:var(--text2)}
.task-card{background:rgba(20,30,46,.7);backdrop-filter:blur(12px);border:1px solid var(--border);border-radius:8px;padding:12px;margin-bottom:8px;cursor:grab;transition:all .2s;user-select:none}
.task-card:hover{border-color:#3a3a4a;box-shadow:0 4px 16px rgba(0,0,0,.3)}
.task-card:active{cursor:grabbing}
.task-card.dragging{opacity:.4;transform:scale(.96)}
.task-card .tc-title{font-size:14px;font-weight:600;margin-bottom:4px}
.task-card .tc-desc{font-size:12px;color:var(--text2);margin-bottom:6px;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
.task-card .tc-meta{display:flex;flex-wrap:wrap;gap:4px;align-items:center}
.task-card .tc-priority{font-size:10px;font-weight:700;padding:2px 8px;border-radius:10px;color:#fff}
.tc-priority.p-high{background:var(--red)}
.tc-priority.p-medium{background:var(--yellow);color:#000}
.tc-priority.p-low{background:var(--surface3);color:var(--text2)}
.task-card .tc-cat{font-size:10px;padding:2px 7px;border-radius:10px;background:var(--surface2);color:var(--text2)}
.task-card .tc-due{font-size:10px;color:var(--text2);margin-left:auto}
.tc-due.overdue{color:var(--red);font-weight:600}
.task-modal{position:fixed;inset:0;background:rgba(0,0,0,.6);backdrop-filter:blur(4px);z-index:150;display:none;align-items:center;justify-content:center}
.task-modal.open{display:flex}
.task-modal-content{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:28px;max-width:520px;width:90%;max-height:80vh;overflow-y:auto;animation:cardIn .3s ease}
.task-add-bar{margin-bottom:16px;display:flex;gap:8px}
.search-input{padding:9px 14px 9px 36px;background:var(--surface);border:1px solid var(--border);border-radius:8px;color:var(--text);font-size:13px;font-family:inherit;outline:none;width:260px;transition:all .25s cubic-bezier(.4,0,.2,1)}
.search-input:focus{border-color:var(--blue);box-shadow:0 0 0 3px rgba(64,128,240,.1)}
.search-wrap{position:relative}
.search-wrap svg{position:absolute;left:11px;top:50%;transform:translateY(-50%);width:16px;height:16px;color:var(--text2);pointer-events:none}
.km-delete-btn{padding:10px 20px;border-radius:8px;border:1px solid var(--red);background:transparent;color:var(--red);font-size:13px;font-weight:600;cursor:pointer;font-family:inherit;transition:all .15s;width:100%;margin-top:8px}
.km-delete-btn:hover{background:rgba(240,64,96,.15)}
/* Messages */
.msg-item{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:20px;margin-bottom:12px;opacity:0;animation:cardIn .4s cubic-bezier(.4,0,.2,1) forwards}
.msg-item:hover{border-color:#3a3a4a}
.msg-item .msg-from{font-size:12px;color:var(--blue);font-weight:600;margin-bottom:4px;text-transform:uppercase;letter-spacing:.5px}
.msg-item .msg-time{font-size:11px;color:var(--text2);float:right}
.msg-item .msg-body{font-size:14px;line-height:1.6;color:var(--text)}
/* Notes */
.note-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:20px;margin-bottom:12px;cursor:pointer;transition:all .25s;opacity:0;animation:cardIn .4s cubic-bezier(.4,0,.2,1) forwards}
.note-card:hover{border-color:#3a3a4a;transform:translateY(-2px);box-shadow:0 4px 16px rgba(0,0,0,.2)}
.note-card .note-title{font-size:15px;font-weight:600;margin-bottom:6px}
.note-card .note-preview{font-size:13px;color:var(--text2);line-height:1.5;display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden}
.note-card .note-meta{font-size:11px;color:var(--text2);margin-top:8px}
/* Note editor */
.note-editor{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:0;overflow:hidden}
.note-editor textarea{width:100%;min-height:400px;padding:20px;background:transparent;border:none;color:var(--text);font-size:14px;font-family:inherit;line-height:1.7;resize:vertical;outline:none}
/* Settings */
.settings-section{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:24px;margin-bottom:16px}
.settings-section h3{font-size:14px;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:var(--text2);margin-bottom:16px}
.settings-row{display:flex;align-items:center;justify-content:space-between;padding:10px 0;border-bottom:1px solid var(--border);font-size:14px}
.settings-row:last-child{border:none}
.settings-row .label{color:var(--text);font-weight:500}
.settings-row .value{color:var(--text2);font-size:13px}
/* Modal */
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.6);backdrop-filter:blur(4px);-webkit-backdrop-filter:blur(4px);z-index:50;display:flex;align-items:center;justify-content:center;opacity:0;pointer-events:none;transition:opacity .25s cubic-bezier(.4,0,.2,1)}
.modal-overlay.open{opacity:1;pointer-events:auto}
.modal{background:var(--surface);border:1px solid var(--border);border-radius:16px;padding:32px;width:480px;max-width:90vw;max-height:85vh;overflow-y:auto;transform:translateY(20px) scale(.96);transition:all .3s cubic-bezier(.4,0,.2,1)}
.modal-overlay.open .modal{transform:translateY(0) scale(1)}
.modal h2{font-size:18px;font-weight:700;margin-bottom:20px}
.modal label{display:block;font-size:11px;font-weight:500;color:var(--text2);text-transform:uppercase;letter-spacing:1px;margin-bottom:6px;margin-top:16px}
.modal label:first-of-type{margin-top:0}
.modal input[type="text"],.modal textarea,.modal select{width:100%;padding:10px 14px;background:var(--surface2);border:1px solid var(--border);border-radius:8px;color:var(--text);font-size:14px;font-family:inherit;outline:none;transition:all .2s}
.modal input[type="text"]:focus,.modal textarea:focus,.modal select:focus{border-color:var(--blue);box-shadow:0 0 0 3px rgba(64,128,240,.1)}
.modal textarea{resize:vertical;min-height:60px}
.modal select{appearance:none;cursor:pointer}
.modal-actions{display:flex;gap:10px;margin-top:24px;justify-content:flex-end}
.modal-btn{padding:10px 20px;border-radius:8px;font-size:14px;font-weight:600;cursor:pointer;font-family:inherit;border:none;transition:all .15s}
.modal-btn:active{transform:scale(.96)}
.modal-btn.primary{background:var(--blue);color:#fff}
.modal-btn.primary:hover{background:#5090ff}
.modal-btn.secondary{background:var(--surface2);color:var(--text2);border:1px solid var(--border)}
.modal-btn.secondary:hover{background:var(--surface3);color:var(--text)}
.sync-footer{position:fixed;bottom:0;left:240px;right:0;padding:8px 20px;background:var(--surface);border-top:1px solid var(--border);font-size:11px;color:var(--text2);display:flex;align-items:center;gap:8px;z-index:10}
.sync-dot{width:6px;height:6px;border-radius:50%;flex-shrink:0}
.sync-dot.fresh{background:var(--green);animation:syncPulse 2s ease-in-out infinite}
.sync-dot.stale{background:var(--yellow)}
.sync-dot.old{background:var(--red)}
@keyframes syncPulse{0%,100%{opacity:1;transform:scale(1)}50%{opacity:.7;transform:scale(1.3)}}
.toast{position:fixed;bottom:60px;left:50%;transform:translateX(-50%) translateY(20px);background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:10px 20px;font-size:13px;color:var(--text);box-shadow:0 8px 24px rgba(0,0,0,.4);opacity:0;transition:all .4s cubic-bezier(.175,.885,.32,1.275);z-index:60;pointer-events:none;white-space:nowrap}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0)}
.empty-state{text-align:center;padding:60px 20px;color:var(--text2)}
.empty-state svg{width:48px;height:48px;opacity:.3;margin-bottom:16px}
.empty-state .empty-title{font-size:16px;font-weight:600;color:var(--text);opacity:.5;margin-bottom:8px}
.skeleton{background:linear-gradient(90deg,var(--surface) 25%,var(--surface2) 50%,var(--surface) 75%);background-size:200% 100%;animation:shimmer 1.5s ease-in-out infinite;border-radius:var(--radius);height:80px;margin-bottom:16px}
@keyframes shimmer{0%{background-position:200% 0}100%{background-position:-200% 0}}
.fab{position:fixed;bottom:28px;right:28px;width:52px;height:52px;border-radius:50%;background:var(--blue);color:#fff;border:none;font-size:24px;cursor:pointer;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 16px rgba(64,128,240,.4);transition:all .2s cubic-bezier(.4,0,.2,1);z-index:30;font-family:inherit;animation:fabPulse 3s ease-in-out infinite}
.fab:hover{transform:scale(1.1);box-shadow:0 6px 24px rgba(64,128,240,.5);animation:none}
.fab:active{transform:scale(.95)}
@keyframes fabPulse{0%,100%{box-shadow:0 4px 16px rgba(64,128,240,.4)}50%{box-shadow:0 4px 24px rgba(64,128,240,.6)}}
.menu-toggle{display:none;position:fixed;top:12px;left:12px;z-index:50;background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:8px 12px;color:var(--text);cursor:pointer;font-size:18px}
.mobile-tabs{display:none;position:fixed;bottom:0;left:0;right:0;background:var(--surface);border-top:1px solid var(--border);z-index:40;padding:4px 0;padding-bottom:env(safe-area-inset-bottom,4px)}
.mobile-tabs-inner{display:flex;justify-content:space-around;align-items:center}
.mobile-tab{display:flex;flex-direction:column;align-items:center;gap:2px;padding:6px 8px;border-radius:8px;cursor:pointer;color:var(--text2);font-size:10px;font-weight:500;transition:all .2s;border:none;background:none;font-family:inherit;min-width:0;flex:1}
.mobile-tab svg{width:20px;height:20px}
.mobile-tab.active{color:var(--blue)}
.mobile-tab:active{transform:scale(.9)}
@media(max-width:1024px){
  body{height:auto;overflow:auto;display:block;-webkit-overflow-scrolling:touch}
  .sidebar{position:fixed;left:-260px;top:0;height:100%;z-index:40;transition:left .3s cubic-bezier(.4,0,.2,1)}
  .sidebar.open{left:0}
  .menu-toggle{display:block}
  .mobile-tabs{display:block}
  .main{padding:20px 16px;padding-top:56px;padding-bottom:72px;overflow:visible;height:auto;min-height:auto}
  .section.active{display:block;overflow:visible}
  .stats-grid{grid-template-columns:1fr 1fr}
  .sync-footer{display:none}
  .fab{bottom:80px;right:16px}
  .task-kanban-columns{flex-direction:column}
  .task-kanban-col{min-width:100%;max-height:none}
}
@media(min-width:1025px) and (pointer:coarse){
  body{height:auto;overflow:auto;-webkit-overflow-scrolling:touch}
  .main{overflow:visible;height:auto;min-height:auto}
}
</style>
</head>
<body>

<div id="login">
  <div class="login-box">
    <h1>Mission Control</h1>
    <p>Sunday ‚Äî Autonomous Operations</p>
    <input type="password" id="pw" placeholder="Password" autofocus>
    <button onclick="tryLogin()">Enter</button>
    <div class="login-error" id="login-error">Incorrect password</div>
  </div>
</div>

<button class="menu-toggle" onclick="document.querySelector('.sidebar').classList.toggle('open')">‚ò∞</button>

<nav class="sidebar">
  <div class="sidebar-logo">
    <span>SUNDAY</span>
    <span class="sub">Mission Control</span>
  </div>
  <div class="nav">
    <div class="nav-item active" data-section="overview" onclick="showSection('overview')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg>
      Overview
    </div>
    <div class="nav-item" data-section="tasks" onclick="showSection('tasks')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 11l3 3L22 4"/><path d="M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11"/></svg>
      Tasks <span class="nav-badge" id="tasks-badge">0</span>
    </div>
    <div class="nav-item" data-section="messages" onclick="showSection('messages')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/></svg>
      Messages <span class="nav-badge" id="messages-badge">0</span>
    </div>
    <div class="nav-item" data-section="notes" onclick="showSection('notes')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
      Notes <span class="nav-badge" id="notes-badge">0</span>
    </div>
    <div class="nav-item" data-section="settings" onclick="showSection('settings')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-2 2 2 2 0 01-2-2v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06A1.65 1.65 0 004.68 15a1.65 1.65 0 00-1.51-1H3a2 2 0 01-2-2 2 2 0 012-2h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 012.83-2.83l.06.06A1.65 1.65 0 009 4.68a1.65 1.65 0 001-1.51V3a2 2 0 012-2 2 2 0 012 2v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 2.83l-.06.06A1.65 1.65 0 0019.4 9a1.65 1.65 0 001.51 1H21a2 2 0 012 2 2 2 0 01-2 2h-.09a1.65 1.65 0 00-1.51 1z"/></svg>
      Settings
    </div>
  </div>
  <div class="sidebar-footer">
    <button class="btn-logout" onclick="logout()">‚Üê Logout</button>
  </div>
</nav>

<div class="main">

  <!-- OVERVIEW -->
  <div class="section active" id="sec-overview">
    <h1 class="page-title">Overview</h1>
    <div class="clock" id="clock"></div>
    <div class="mission-statement">
      <h2>Mission</h2>
      <p>Build and operate SolveWorks AI agent deployments that deliver 24/7 value to clients</p>
      <span class="mission-target">üéØ SolveWorks ¬∑ Client Installs ¬∑ Automation Builds</span>
    </div>
    <div class="stats-grid">
      <div class="stat-card"><div class="label">In Progress</div><div class="value yellow" id="stat-progress">‚Äî</div></div>
      <div class="stat-card"><div class="label">Completed</div><div class="value green" id="stat-completed">‚Äî</div></div>
      <div class="stat-card"><div class="label">Waiting</div><div class="value blue" id="stat-waiting">‚Äî</div></div>
      <div class="stat-card"><div class="label">Notes</div><div class="value" id="stat-notes">‚Äî</div></div>
    </div>
    <div id="overview-recent"></div>
  </div>

  <!-- TASKS -->
  <div class="section" id="sec-tasks">
    <h1 class="page-title">Tasks</h1>
    <p class="page-sub">Your work queue ‚Äî drag to reorder, click to edit</p>
    <div class="task-add-bar">
      <button onclick="openTaskAddModal()" style="padding:10px 20px;background:var(--blue);border:none;border-radius:8px;color:#fff;font-size:13px;font-weight:600;cursor:pointer;font-family:inherit;transition:all .15s">+ Add Task</button>
      <div class="search-wrap" style="flex:1">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/></svg>
        <input type="text" class="search-input" id="task-search" placeholder="Search tasks..." oninput="renderTaskKanban()" style="width:100%">
      </div>
    </div>
    <div id="task-kanban-container"><div class="skeleton"></div></div>
    <div id="task-modal" class="task-modal" onclick="if(event.target===this)this.classList.remove('open')">
      <div class="task-modal-content" id="task-modal-body"></div>
    </div>
  </div>

  <!-- MESSAGES -->
  <div class="section" id="sec-messages">
    <h1 class="page-title">Messages</h1>
    <p class="page-sub">Updates and notes from Sunday</p>
    <div id="messages-feed"><div class="skeleton"></div><div class="skeleton"></div></div>
  </div>

  <!-- NOTES -->
  <div class="section" id="sec-notes">
    <h1 class="page-title">Notes</h1>
    <p class="page-sub">Your workspace notes ‚Äî click to edit, + to create new</p>
    <div style="display:flex;gap:10px;margin-bottom:20px">
      <button onclick="openNoteEditor()" style="padding:10px 20px;background:var(--blue);border:none;border-radius:8px;color:#fff;font-size:13px;font-weight:600;cursor:pointer;font-family:inherit">+ New Note</button>
    </div>
    <div id="notes-list"></div>
    <div id="note-editor-modal" class="task-modal" onclick="if(event.target===this)this.classList.remove('open')">
      <div class="task-modal-content" id="note-editor-body" style="max-width:680px;width:90%"></div>
    </div>
  </div>

  <!-- SETTINGS -->
  <div class="section" id="sec-settings">
    <h1 class="page-title">Settings</h1>
    <p class="page-sub">Dashboard configuration and agent details</p>
    <div class="settings-section">
      <h3>Agent Info</h3>
      <div class="settings-row"><span class="label">Agent Name</span><span class="value">Sunday</span></div>
      <div class="settings-row"><span class="label">Operator</span><span class="value">Brody Schofield</span></div>
      <div class="settings-row"><span class="label">Platform</span><span class="value">SolveWorks</span></div>
      <div class="settings-row"><span class="label">Telegram</span><span class="value">@sunday37bot</span></div>
      <div class="settings-row"><span class="label">Status</span><span class="value" style="color:var(--green)">‚óè Active</span></div>
    </div>
    <div class="settings-section">
      <h3>Dashboard</h3>
      <div class="settings-row"><span class="label">Version</span><span class="value">1.0.0</span></div>
      <div class="settings-row"><span class="label">Last Sync</span><span class="value" id="settings-sync">‚Äî</span></div>
      <div class="settings-row" style="border:none">
        <span class="label">Actions</span>
        <div style="display:flex;gap:8px">
          <button onclick="clearLocalData()" style="padding:6px 14px;border-radius:6px;border:1px solid var(--border);background:var(--surface2);color:var(--text2);font-size:12px;cursor:pointer;font-family:inherit">Clear Local Data</button>
          <button onclick="logout()" style="padding:6px 14px;border-radius:6px;border:1px solid var(--red);background:transparent;color:var(--red);font-size:12px;cursor:pointer;font-family:inherit">Logout</button>
        </div>
      </div>
    </div>
  </div>

</div>

<button class="fab" onclick="openTaskAddModal()" title="New Task">+</button>

<div class="mobile-tabs">
  <div class="mobile-tabs-inner">
    <button class="mobile-tab active" data-section="overview" onclick="showSection('overview')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg>
      Home
    </button>
    <button class="mobile-tab" data-section="tasks" onclick="showSection('tasks')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 11l3 3L22 4"/><path d="M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11"/></svg>
      Tasks
    </button>
    <button class="mobile-tab" data-section="messages" onclick="showSection('messages')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/></svg>
      Messages
    </button>
    <button class="mobile-tab" data-section="notes" onclick="showSection('notes')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
      Notes
    </button>
    <button class="mobile-tab" data-section="settings" onclick="showSection('settings')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-2 2 2 2 0 01-2-2v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06A1.65 1.65 0 004.68 15a1.65 1.65 0 00-1.51-1H3a2 2 0 01-2-2 2 2 0 012-2h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 012.83-2.83l.06.06A1.65 1.65 0 009 4.68a1.65 1.65 0 001-1.51V3a2 2 0 012-2 2 2 0 012 2v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 2.83l-.06.06A1.65 1.65 0 0019.4 9a1.65 1.65 0 001.51 1H21a2 2 0 012 2 2 2 0 01-2 2h-.09a1.65 1.65 0 00-1.51 1z"/></svg>
      Settings
    </button>
  </div>
</div>

<!-- New Task Modal -->
<div class="modal-overlay" id="modal-new-task">
  <div class="modal">
    <h2>New Task</h2>
    <label>Title</label>
    <input type="text" id="new-task-name" placeholder="What needs to be done?">
    <label>Description (optional)</label>
    <textarea id="new-task-desc" placeholder="Any additional context..."></textarea>
    <label>Priority</label>
    <select id="new-task-priority">
      <option value="medium">Medium</option>
      <option value="high">High</option>
      <option value="low">Low</option>
    </select>
    <label>Status</label>
    <select id="new-task-status">
      <option value="todo">To Do</option>
      <option value="in-progress">In Progress</option>
      <option value="done">Done</option>
    </select>
    <label>Category</label>
    <input type="text" id="new-task-category" placeholder="e.g. SolveWorks, Client, Admin">
    <label>Due Date (optional)</label>
    <input type="text" id="new-task-due" placeholder="YYYY-MM-DD">
    <div class="modal-actions">
      <button class="modal-btn secondary" onclick="closeModal('modal-new-task')">Cancel</button>
      <button class="modal-btn primary" onclick="createTaskNew()">Create Task</button>
    </div>
  </div>
</div>

<div class="sync-footer" id="sync-footer">
  <span class="sync-dot fresh" id="sync-dot"></span>
  <span id="sync-text">Synced</span>
</div>

<div class="toast" id="toast"></div>

<script>
const HASH = 'a5e3e63f6760004857f9621a0da90c59ee6e49bea6bf61b66d30abaa23439f48';
const AUTH_KEY = 'mc_auth_sunday';

async function sha256(s){const d=new TextEncoder().encode(s);const h=await crypto.subtle.digest('SHA-256',d);return Array.from(new Uint8Array(h)).map(b=>b.toString(16).padStart(2,'0')).join('')}
document.getElementById('pw').addEventListener('keydown',e=>{if(e.key==='Enter')tryLogin()});

async function tryLogin(){
  const pw=document.getElementById('pw').value;
  if(await sha256(pw)===HASH){
    localStorage.setItem(AUTH_KEY,'1');
    document.getElementById('login').classList.add('hidden');
    init();
  } else {
    document.getElementById('login-error').style.display='block';
    document.getElementById('pw').style.animation='shake .4s ease';
    setTimeout(()=>document.getElementById('pw').style.animation='',400);
  }
}
function logout(){localStorage.removeItem(AUTH_KEY);location.reload()}

function showSection(id){
  document.querySelectorAll('.section').forEach(s=>{s.classList.remove('active');s.style.animation=''});
  document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));
  document.querySelectorAll('.mobile-tab').forEach(t=>t.classList.remove('active'));
  const sec=document.getElementById('sec-'+id);
  if(!sec)return;
  sec.style.animation='none';sec.offsetHeight;
  sec.style.animation='fadeInSection .4s cubic-bezier(.4,0,.2,1)';
  sec.classList.add('active');
  const navItem=document.querySelector(`.nav-item[data-section="${id}"]`);
  if(navItem)navItem.classList.add('active');
  const mobileTab=document.querySelector(`.mobile-tab[data-section="${id}"]`);
  if(mobileTab)mobileTab.classList.add('active');
  document.querySelector('.sidebar').classList.remove('open');
}

function updateClock(){
  const now=new Date();
  const et=now.toLocaleString('en-US',{timeZone:'America/Halifax',weekday:'long',year:'numeric',month:'long',day:'numeric',hour:'2-digit',minute:'2-digit',second:'2-digit'});
  document.getElementById('clock').textContent=et+' (Atlantic)';
}

function esc(s){const d=document.createElement('div');d.textContent=String(s||'');return d.innerHTML}
function toast(msg){const t=document.getElementById('toast');t.textContent=msg;t.classList.remove('show');void t.offsetWidth;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),2600)}
function closeModal(id){document.getElementById(id).classList.remove('open')}
function openModal(id){document.getElementById(id).classList.add('open')}
function emptyStateHTML(icon,title,desc){return `<div class="empty-state">${icon}<div class="empty-title">${title}</div><p>${desc}</p></div>`}
async function loadJSON(path){try{const r=await fetch(path+'?_='+Date.now());if(!r.ok)return null;return await r.json()}catch(e){console.warn('loadJSON failed for',path,e);return null}}
document.querySelectorAll('.modal-overlay').forEach(o=>{o.addEventListener('click',e=>{if(e.target===o)o.classList.remove('open')})});
document.addEventListener('keydown',e=>{if(e.key==='Escape')document.querySelectorAll('.modal-overlay.open,.task-modal.open').forEach(o=>o.classList.remove('open'))});

/* ‚îÄ‚îÄ‚îÄ Task Kanban ‚îÄ‚îÄ‚îÄ */
let taskItems=[];
const TASK_COLS=[{id:'todo',label:'To Do',color:'var(--blue)'},{id:'in-progress',label:'In Progress',color:'var(--yellow)'},{id:'done',label:'Done',color:'var(--green)'}];

function loadTaskItems(){try{taskItems=JSON.parse(localStorage.getItem('sunday-tasks'));if(!Array.isArray(taskItems))taskItems=null}catch(e){taskItems=null}}
function saveTaskItems(){localStorage.setItem('sunday-tasks',JSON.stringify(taskItems))}
function normalizeTaskStatus(s){if(!s)return 'todo';s=s.toLowerCase();if(s.includes('progress'))return 'in-progress';if(s.includes('done')||s.includes('complet'))return 'done';return 'todo'}

function initTaskItems(serverTasks){
  loadTaskItems();
  if(!taskItems){
    taskItems=(serverTasks||[]).map(t=>({...t,id:t.id||'t'+Math.random().toString(36).slice(2,8),status:normalizeTaskStatus(t.status),priority:t.priority||'medium',category:t.category||'',description:t.description||'',dueDate:t.dueDate||''}));
    saveTaskItems();
  }
}

function formatDue(d){const dt=new Date(d+'T00:00:00');const now=new Date();const diff=Math.ceil((dt-now)/(86400000));if(diff===0)return 'Today';if(diff===1)return 'Tomorrow';if(diff<0)return dt.toLocaleDateString('en-US',{month:'short',day:'numeric'});if(diff<=7)return dt.toLocaleDateString('en-US',{weekday:'short'});return dt.toLocaleDateString('en-US',{month:'short',day:'numeric'})}

function renderTaskKanban(){try{
  const search=(document.getElementById('task-search')?.value||'').toLowerCase();
  const counts={todo:0,'in-progress':0,done:0};
  let html='<div class="task-kanban-columns">';
  TASK_COLS.forEach(col=>{
    const items=taskItems.filter(t=>t.status===col.id&&(!search||(t.name||'').toLowerCase().includes(search)||(t.description||'').toLowerCase().includes(search)));
    counts[col.id]=items.length;
    html+=`<div class="task-kanban-col"><div class="kanban-col-header" style="color:${col.color}">${col.label} <span class="kc-count">${items.length}</span></div><div class="kanban-col-body" data-tcol="${col.id}" ondragover="event.preventDefault();this.classList.add('drag-over')" ondragleave="this.classList.remove('drag-over')" ondrop="handleTaskDrop(event,this)">`;
    items.forEach(t=>{
      const now=new Date();const overdue=t.dueDate&&new Date(t.dueDate+'T23:59:59')<now&&col.id!=='done';
      const dueLabel=t.dueDate?formatDue(t.dueDate):'';
      html+=`<div class="task-card" draggable="true" data-tid="${esc(t.id)}" ondragstart="dragTask(event)" onclick="openTaskDetail('${esc(t.id)}')">
        <div class="tc-title">${esc(t.name)}</div>
        ${t.description?`<div class="tc-desc">${esc(t.description)}</div>`:''}
        <div class="tc-meta">
          <span class="tc-priority p-${t.priority||'medium'}">${(t.priority||'medium').toUpperCase()}</span>
          ${t.category?`<span class="tc-cat">${esc(t.category)}</span>`:''}
          ${dueLabel?`<span class="tc-due${overdue?' overdue':''}">${overdue?'‚ö† ':''}${dueLabel}</span>`:''}
        </div></div>`;
    });
    html+=`</div></div>`;
  });
  html+=`</div>`;
  document.getElementById('task-kanban-container').innerHTML=html;
  const active=counts.todo+counts['in-progress'];
  document.getElementById('tasks-badge').textContent=active;
  document.getElementById('stat-progress').textContent=counts['in-progress'];
  document.getElementById('stat-completed').textContent=counts.done;
  document.getElementById('stat-waiting').textContent=counts.todo;
}catch(e){console.error('Task kanban error:',e)}}

window._taskDrag={};
function dragTask(e){const c=e.target.closest('.task-card');window._taskDrag={id:c.dataset.tid};c.classList.add('dragging');e.dataTransfer.effectAllowed='move'}
function handleTaskDrop(e,col){e.preventDefault();col.classList.remove('drag-over');const id=window._taskDrag.id;if(!id)return;const newStatus=col.dataset.tcol;const t=taskItems.find(x=>x.id===id);if(t&&t.status!==newStatus){t.status=newStatus;saveTaskItems();renderTaskKanban();toast('Moved to '+TASK_COLS.find(c=>c.id===newStatus).label)}document.querySelectorAll('.task-card.dragging').forEach(c=>c.classList.remove('dragging'))}
window.dragTask=dragTask;window.handleTaskDrop=handleTaskDrop;

function openTaskDetail(id){try{
  const t=taskItems.find(x=>x.id===id);if(!t)return;
  const m=document.getElementById('task-modal-body');
  const overdue=t.dueDate&&new Date(t.dueDate+'T23:59:59')<new Date()&&t.status!=='done';
  m.innerHTML=`
    <h2 style="margin-bottom:4px">${esc(t.name)}</h2>
    <div style="display:flex;gap:6px;align-items:center;margin-bottom:16px">
      <span class="tc-priority p-${t.priority||'medium'}" style="font-size:11px">${(t.priority||'medium').toUpperCase()}</span>
      ${t.category?`<span class="tc-cat">${esc(t.category)}</span>`:''}
      ${t.dueDate?`<span class="tc-due${overdue?' overdue':''}" style="font-size:12px">${overdue?'‚ö† Overdue ‚Äî ':'üìÖ '}${esc(t.dueDate)}</span>`:''}
    </div>
    <div style="margin-bottom:10px"><label style="font-size:11px;color:var(--text2);text-transform:uppercase;letter-spacing:1px;display:block;margin-bottom:4px">Title</label><input type="text" id="te-name" value="${esc(t.name)}" style="width:100%;padding:8px 12px;background:var(--surface2);border:1px solid var(--border);border-radius:6px;color:var(--text);font-size:14px;font-family:inherit"></div>
    <div style="margin-bottom:10px"><label style="font-size:11px;color:var(--text2);text-transform:uppercase;letter-spacing:1px;display:block;margin-bottom:4px">Description</label><textarea id="te-desc" style="width:100%;padding:8px 12px;background:var(--surface2);border:1px solid var(--border);border-radius:6px;color:var(--text);font-size:13px;font-family:inherit;min-height:60px;resize:vertical">${esc(t.description||'')}</textarea></div>
    <div style="display:flex;gap:12px;margin-top:8px">
      <div style="flex:1"><label style="font-size:11px;color:var(--text2);text-transform:uppercase;letter-spacing:1px;display:block;margin-bottom:4px">Priority</label><select id="te-priority" style="width:100%;padding:8px;background:var(--surface2);border:1px solid var(--border);border-radius:6px;color:var(--text);font-size:13px;font-family:inherit"><option value="high"${t.priority==='high'?' selected':''}>High</option><option value="medium"${(!t.priority||t.priority==='medium')?' selected':''}>Medium</option><option value="low"${t.priority==='low'?' selected':''}>Low</option></select></div>
      <div style="flex:1"><label style="font-size:11px;color:var(--text2);text-transform:uppercase;letter-spacing:1px;display:block;margin-bottom:4px">Due Date</label><input type="text" id="te-due" placeholder="YYYY-MM-DD" value="${esc(t.dueDate||'')}" style="width:100%;padding:8px;background:var(--surface2);border:1px solid var(--border);border-radius:6px;color:var(--text);font-size:13px;font-family:inherit"></div>
      <div style="flex:1"><label style="font-size:11px;color:var(--text2);text-transform:uppercase;letter-spacing:1px;display:block;margin-bottom:4px">Category</label><input type="text" id="te-cat" value="${esc(t.category||'')}" style="width:100%;padding:8px;background:var(--surface2);border:1px solid var(--border);border-radius:6px;color:var(--text);font-size:13px;font-family:inherit"></div>
    </div>
    <div style="margin-top:16px;padding-top:16px;border-top:1px solid var(--border)">
      <label style="font-size:11px;color:var(--text2);text-transform:uppercase;letter-spacing:1px;display:block;margin-bottom:6px">Move to</label>
      <div style="display:flex;flex-wrap:wrap;gap:6px">
        ${TASK_COLS.filter(c=>c.id!==t.status).map(c=>`<button onclick="moveTask('${t.id}','${c.id}')" style="padding:8px 16px;border-radius:8px;border:1px solid ${c.color};background:transparent;color:${c.color};font-size:12px;font-weight:600;cursor:pointer;font-family:inherit">${c.label}</button>`).join('')}
      </div>
    </div>
    <div style="display:flex;gap:8px;margin-top:16px">
      <button onclick="saveTaskEdit('${t.id}')" style="flex:1;padding:10px;border-radius:8px;background:var(--blue);border:none;color:#fff;font-size:13px;font-weight:600;cursor:pointer;font-family:inherit">Save Changes</button>
    </div>
    <button class="km-delete-btn" onclick="deleteTask('${t.id}')">üóë Delete Task</button>`;
  document.getElementById('task-modal').classList.add('open');
}catch(e){console.error('Task detail error:',e)}}
window.openTaskDetail=openTaskDetail;

function saveTaskEdit(id){const t=taskItems.find(x=>x.id===id);if(!t)return;t.name=document.getElementById('te-name').value.trim()||t.name;t.description=document.getElementById('te-desc').value.trim();t.priority=document.getElementById('te-priority').value;t.dueDate=document.getElementById('te-due').value.trim();t.category=document.getElementById('te-cat').value.trim();saveTaskItems();document.getElementById('task-modal').classList.remove('open');renderTaskKanban();toast('Task updated ‚úì')}
window.saveTaskEdit=saveTaskEdit;
function moveTask(id,status){const t=taskItems.find(x=>x.id===id);if(!t)return;t.status=status;saveTaskItems();document.getElementById('task-modal').classList.remove('open');renderTaskKanban();toast('Moved to '+TASK_COLS.find(c=>c.id===status).label)}
window.moveTask=moveTask;
function deleteTask(id){taskItems=taskItems.filter(x=>x.id!==id);saveTaskItems();document.getElementById('task-modal').classList.remove('open');renderTaskKanban();toast('Task deleted')}
window.deleteTask=deleteTask;

function openTaskAddModal(){
  document.getElementById('new-task-name').value='';document.getElementById('new-task-desc').value='';
  document.getElementById('new-task-priority').value='medium';document.getElementById('new-task-status').value='todo';
  document.getElementById('new-task-category').value='';document.getElementById('new-task-due').value='';
  openModal('modal-new-task');setTimeout(()=>document.getElementById('new-task-name').focus(),100);
}
window.openTaskAddModal=openTaskAddModal;

function createTaskNew(){
  const name=document.getElementById('new-task-name').value.trim();
  if(!name){toast('Title required');return}
  taskItems.push({id:'t'+Date.now().toString(36),name,description:document.getElementById('new-task-desc').value.trim(),priority:document.getElementById('new-task-priority').value,status:document.getElementById('new-task-status').value,category:document.getElementById('new-task-category').value.trim(),dueDate:document.getElementById('new-task-due').value.trim()});
  saveTaskItems();closeModal('modal-new-task');renderTaskKanban();toast('Task created ‚úì');
}
window.createTaskNew=createTaskNew;

/* ‚îÄ‚îÄ‚îÄ Notes ‚îÄ‚îÄ‚îÄ */
let notes=[];
function loadNotes(){try{notes=JSON.parse(localStorage.getItem('sunday-notes')||'[]')}catch(e){notes=[]}}
function saveNotes(){localStorage.setItem('sunday-notes',JSON.stringify(notes))}

function renderNotes(){
  loadNotes();
  document.getElementById('notes-badge').textContent=notes.length||'';
  document.getElementById('stat-notes').textContent=notes.length||'0';
  if(!notes.length){
    document.getElementById('notes-list').innerHTML=emptyStateHTML(
      '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>',
      'No notes yet','Click "+ New Note" to create your first note');
    return;
  }
  const sorted=[...notes].sort((a,b)=>(b.updatedAt||b.createdAt||'').localeCompare(a.updatedAt||a.createdAt||''));
  let html='';
  sorted.forEach((n,i)=>{
    html+=`<div class="note-card" style="animation-delay:${i*0.05}s" onclick="openNoteEditor('${n.id}')">
      <div class="note-title">${esc(n.title||'Untitled')}</div>
      <div class="note-preview">${esc(n.content||'')}</div>
      <div class="note-meta">${esc(n.updatedAt?new Date(n.updatedAt).toLocaleString('en-US',{month:'short',day:'numeric',hour:'numeric',minute:'2-digit'}):'')}${n.category?' ¬∑ '+esc(n.category):''}</div>
    </div>`;
  });
  document.getElementById('notes-list').innerHTML=html;
}

function openNoteEditor(id){
  const note=id?notes.find(n=>n.id===id):null;
  const m=document.getElementById('note-editor-body');
  m.innerHTML=`
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px">
      <h2 style="margin:0">${note?'Edit Note':'New Note'}</h2>
      ${note?`<button onclick="deleteNote('${note.id}')" style="padding:6px 12px;border-radius:6px;border:1px solid var(--red);background:transparent;color:var(--red);font-size:12px;cursor:pointer;font-family:inherit">Delete</button>`:''}
    </div>
    <input type="text" id="ne-title" value="${esc(note?.title||'')}" placeholder="Note title..." style="width:100%;padding:10px 14px;background:var(--surface2);border:1px solid var(--border);border-radius:8px;color:var(--text);font-size:14px;font-family:inherit;margin-bottom:12px">
    <input type="text" id="ne-cat" value="${esc(note?.category||'')}" placeholder="Category (optional)..." style="width:100%;padding:10px 14px;background:var(--surface2);border:1px solid var(--border);border-radius:8px;color:var(--text);font-size:13px;font-family:inherit;margin-bottom:12px">
    <textarea id="ne-content" placeholder="Write your note here..." style="width:100%;min-height:300px;padding:14px;background:var(--surface2);border:1px solid var(--border);border-radius:8px;color:var(--text);font-size:14px;font-family:inherit;line-height:1.7;resize:vertical">${esc(note?.content||'')}</textarea>
    <div style="display:flex;gap:10px;margin-top:16px">
      <button onclick="saveNote('${note?.id||''}')" style="flex:1;padding:12px;border-radius:8px;background:var(--blue);border:none;color:#fff;font-size:14px;font-weight:600;cursor:pointer;font-family:inherit">Save Note</button>
      <button onclick="document.getElementById('note-editor-modal').classList.remove('open')" style="padding:12px 20px;border-radius:8px;border:1px solid var(--border);background:var(--surface2);color:var(--text2);font-size:14px;cursor:pointer;font-family:inherit">Cancel</button>
    </div>`;
  document.getElementById('note-editor-modal').classList.add('open');
  setTimeout(()=>document.getElementById(note?'ne-content':'ne-title').focus(),100);
}
window.openNoteEditor=openNoteEditor;

function saveNote(id){
  const title=document.getElementById('ne-title').value.trim()||'Untitled';
  const content=document.getElementById('ne-content').value;
  const category=document.getElementById('ne-cat').value.trim();
  const now=new Date().toISOString();
  if(id){
    const n=notes.find(x=>x.id===id);
    if(n){n.title=title;n.content=content;n.category=category;n.updatedAt=now}
  } else {
    notes.push({id:'n'+Date.now(),title,content,category,createdAt:now,updatedAt:now});
  }
  saveNotes();document.getElementById('note-editor-modal').classList.remove('open');renderNotes();toast('Note saved ‚úì');
}
window.saveNote=saveNote;

function deleteNote(id){notes=notes.filter(n=>n.id!==id);saveNotes();document.getElementById('note-editor-modal').classList.remove('open');renderNotes();toast('Note deleted')}
window.deleteNote=deleteNote;

/* ‚îÄ‚îÄ‚îÄ Messages ‚îÄ‚îÄ‚îÄ */
async function renderMessages(){
  const data=await loadJSON('data/messages.json');
  const msgs=data?.messages||[];
  document.getElementById('messages-badge').textContent=msgs.length||'';
  if(!msgs.length){
    document.getElementById('messages-feed').innerHTML=emptyStateHTML(
      '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/></svg>',
      'No messages yet','Messages from Sunday will appear here after sync');
    return;
  }
  let html='';
  msgs.forEach((m,i)=>{
    html+=`<div class="msg-item" style="animation-delay:${i*0.05}s">
      <div class="msg-from">${esc(m.from||'Sunday')} <span class="msg-time">${esc(m.timestamp||m.date||'')}</span></div>
      <div class="msg-body">${marked.parse(m.content||m.body||m.text||'')}</div>
    </div>`;
  });
  document.getElementById('messages-feed').innerHTML=html;
}

/* ‚îÄ‚îÄ‚îÄ Sync Status ‚îÄ‚îÄ‚îÄ */
function updateSyncStatus(ts){
  const dot=document.getElementById('sync-dot');const text=document.getElementById('sync-text');
  const el=document.getElementById('settings-sync');
  if(!ts){if(text)text.textContent='Sync status unknown';if(dot)dot.className='sync-dot stale';return}
  const tsStr=typeof ts==='string'?ts:new Date(ts).toLocaleString();
  if(el)el.textContent=tsStr;
  const ago=Date.now()-new Date(ts).getTime();const mins=Math.floor(ago/60000);
  if(mins<10){if(dot)dot.className='sync-dot fresh';if(text)text.textContent=`Synced ${mins<1?'just now':mins+'m ago'}`}
  else if(mins<60){if(dot)dot.className='sync-dot stale';if(text)text.textContent=`‚ö† Data is ${mins}m old`}
  else{if(dot)dot.className='sync-dot old';if(text)text.textContent=`‚ö† Data is ${Math.floor(mins/60)}h old`}
}

/* ‚îÄ‚îÄ‚îÄ Overview Recent Activity ‚îÄ‚îÄ‚îÄ */
async function renderOverviewRecent(){
  const data=await loadJSON('data/memory-recent.json');
  const entries=(data?.entries||[]).slice(0,3);
  if(!entries.length){
    document.getElementById('overview-recent').innerHTML=`<div class="task-section-title">Recent Activity</div>`+emptyStateHTML(
      '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>',
      'No recent activity','Activity will appear here after sync');
    return;
  }
  let html='<div class="task-section-title">Recent Activity</div>';
  entries.forEach((e,i)=>{
    html+=`<div class="feed-item" style="animation-delay:${(i+4)*0.05}s"><div class="feed-date">${esc(e.date||'')}</div><div class="feed-content">${marked.parse(e.content||'')}</div></div>`;
  });
  document.getElementById('overview-recent').innerHTML=html;
}

function clearLocalData(){
  if(!confirm('Clear all local task, note, and state data? This cannot be undone.'))return;
  localStorage.removeItem('sunday-tasks');localStorage.removeItem('sunday-notes');
  toast('Local data cleared ‚Äî reloading...');
  setTimeout(()=>location.reload(),1200);
}
window.clearLocalData=clearLocalData;

async function init(){
  updateClock();setInterval(updateClock,1000);

  const dash=await loadJSON('data/dashboard.json');
  if(dash)updateSyncStatus(dash.lastSync||dash.timestamp);

  const tasks=await loadJSON('data/tasks.json');
  initTaskItems(tasks?.tasks||tasks||[]);
  renderTaskKanban();

  renderNotes();
  await renderMessages();
  await renderOverviewRecent();
}

if(localStorage.getItem(AUTH_KEY)==='1'){document.getElementById('login').classList.add('hidden');init()}
</script>
</body>
</html>
