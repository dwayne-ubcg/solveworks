<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mission Control ‚Äî [CLIENT]</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{
--bg:#070d14;--surface:#0c1520;--surface2:#111d2b;--surface3:#172536;
--border:#2a2a3a;--text:#e4e4e8;--text2:#9898b0;--accent:#0D1B2A;
--accent-light:#1a3050;--yellow:#f0c040;--green:#40c080;--blue:#4080f0;
--red:#f04060;--purple:#a060f0;--radius:10px;
}
body{font-family:'Inter',system-ui,sans-serif;background:var(--bg);color:var(--text);height:100dvh;overflow:hidden;display:flex;position:relative}
body::after{content:'';position:fixed;inset:0;pointer-events:none;z-index:0;opacity:.03;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E")}
a{color:var(--blue);text-decoration:none}
::-webkit-scrollbar{width:6px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:var(--surface3);border-radius:3px}
::-webkit-scrollbar-thumb:hover{background:var(--border)}

/* Sidebar */
.sidebar{width:240px;background:var(--surface);border-right:1px solid var(--border);display:flex;flex-direction:column;flex-shrink:0;height:100vh;z-index:2}
.sidebar-logo{padding:20px;font-size:15px;font-weight:700;letter-spacing:1px;color:var(--text2);border-bottom:1px solid var(--border)}
.sidebar-logo span{color:var(--text)}
.sidebar-logo .sub{display:block;font-size:10px;font-weight:500;letter-spacing:2px;color:var(--text2);margin-top:4px;text-transform:uppercase}
.nav{flex:1;padding:12px;position:relative}
.nav-item{display:flex;align-items:center;gap:10px;padding:10px 14px;border-radius:8px;cursor:pointer;color:var(--text2);font-size:14px;font-weight:500;transition:all .2s cubic-bezier(.4,0,.2,1);position:relative}
.nav-item:hover{background:var(--surface2);color:var(--text)}
.nav-item.active{background:var(--accent-light);color:#fff}
.nav-item.active::before{content:'';position:absolute;left:-12px;top:50%;transform:translateY(-50%);width:3px;height:20px;background:var(--blue);border-radius:0 3px 3px 0}
.nav-item svg{width:18px;height:18px;opacity:.6;transition:opacity .2s}
.nav-item.active svg{opacity:1}
.nav-badge{position:absolute;right:10px;font-size:11px;font-weight:700;background:var(--surface3);color:var(--text2);padding:2px 8px;border-radius:10px;min-width:24px;text-align:center}
.nav-item.active .nav-badge{background:rgba(255,255,255,.15);color:#fff}
.sidebar-footer{padding:16px;border-top:1px solid var(--border)}
.btn-logout{width:100%;padding:8px;background:var(--surface2);border:1px solid var(--border);border-radius:6px;color:var(--text2);font-size:13px;cursor:pointer;font-family:inherit;transition:all .15s}
.btn-logout:hover{background:var(--surface3);color:var(--text)}

/* Main */
.main{flex:1;overflow-y:auto;-webkit-overflow-scrolling:touch;padding:32px 40px;position:relative;z-index:1;min-height:0}
.section{display:none;animation:fadeInSection .4s cubic-bezier(.4,0,.2,1)}
.section.active{display:block}
@keyframes fadeInSection{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}

/* Login */
#login{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;z-index:100;background:linear-gradient(-45deg,#0a0a0f,#0d1520,#0a1228,#0f0a1a);background-size:400% 400%;animation:loginGradient 15s ease infinite}
#login.hidden{display:none}
@keyframes loginGradient{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
.login-box{background:rgba(18,18,26,.7);backdrop-filter:blur(24px);border:1px solid rgba(42,42,58,.6);border-radius:16px;padding:48px;width:360px;text-align:center;animation:loginBoxIn .6s cubic-bezier(.4,0,.2,1)}
@keyframes loginBoxIn{from{opacity:0;transform:translateY(20px) scale(.96)}to{opacity:1;transform:translateY(0) scale(1)}}
.login-box h1{font-size:20px;margin-bottom:8px;font-weight:700}
.login-box p{color:var(--text2);font-size:13px;margin-bottom:24px}
.login-box input{width:100%;padding:12px 16px;background:var(--surface2);border:1px solid var(--border);border-radius:8px;color:var(--text);font-size:14px;font-family:inherit;outline:none;transition:all .3s}
.login-box input:focus{border-color:var(--blue);box-shadow:0 0 0 3px rgba(64,128,240,.15)}
.login-box button{width:100%;padding:12px;margin-top:12px;background:var(--accent);border:none;border-radius:8px;color:#fff;font-size:14px;font-weight:600;cursor:pointer;font-family:inherit;transition:all .15s}
.login-box button:hover{background:var(--accent-light)}
.login-error{color:var(--red);font-size:12px;margin-top:8px;display:none}

/* Dashboard stats */
.page-title{font-size:24px;font-weight:700;margin-bottom:4px;letter-spacing:-.02em}
.page-sub{color:var(--text2);font-size:14px;margin-bottom:28px;font-weight:400}
.clock{font-size:13px;color:var(--text2);margin-bottom:24px;font-variant-numeric:tabular-nums}
.mission-statement{background:linear-gradient(135deg,#0a1628,#162840,#1a3050);border:1px solid var(--border);border-radius:var(--radius);padding:28px;margin-bottom:28px;position:relative;overflow:hidden}
.mission-statement::before{content:'';position:absolute;top:0;right:0;width:200px;height:200px;background:radial-gradient(circle,rgba(64,128,240,.1),transparent);pointer-events:none}
.mission-statement h2{font-size:12px;color:var(--text2);font-weight:500;margin-bottom:8px;text-transform:uppercase;letter-spacing:2px}
.mission-statement p{font-size:18px;font-weight:500;line-height:1.6}
.mission-statement .mission-target{display:inline-block;margin-top:12px;font-size:13px;color:var(--blue);font-weight:600;padding:4px 12px;background:rgba(64,128,240,.1);border-radius:20px}
.stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:16px;margin-bottom:28px}
.stat-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:20px;position:relative;overflow:hidden;transition:all .25s;opacity:0;animation:cardIn .5s cubic-bezier(.4,0,.2,1) forwards}
.stat-card:nth-child(1){animation-delay:.05s}
.stat-card:nth-child(2){animation-delay:.1s}
.stat-card:nth-child(3){animation-delay:.15s}
.stat-card:nth-child(4){animation-delay:.2s}
.stat-card::before{content:'';position:absolute;left:0;top:0;bottom:0;width:3px;border-radius:3px 0 0 3px}
.stat-card:nth-child(1)::before{background:linear-gradient(180deg,var(--yellow),rgba(240,192,64,.3))}
.stat-card:nth-child(2)::before{background:linear-gradient(180deg,var(--green),rgba(64,192,128,.3))}
.stat-card:nth-child(3)::before{background:linear-gradient(180deg,var(--blue),rgba(64,128,240,.3))}
.stat-card:nth-child(4)::before{background:linear-gradient(180deg,var(--purple),rgba(160,96,240,.3))}
.stat-card .label{font-size:11px;color:var(--text2);text-transform:uppercase;letter-spacing:1px;margin-bottom:8px;font-weight:500}
.stat-card .value{font-size:28px;font-weight:700}
.stat-card .value.yellow{color:var(--yellow)}
.stat-card .value.green{color:var(--green)}
.stat-card .value.blue{color:var(--blue)}
@keyframes cardIn{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}

/* Feed items */
.feed-item{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:20px;margin-bottom:16px;transition:all .25s;opacity:0;animation:cardIn .5s cubic-bezier(.4,0,.2,1) forwards}
.feed-item:hover{border-color:#3a3a4a}
.feed-item .feed-date{font-size:12px;color:var(--text2);margin-bottom:10px;font-weight:600;text-transform:uppercase;letter-spacing:1px}
.feed-item .feed-content{font-size:14px;line-height:1.7;color:var(--text)}
.feed-item .feed-content h1,.feed-item .feed-content h2,.feed-item .feed-content h3{margin:12px 0 6px;font-size:15px;font-weight:600}
.feed-item .feed-content ul{padding-left:20px;margin:6px 0}
.feed-item .feed-content code{background:var(--surface3);padding:2px 6px;border-radius:4px;font-size:12px}

/* Tasks */
.task-section-title{font-size:13px;font-weight:600;text-transform:uppercase;letter-spacing:1.5px;color:var(--text2);margin:24px 0 12px;padding-bottom:8px;border-bottom:1px solid var(--border)}
.task-section-title:first-child{margin-top:0}
.task{background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:14px 18px;margin-bottom:8px;transition:all .25s;opacity:0;animation:cardIn .4s cubic-bezier(.4,0,.2,1) forwards}
.task:hover{border-color:#3a3a4a;transform:translateY(-2px);box-shadow:0 4px 16px rgba(0,0,0,.2)}
.task-row{display:flex;align-items:center;gap:12px}
.task.completed-local .task-name{text-decoration:line-through;opacity:.5}
.badge{font-size:11px;font-weight:600;padding:3px 10px;border-radius:20px;text-transform:uppercase;letter-spacing:.5px;flex-shrink:0}
.badge.in-progress{background:rgba(240,192,64,.15);color:var(--yellow)}
.badge.completed{background:rgba(64,192,128,.15);color:var(--green)}
.badge.waiting{background:rgba(64,128,240,.15);color:var(--blue)}
.task-name{font-size:14px;font-weight:500;flex:1;min-width:0}
.task-actions{display:flex;align-items:center;gap:6px;flex-shrink:0}
.task-btn{padding:4px 10px;background:var(--surface2);border:1px solid var(--border);border-radius:6px;color:var(--text2);font-size:11px;font-weight:600;cursor:pointer;font-family:inherit;transition:all .15s;white-space:nowrap}
.task-btn:hover{background:var(--surface3);color:var(--text)}
.task-btn.done{border-color:rgba(64,192,128,.3);color:var(--green)}
.task-btn.done:hover{background:rgba(64,192,128,.15)}
.task-note{margin-top:8px;padding:8px 12px;background:var(--surface2);border-radius:6px;font-size:12px;color:var(--text2);line-height:1.5}
.task-note-input{width:100%;padding:8px 12px;background:var(--surface2);border:1px solid var(--border);border-radius:6px;color:var(--text);font-size:12px;font-family:inherit;outline:none;resize:none;margin-top:8px;display:none;transition:border-color .2s}
.task-note-input:focus{border-color:var(--blue)}
.filter-bar{display:flex;align-items:center;gap:12px;margin-bottom:20px;flex-wrap:wrap}
.search-input{padding:9px 14px 9px 36px;background:var(--surface);border:1px solid var(--border);border-radius:8px;color:var(--text);font-size:13px;font-family:inherit;outline:none;width:260px;transition:all .25s}
.search-input:focus{border-color:var(--blue);box-shadow:0 0 0 3px rgba(64,128,240,.1)}
.search-wrap{position:relative}
.search-wrap svg{position:absolute;left:11px;top:50%;transform:translateY(-50%);width:16px;height:16px;color:var(--text2);pointer-events:none}
.avatar{width:26px;height:26px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:10px;font-weight:700;flex-shrink:0;color:#fff;cursor:pointer;transition:all .2s}
.avatar:hover{transform:scale(1.15)}
.avatar.unassigned{background:var(--surface3);color:var(--text2);border:1px dashed var(--border)}
.assign-pos{position:relative}
.assign-dropdown{position:absolute;top:100%;right:0;background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:6px;min-width:160px;z-index:20;box-shadow:0 8px 24px rgba(0,0,0,.4);display:none}
.assign-dropdown.open{display:block}
.assign-option{display:flex;align-items:center;gap:8px;padding:6px 10px;border-radius:6px;cursor:pointer;font-size:13px;color:var(--text2);transition:background .1s}
.assign-option:hover{background:var(--surface2);color:var(--text)}

/* Agents */
.agents-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:16px}
.agent-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:24px;transition:all .25s;opacity:0;animation:cardIn .5s cubic-bezier(.4,0,.2,1) forwards}
.agent-card:hover{border-color:#3a3a4a;transform:translateY(-2px);box-shadow:0 4px 16px rgba(0,0,0,.2)}
.agent-card .agent-name{font-size:18px;font-weight:700;margin-bottom:4px}
.agent-card .agent-role{font-size:13px;color:var(--text2);margin-bottom:14px}
.agent-card .agent-desc{font-size:14px;line-height:1.6;color:var(--text)}
.agent-status{display:inline-block;font-size:11px;font-weight:600;padding:3px 10px;border-radius:20px;margin-bottom:12px;letter-spacing:.5px;text-transform:uppercase}
.agent-status.active{background:rgba(64,192,128,.15);color:var(--green)}
.agent-status.standby{background:rgba(64,128,240,.15);color:var(--blue)}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}
.agent-status.active::before{content:'';display:inline-block;width:6px;height:6px;border-radius:50%;background:var(--green);margin-right:6px;animation:pulse 2s ease-in-out infinite}

/* Security */
.security-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:20px;margin-bottom:12px}
.security-status-badge{display:inline-block;font-size:12px;font-weight:600;padding:4px 12px;border-radius:20px;margin-bottom:12px;letter-spacing:.5px}
.security-status-badge.ok{background:rgba(64,192,128,.15);color:var(--green)}
.security-status-badge.warn{background:rgba(240,192,64,.15);color:var(--yellow)}
.security-status-badge.alert{background:rgba(240,64,96,.15);color:var(--red)}

/* Meetings */
.meeting-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:20px;margin-bottom:12px;opacity:0;animation:cardIn .4s cubic-bezier(.4,0,.2,1) forwards;transition:all .25s;border-left:3px solid transparent;cursor:pointer}
.meeting-card:hover{border-color:#3a3a4a;transform:translateY(-2px)}
.meeting-card.today{border-left-color:var(--green)}
.meeting-card.past{opacity:.5}
.meeting-card .meeting-title{font-size:15px;font-weight:600;margin-bottom:4px}
.meeting-card .meeting-meta{font-size:12px;color:var(--text2);display:flex;flex-wrap:wrap;gap:12px;margin-top:6px}
.meeting-badge{font-size:10px;font-weight:700;padding:2px 8px;border-radius:10px;text-transform:uppercase;letter-spacing:.5px}
.meeting-badge.today-badge{background:rgba(64,192,128,.15);color:var(--green)}
.meeting-badge.upcoming-badge{background:rgba(64,128,240,.15);color:var(--blue)}
.meeting-badge.past-badge{background:rgba(122,139,160,.15);color:var(--text2)}
.meeting-attendees{display:flex;gap:4px;flex-wrap:wrap;margin-top:8px}
.meeting-attendee{font-size:11px;padding:2px 8px;background:var(--surface2);border:1px solid var(--border);border-radius:12px;color:var(--text2)}
.meeting-details{max-height:0;overflow:hidden;transition:max-height .3s cubic-bezier(.4,0,.2,1)}
.meeting-card.expanded .meeting-details{max-height:600px}
.meeting-prep{margin-top:16px;padding-top:12px;border-top:1px solid var(--border)}
.meeting-prep h4{font-size:11px;text-transform:uppercase;letter-spacing:1px;color:var(--text2);margin-bottom:8px}
.prep-item{display:flex;align-items:flex-start;gap:8px;padding:8px 0;font-size:13px}
.prep-dot{width:8px;height:8px;border-radius:50%;margin-top:4px;flex-shrink:0}
.prep-dot.pending{background:var(--yellow)}.prep-dot.complete{background:var(--green)}.prep-dot.failed{background:var(--red)}
.prep-input-wrap{display:flex;gap:8px;margin-top:12px}
.prep-input{flex:1;padding:8px 12px;background:var(--surface);border:1px solid var(--border);border-radius:8px;color:var(--text);font-size:13px;font-family:inherit;outline:none}
.prep-input:focus{border-color:var(--blue)}
.prep-submit{padding:8px 16px;background:var(--blue);border:none;border-radius:8px;color:#fff;font-size:12px;font-weight:600;cursor:pointer;font-family:inherit}
.prep-submit:hover{background:#5090ff}

/* Documents */
.doc-folder{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);margin-bottom:8px;overflow:hidden}
.doc-folder-header{padding:14px 18px;cursor:pointer;display:flex;align-items:center;gap:10px;font-size:14px;font-weight:500;transition:background .15s}
.doc-folder-header:hover{background:var(--surface2)}
.doc-folder-header .arrow{transition:transform .25s;color:var(--text2);font-size:12px}
.doc-folder-header.open .arrow{transform:rotate(90deg)}
.doc-files{display:none;padding:0 18px 14px;margin-left:28px}
.doc-files.open{display:block}
.doc-file{padding:6px 0;font-size:13px;color:var(--text2);border-bottom:1px solid var(--border)}
.doc-file:last-child{border:none}

/* Sync footer */
@keyframes syncPulse{0%,100%{opacity:1;transform:scale(1)}50%{opacity:.7;transform:scale(1.3)}}
.sync-footer{position:fixed;bottom:0;left:240px;right:0;padding:8px 20px;background:var(--surface);border-top:1px solid var(--border);font-size:11px;color:var(--text2);display:flex;align-items:center;gap:8px;z-index:10}
.sync-dot{width:6px;height:6px;border-radius:50%;flex-shrink:0}
.sync-dot.fresh{background:var(--green);animation:syncPulse 2s ease-in-out infinite}
.sync-dot.stale{background:var(--yellow)}
.sync-dot.old{background:var(--red)}

/* FAB */
.fab{position:fixed;bottom:28px;right:28px;width:52px;height:52px;border-radius:50%;background:var(--blue);color:#fff;border:none;font-size:24px;cursor:pointer;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 16px rgba(64,128,240,.4);transition:all .2s;z-index:30;font-family:inherit}
.fab:hover{transform:scale(1.1)}
.fab:active{transform:scale(.95)}

/* Modal */
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.6);backdrop-filter:blur(4px);z-index:50;display:flex;align-items:center;justify-content:center;opacity:0;pointer-events:none;transition:opacity .25s}
.modal-overlay.open{opacity:1;pointer-events:auto}
.modal{background:var(--surface);border:1px solid var(--border);border-radius:16px;padding:32px;width:480px;max-width:90vw;max-height:85vh;overflow-y:auto;transform:translateY(20px) scale(.96);transition:all .3s}
.modal-overlay.open .modal{transform:translateY(0) scale(1)}
.modal h2{font-size:18px;font-weight:700;margin-bottom:20px}
.modal label{display:block;font-size:11px;font-weight:500;color:var(--text2);text-transform:uppercase;letter-spacing:1px;margin-bottom:6px;margin-top:16px}
.modal label:first-of-type{margin-top:0}
.modal input[type="text"],.modal textarea,.modal select{width:100%;padding:10px 14px;background:var(--surface2);border:1px solid var(--border);border-radius:8px;color:var(--text);font-size:14px;font-family:inherit;outline:none;transition:all .2s}
.modal input[type="text"]:focus,.modal textarea:focus,.modal select:focus{border-color:var(--blue)}
.modal textarea{resize:vertical;min-height:60px}
.modal-actions{display:flex;gap:10px;margin-top:24px;justify-content:flex-end}
.modal-btn{padding:10px 20px;border-radius:8px;font-size:14px;font-weight:600;cursor:pointer;font-family:inherit;border:none;transition:all .15s}
.modal-btn.primary{background:var(--blue);color:#fff}
.modal-btn.primary:hover{background:#5090ff}
.modal-btn.secondary{background:var(--surface2);color:var(--text2);border:1px solid var(--border)}
.modal-btn.secondary:hover{background:var(--surface3);color:var(--text)}

/* Toast */
.toast{position:fixed;bottom:60px;left:50%;transform:translateX(-50%) translateY(20px);background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:10px 20px;font-size:13px;color:var(--text);box-shadow:0 8px 24px rgba(0,0,0,.4);opacity:0;transition:all .4s cubic-bezier(.175,.885,.32,1.275);z-index:60;pointer-events:none;white-space:nowrap}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0)}

/* Empty state */
.empty-state{text-align:center;padding:60px 20px;color:var(--text2)}
.empty-state svg{width:48px;height:48px;opacity:.3;margin-bottom:16px}
.empty-state p{font-size:14px;line-height:1.6}
.empty-state .empty-title{font-size:16px;font-weight:600;color:var(--text);opacity:.5;margin-bottom:8px}

/* Skeleton */
.skeleton{background:linear-gradient(90deg,var(--surface) 25%,var(--surface2) 50%,var(--surface) 75%);background-size:200% 100%;animation:shimmer 1.5s ease-in-out infinite;border-radius:var(--radius);height:80px;margin-bottom:16px}
@keyframes shimmer{0%{background-position:200% 0}100%{background-position:-200% 0}}

/* Mobile */
.menu-toggle{display:none;position:fixed;top:12px;left:12px;z-index:50;background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:8px 12px;color:var(--text);cursor:pointer;font-size:18px}
.mobile-tabs{display:none;position:fixed;bottom:0;left:0;right:0;background:var(--surface);border-top:1px solid var(--border);z-index:40;padding:4px 0;padding-bottom:env(safe-area-inset-bottom,4px)}
.mobile-tabs-inner{display:flex;justify-content:space-around;align-items:center}
.mobile-tab{display:flex;flex-direction:column;align-items:center;gap:2px;padding:6px 8px;border-radius:8px;cursor:pointer;color:var(--text2);font-size:10px;font-weight:500;transition:all .2s;border:none;background:none;font-family:inherit;min-width:0;flex:1}
.mobile-tab svg{width:20px;height:20px}
.mobile-tab.active{color:var(--blue)}
@media(max-width:1024px){
  body{height:auto;overflow:auto;display:block}
  .sidebar{position:fixed;left:-260px;top:0;height:100%;z-index:40;transition:left .3s}
  .sidebar.open{left:0}
  .menu-toggle{display:block}
  .mobile-tabs{display:block}
  .main{padding:20px 16px;padding-top:56px;padding-bottom:72px;overflow:visible;height:auto;min-height:auto}
  .section.active{display:block;overflow:visible}
  .stats-grid{grid-template-columns:1fr 1fr}
  .agents-grid{grid-template-columns:1fr}
  .sync-footer{display:none}
  .fab{bottom:80px;right:16px}
  .filter-bar{flex-direction:column;align-items:stretch}
  .search-input{width:100%}
}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="login">
  <div class="login-box">
    <h1>Mission Control</h1>
    <!-- CUSTOMIZE: Update company name below -->
    <p>[CLIENT COMPANY] ‚Äî Autonomous Operations</p>
    <input type="password" id="pw" placeholder="Password" autofocus>
    <button onclick="tryLogin()">Enter</button>
    <div class="login-error" id="login-error">Incorrect password</div>
  </div>
</div>

<button class="menu-toggle" onclick="document.querySelector('.sidebar').classList.toggle('open')">‚ò∞</button>

<nav class="sidebar">
  <div class="sidebar-logo">
    <!-- CUSTOMIZE: Update client company name -->
    <span>[CLIENT]</span>
    <span class="sub">Mission Control</span>
  </div>
  <div class="nav">
    <!-- CORE PANELS ‚Äî always present -->
    <div class="nav-item active" data-section="dashboard" onclick="showSection('dashboard')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg>
      Dashboard
    </div>
    <div class="nav-item" data-section="activity" onclick="showSection('activity')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
      Activity Feed
    </div>
    <div class="nav-item" data-section="tasks" onclick="showSection('tasks')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 11l3 3L22 4"/><path d="M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11"/></svg>
      Tasks <span class="nav-badge" id="tasks-badge">0</span>
    </div>
    <div class="nav-item" data-section="meetings" onclick="showSection('meetings')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
      Meetings <span class="nav-badge" id="meetings-badge">0</span>
    </div>
    <div class="nav-item" data-section="documents" onclick="showSection('documents')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
      Documents <span class="nav-badge" id="docs-badge">0</span>
    </div>
    <div class="nav-item" data-section="agents" onclick="showSection('agents')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="8" r="4"/><path d="M20 21a8 8 0 10-16 0"/></svg>
      Agents
    </div>
    <div class="nav-item" data-section="security" onclick="showSection('security')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
      Security
    </div>

    <!-- OPTIONAL PANELS ‚Äî uncomment to activate. Add sync.sh entry + cron for each. -->

    <!-- PANEL: activity-feed (already above as core) -->

    <!-- PANEL: call-recordings -->
    <!--
    <div class="nav-item" data-section="calls" onclick="showSection('calls')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07 19.5 19.5 0 01-6-6 19.79 19.79 0 01-3.07-8.67A2 2 0 014.11 2h3a2 2 0 012 1.72 12.84 12.84 0 00.7 2.81 2 2 0 01-.45 2.11L8.09 9.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45 12.84 12.84 0 002.81.7A2 2 0 0122 16.92z"/></svg>
      Call Recordings <span class="nav-badge" id="calls-badge">0</span>
    </div>
    -->

    <!-- PANEL: opportunity-intel -->
    <!--
    <div class="nav-item" data-section="intel" onclick="showSection('intel')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>
      Opportunity Intel
    </div>
    -->

    <!-- PANEL: health -->
    <!--
    <div class="nav-item" data-section="health" onclick="showSection('health')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 00-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 00-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 000-7.78z"/></svg>
      Health <span class="nav-badge" id="health-badge" style="display:none">0</span>
    </div>
    -->

    <!-- PANEL: travel -->
    <!--
    <div class="nav-item" data-section="travel" onclick="showSection('travel')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 16v-2l-8-5V3.5a1.5 1.5 0 00-3 0V9l-8 5v2l8-2.5V19l-2 1.5V22l3.5-1 3.5 1v-1.5L13 19v-5.5l8 2.5z"/></svg>
      Travel <span class="nav-badge" id="travel-badge" style="display:none">0</span>
    </div>
    -->

    <!-- PANEL: crm -->
    <!--
    <div class="nav-item" data-section="crm" onclick="showSection('crm')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M16 4h2a2 2 0 012 2v14a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2h2"/><rect x="8" y="2" width="8" height="4" rx="1"/><path d="M9 14l2 2 4-4"/></svg>
      Auto-CRM
    </div>
    -->

    <!-- PANEL: email-triage -->
    <!--
    <div class="nav-item" data-section="email-triage" onclick="showSection('email-triage')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22 6 12 13 2 6"/></svg>
      Email Triage
    </div>
    -->

    <!-- PANEL: outreach -->
    <!--
    <div class="nav-item" data-section="outreach" onclick="showSection('outreach')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>
      Outreach
    </div>
    -->

    <!-- PANEL: reports -->
    <!--
    <div class="nav-item" data-section="reports" onclick="showSection('reports')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>
      Reports
    </div>
    -->

  </div>
  <div class="sidebar-footer">
    <button class="btn-logout" onclick="logout()">‚Üê Logout</button>
  </div>
</nav>

<div class="main">

  <!-- PANEL: dashboard (CORE) -->
  <div class="section active" id="sec-dashboard">
    <h1 class="page-title">Dashboard</h1>
    <div class="clock" id="clock"></div>
    <!-- CUSTOMIZE: Update mission statement -->
    <div class="mission-statement">
      <h2>Mission</h2>
      <p>[Client mission statement goes here]</p>
      <span class="mission-target">üéØ [Primary goal and timeline]</span>
    </div>
    <div class="stats-grid" id="stats-grid">
      <div class="stat-card"><div class="label">In Progress</div><div class="value yellow" id="stat-progress">‚Äî</div></div>
      <div class="stat-card"><div class="label">Completed</div><div class="value green" id="stat-completed">‚Äî</div></div>
      <div class="stat-card"><div class="label">Waiting</div><div class="value blue" id="stat-waiting">‚Äî</div></div>
      <div class="stat-card"><div class="label">Active Agents</div><div class="value" id="stat-agents">1</div></div>
    </div>
  </div>

  <!-- PANEL: activity-feed (CORE) -->
  <div class="section" id="sec-activity">
    <h1 class="page-title">Activity Feed</h1>
    <p class="page-sub">Recent daily logs and updates</p>
    <div id="activity-feed"><div class="skeleton"></div><div class="skeleton"></div><div class="skeleton"></div></div>
  </div>

  <!-- PANEL: tasks (CORE) -->
  <div class="section" id="sec-tasks">
    <h1 class="page-title">Tasks</h1>
    <div class="filter-bar">
      <div class="search-wrap">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/></svg>
        <input type="text" class="search-input" id="task-search" placeholder="Search tasks..." oninput="renderTasks()">
      </div>
      <div id="task-filters" style="display:flex;gap:6px;flex-wrap:wrap"></div>
    </div>
    <div id="tasks-list"><div class="skeleton"></div><div class="skeleton"></div></div>
  </div>

  <!-- PANEL: meetings (CORE) -->
  <div class="section" id="sec-meetings"></div>

  <!-- PANEL: documents (CORE) -->
  <div class="section" id="sec-documents">
    <h1 class="page-title">Documents</h1>
    <div class="filter-bar">
      <div class="search-wrap">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/></svg>
        <input type="text" class="search-input" id="doc-search" placeholder="Search documents..." oninput="renderDocs()">
      </div>
    </div>
    <div id="docs-list"><div class="skeleton"></div><div class="skeleton"></div></div>
  </div>

  <!-- PANEL: agents (CORE) -->
  <div class="section" id="sec-agents">
    <h1 class="page-title">Agents</h1>
    <p class="page-sub">Your autonomous team</p>
    <div class="agents-grid" id="agents-grid"><div class="skeleton"></div></div>
  </div>

  <!-- PANEL: security (CORE) -->
  <div class="section" id="sec-security">
    <h1 class="page-title">Security Status</h1>
    <p class="page-sub">System security checks and audit results</p>
    <div id="security-feed"><div class="skeleton"></div></div>
  </div>

  <!-- PANEL: call-recordings (OPTIONAL ‚Äî uncomment nav item above to show) -->
  <!-- PANEL: call-recordings -->
  <div class="section" id="sec-calls">
    <h1 class="page-title">Call Recordings</h1>
    <p class="page-sub">Meeting recordings and call analyses</p>
    <div id="calls-content"><div class="skeleton"></div></div>
  </div>

  <!-- PANEL: opportunity-intel (OPTIONAL ‚Äî uncomment nav item above to show) -->
  <!-- PANEL: opportunity-intel -->
  <div class="section" id="sec-intel">
    <h1 class="page-title">Opportunity Intel</h1>
    <p class="page-sub">Latest opportunity scan results and market intelligence</p>
    <div id="intel-feed"><div class="skeleton"></div></div>
  </div>

  <!-- PANEL: health (OPTIONAL ‚Äî uncomment nav item above to show) -->
  <!-- PANEL: health -->
  <div class="section" id="sec-health">
    <h1 class="page-title">Health Dashboard</h1>
    <p class="page-sub">Recovery, readiness, and performance metrics</p>
    <div id="health-content">
      <div class="stats-grid" id="health-stats" style="display:none">
        <div class="stat-card"><div class="label">Sleep Score</div><div class="value" style="color:var(--purple)" id="health-sleep">‚Äî</div></div>
        <div class="stat-card"><div class="label">HRV</div><div class="value" style="color:var(--blue)" id="health-hrv">‚Äî</div></div>
        <div class="stat-card"><div class="label">Readiness</div><div class="value" style="color:var(--green)" id="health-readiness">‚Äî</div></div>
        <div class="stat-card"><div class="label">Steps</div><div class="value" style="color:var(--yellow)" id="health-steps">‚Äî</div></div>
      </div>
      <div id="health-empty"></div>
    </div>
  </div>

  <!-- PANEL: travel (OPTIONAL ‚Äî uncomment nav item above to show) -->
  <!-- PANEL: travel -->
  <div class="section" id="sec-travel">
    <h1 class="page-title">Travel</h1>
    <p class="page-sub">Upcoming trips, flights, hotels, and itineraries</p>
    <div id="travel-content"></div>
  </div>

  <!-- PANEL: crm (OPTIONAL ‚Äî uncomment nav item above to show) -->
  <!-- PANEL: crm -->
  <div class="section" id="sec-crm">
    <h1 class="page-title">Auto-CRM Updates</h1>
    <p class="page-sub">Automatically logged CRM entries from calls, emails, and meetings</p>
    <div id="crm-feed"><div class="skeleton"></div></div>
  </div>

  <!-- PANEL: email-triage (OPTIONAL ‚Äî uncomment nav item above to show) -->
  <!-- PANEL: email-triage -->
  <div class="section" id="sec-email-triage">
    <h1 class="page-title">Email Triage</h1>
    <p class="page-sub">Your inbox, intelligently sorted by urgency</p>
    <div id="email-triage-feed"><div class="skeleton"></div></div>
  </div>

  <!-- PANEL: outreach (OPTIONAL ‚Äî uncomment nav item above to show) -->
  <!-- PANEL: outreach -->
  <div class="section" id="sec-outreach">
    <h1 class="page-title">Automated Outreach Drafts</h1>
    <p class="page-sub">AI-written outreach ready for your review and approval</p>
    <div id="outreach-feed"><div class="skeleton"></div></div>
  </div>

  <!-- PANEL: reports (OPTIONAL ‚Äî uncomment nav item above to show) -->
  <!-- PANEL: reports -->
  <div class="section" id="sec-reports">
    <h1 class="page-title">Recurring PDF Reports</h1>
    <p class="page-sub">Auto-generated reports delivered to your stakeholders</p>
    <div id="reports-feed"><div class="skeleton"></div></div>
  </div>

</div>

<!-- FAB: New Task -->
<button class="fab" onclick="openNewTaskModal()" title="New Task">+</button>

<!-- Mobile Bottom Tabs -->
<div class="mobile-tabs">
  <div class="mobile-tabs-inner">
    <button class="mobile-tab active" data-section="dashboard" onclick="showSection('dashboard')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg>
      Home
    </button>
    <button class="mobile-tab" data-section="tasks" onclick="showSection('tasks')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 11l3 3L22 4"/><path d="M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11"/></svg>
      Tasks
    </button>
    <button class="mobile-tab" data-section="activity" onclick="showSection('activity')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
      Activity
    </button>
    <button class="mobile-tab" data-section="meetings" onclick="showSection('meetings')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
      Meetings
    </button>
    <button class="mobile-tab" data-section="agents" onclick="showSection('agents')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="8" r="4"/><path d="M20 21a8 8 0 10-16 0"/></svg>
      Agents
    </button>
  </div>
</div>

<!-- New Task Modal -->
<div class="modal-overlay" id="modal-new-task">
  <div class="modal">
    <h2>New Task</h2>
    <label>Task Name</label>
    <input type="text" id="new-task-name" placeholder="What needs to be done?">
    <label>Status</label>
    <select id="new-task-status">
      <option value="waiting">Waiting</option>
      <option value="in-progress">In Progress</option>
      <option value="completed">Completed</option>
    </select>
    <label>Assign To</label>
    <select id="new-task-assignee"><option value="">Unassigned</option></select>
    <label>Notes (optional)</label>
    <textarea id="new-task-notes" placeholder="Any additional context..."></textarea>
    <div class="modal-actions">
      <button class="modal-btn secondary" onclick="closeModal('modal-new-task')">Cancel</button>
      <button class="modal-btn primary" onclick="createTask()">Create Task</button>
    </div>
  </div>
</div>

<!-- Sync Footer -->
<div class="sync-footer" id="sync-footer">
  <span class="sync-dot fresh" id="sync-dot"></span>
  <span id="sync-text">Synced</span>
</div>

<!-- Toast -->
<div class="toast" id="toast"></div>

<script>
// ============================================================
// CUSTOMIZE: Update these values per client
// ============================================================

// Team members ‚Äî add agent + any human collaborators
// color: any CSS color or hex
const TEAM_MEMBERS = [
  { id: 'client', name: '[Client Name]', initials: 'CL', color: '#4080f0' },
  { id: 'agent',  name: '[Agent Name]',  initials: 'AG', color: '#40c080' },
];

// Telegram link for the client's agent bot
const COMMAND_CENTRE_URL = 'https://t.me/[AgentBotHandle]';

// SHA-256 hash of the dashboard password
// Generate: echo -n "yourpassword" | shasum -a 256
const HASH = 'REPLACE_WITH_SHA256_OF_PASSWORD';

// Local storage namespace (use client name, no spaces)
const STORAGE_NS = 'mc_[client]';

// ============================================================
// END CUSTOMIZE
// ============================================================

let allTasks = [];
let localTasks = [];
let localState = {};
let docsData = [];
let activeFilter = 'all';

/* AUTH */
async function sha256(s){const d=new TextEncoder().encode(s);const h=await crypto.subtle.digest('SHA-256',d);return Array.from(new Uint8Array(h)).map(b=>b.toString(16).padStart(2,'0')).join('')}
document.getElementById('pw').addEventListener('keydown',e=>{if(e.key==='Enter')tryLogin()});
async function tryLogin(){
  const pw=document.getElementById('pw').value;
  if(await sha256(pw)===HASH){
    localStorage.setItem(STORAGE_NS+'_auth','1');
    document.getElementById('login').classList.add('hidden');
    init();
  } else {
    document.getElementById('login-error').style.display='block';
  }
}
function logout(){localStorage.removeItem(STORAGE_NS+'_auth');location.reload()}

/* NAV */
function showSection(id){
  document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));
  document.querySelectorAll('.mobile-tab').forEach(t=>t.classList.remove('active'));
  document.getElementById('sec-'+id).classList.add('active');
  const nav=document.querySelector(`.nav-item[data-section="${id}"]`);if(nav)nav.classList.add('active');
  const tab=document.querySelector(`.mobile-tab[data-section="${id}"]`);if(tab)tab.classList.add('active');
  document.querySelector('.sidebar').classList.remove('open');
}

function updateClock(){
  const now=new Date();
  // CUSTOMIZE: Update timezone if needed
  const str=now.toLocaleString('en-US',{timeZone:'America/Halifax',weekday:'long',year:'numeric',month:'long',day:'numeric',hour:'2-digit',minute:'2-digit',second:'2-digit'});
  document.getElementById('clock').textContent=str+' (Atlantic)';
}

/* UTILS */
function esc(s){const d=document.createElement('div');d.textContent=s;return d.innerHTML}
function taskKey(t){return 'task:'+btoa(unescape(encodeURIComponent(t.name||t.title||t.task||''))).slice(0,40)}
function saveLocalState(){localStorage.setItem(STORAGE_NS+'_state',JSON.stringify(localState))}
function loadLocalState(){try{localState=JSON.parse(localStorage.getItem(STORAGE_NS+'_state')||'{}')}catch(e){localState={}}}
function saveLocalTasks(){localStorage.setItem(STORAGE_NS+'_tasks',JSON.stringify(localTasks))}
function loadLocalTasks(){try{localTasks=JSON.parse(localStorage.getItem(STORAGE_NS+'_tasks')||'[]')}catch(e){localTasks=[]}}
function toast(msg){const t=document.getElementById('toast');t.textContent=msg;t.classList.remove('show');void t.offsetWidth;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),2600)}
function avatarHTML(memberId,size){
  if(!memberId)return `<span class="avatar unassigned" style="${size?'width:'+size+'px;height:'+size+'px;font-size:'+(size*0.38)+'px':''}">?</span>`;
  const m=TEAM_MEMBERS.find(x=>x.id===memberId);
  if(!m)return `<span class="avatar unassigned">${esc(memberId[0].toUpperCase())}</span>`;
  return `<span class="avatar" style="background:${m.color};${size?'width:'+size+'px;height:'+size+'px;font-size:'+(size*0.38)+'px':''}">${m.initials}</span>`;
}
function emptyStateHTML(icon,title,desc){return `<div class="empty-state">${icon}<div class="empty-title">${title}</div><p>${desc}</p></div>`}
function closeModal(id){document.getElementById(id).classList.remove('open')}
function openModal(id){document.getElementById(id).classList.add('open')}
document.querySelectorAll('.modal-overlay').forEach(o=>{o.addEventListener('click',e=>{if(e.target===o)o.classList.remove('open')})});
document.addEventListener('keydown',e=>{if(e.key==='Escape')document.querySelectorAll('.modal-overlay.open').forEach(o=>o.classList.remove('open'))});
document.addEventListener('click',e=>{if(!e.target.closest('.assign-pos'))document.querySelectorAll('.assign-dropdown.open').forEach(d=>d.classList.remove('open'))});
async function loadJSON(path){try{const r=await fetch(path+'?_='+Date.now());if(!r.ok)return null;return r.json()}catch(e){return null}}

/* SYNC STATUS */
function updateSyncStatus(dashboardData){
  const ts=dashboardData?.lastSync||dashboardData?.timestamp;
  const dot=document.getElementById('sync-dot');const text=document.getElementById('sync-text');
  if(!ts){text.textContent='Sync status unknown';dot.className='sync-dot stale';return}
  const ago=Date.now()-new Date(ts).getTime();const mins=Math.floor(ago/60000);
  if(mins<10){dot.className='sync-dot fresh';text.textContent=`Synced ${mins<1?'just now':mins+'m ago'}`}
  else if(mins<60){dot.className='sync-dot stale';text.textContent=`‚ö† Data is ${mins}m old`}
  else{dot.className='sync-dot old';text.textContent=`‚ö† Data is ${Math.floor(mins/60)}h old ‚Äî may be stale`}
}

/* TASKS */
function buildFilterBar(){
  let html='<div style="padding:6px 14px;background:var(--surface);border:1px solid var(--border);border-radius:20px;color:var(--text2);font-size:12px;font-weight:600;cursor:pointer;user-select:none" class="filter-chip active" onclick="setFilter(\'all\',this)">All</div>';
  TEAM_MEMBERS.forEach(m=>{html+=`<div style="display:flex;align-items:center;gap:6px;padding:6px 14px;background:var(--surface);border:1px solid var(--border);border-radius:20px;color:var(--text2);font-size:12px;font-weight:600;cursor:pointer;user-select:none" class="filter-chip" onclick="setFilter('${m.id}',this)">${avatarHTML(m.id,16)} ${esc(m.name)}</div>`});
  document.getElementById('task-filters').innerHTML=html;
}
function setFilter(id,el){activeFilter=id;document.querySelectorAll('#task-filters .filter-chip').forEach(c=>{c.style.background='var(--surface)';c.style.color='var(--text2)'});if(el){el.style.background='var(--accent-light)';el.style.color='#fff'}renderTasks()}
function getMergedTasks(){return [...allTasks.map(t=>({...t,_key:taskKey(t),_local:false})),...localTasks.map(t=>({...t,_key:taskKey(t),_local:true}))]}
function renderTasks(){
  const search=(document.getElementById('task-search').value||'').toLowerCase();
  const tasks=getMergedTasks();
  const groups={inProgress:[],waiting:[],completed:[]};
  tasks.forEach(t=>{
    const st=localState[t._key];
    if(search&&!(t.name||t.title||t.task||'').toLowerCase().includes(search))return;
    const assignee=st?.assignee||t.assignee||'';
    if(activeFilter!=='all'&&assignee!==activeFilter)return;
    if(st?.done){groups.completed.push(t);return}
    const s=(t.status||'').toLowerCase();
    if(s.includes('progress'))groups.inProgress.push(t);
    else if(s.includes('complet')||s.includes('done'))groups.completed.push(t);
    else groups.waiting.push(t);
  });
  let html='';let idx=0;
  if(groups.inProgress.length){html+=`<div class="task-section-title">In Progress (${groups.inProgress.length})</div>`;groups.inProgress.forEach(t=>{html+=taskCardHTML(t,idx++)})}
  if(groups.waiting.length){html+=`<div class="task-section-title">Waiting (${groups.waiting.length})</div>`;groups.waiting.forEach(t=>{html+=taskCardHTML(t,idx++)})}
  if(groups.completed.length){html+=`<div class="task-section-title">Completed (${groups.completed.length})</div>`;groups.completed.forEach(t=>{html+=taskCardHTML(t,idx++)})}
  document.getElementById('tasks-list').innerHTML=html||emptyStateHTML(
    '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M9 11l3 3L22 4"/><path d="M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11"/></svg>',
    'No tasks found','Try adjusting your filters or create a new task with the + button');
  document.getElementById('tasks-badge').textContent=groups.inProgress.length+groups.waiting.length;
  document.getElementById('stat-progress').textContent=groups.inProgress.length;
  document.getElementById('stat-completed').textContent=groups.completed.length;
  document.getElementById('stat-waiting').textContent=groups.waiting.length;
}
function taskCardHTML(t,idx){
  const key=t._key;const st=localState[key]||{};const isDone=st.done;
  const assignee=st.assignee||t.assignee||'';const note=st.note||'';
  const name=t.name||t.title||t.task||'';const s=(t.status||'').toLowerCase();
  let badgeClass='waiting',badgeText='Waiting';
  if(isDone||s.includes('complet')||s.includes('done')){badgeClass='completed';badgeText='Completed'}
  else if(s.includes('progress')){badgeClass='in-progress';badgeText='In Progress'}
  const eKey=esc(key),eName=esc(name);
  return `<div class="task ${isDone?'completed-local':''}" style="animation-delay:${Math.min(idx*50,500)}ms">
    <div class="task-row">
      <span class="badge ${badgeClass}">${badgeText}</span>
      <span class="task-name">${eName}</span>
      <div class="task-actions">
        <button class="task-btn done" onclick="toggleDone('${eKey}')">‚úì</button>
        <button class="task-btn" onclick="toggleNote('${eKey}')" title="Note">üí¨</button>
        <div class="assign-pos">
          <span onclick="toggleAssign('${eKey}')">${avatarHTML(assignee)}</span>
          <div class="assign-dropdown" id="assign-${eKey}">
            <div class="assign-option" onclick="assignTask('${eKey}','')"><span class="avatar unassigned" style="width:22px;height:22px;font-size:9px">?</span> Unassigned</div>
            ${TEAM_MEMBERS.map(m=>`<div class="assign-option" onclick="assignTask('${eKey}','${m.id}')">${avatarHTML(m.id,22)} ${esc(m.name)}</div>`).join('')}
          </div>
        </div>
      </div>
    </div>
    ${note?`<div class="task-note">${esc(note)}</div>`:''}
    <textarea class="task-note-input" id="note-${eKey}" placeholder="Add a note..." onblur="saveNote('${eKey}',this)" onkeydown="if(event.key==='Enter'&&!event.shiftKey){event.preventDefault();this.blur()}">${esc(note)}</textarea>
  </div>`;
}
function toggleDone(key){if(!localState[key])localState[key]={};localState[key].done=!localState[key].done;saveLocalState();renderTasks();toast(localState[key].done?'Task marked complete ‚úì':'Task unmarked')}
function toggleNote(key){const el=document.getElementById('note-'+key);if(!el)return;const showing=el.style.display==='block';el.style.display=showing?'none':'block';if(!showing)el.focus()}
function saveNote(key,el){if(!localState[key])localState[key]={};localState[key].note=el.value.trim();saveLocalState();renderTasks()}
function toggleAssign(key){const dd=document.getElementById('assign-'+key);if(!dd)return;document.querySelectorAll('.assign-dropdown.open').forEach(d=>{if(d!==dd)d.classList.remove('open')});dd.classList.toggle('open')}
function assignTask(key,memberId){if(!localState[key])localState[key]={};localState[key].assignee=memberId;saveLocalState();renderTasks();toast(`Assigned to ${memberId?TEAM_MEMBERS.find(m=>m.id===memberId)?.name||memberId:'nobody'}`)}

/* NEW TASK */
function openNewTaskModal(){
  const sel=document.getElementById('new-task-assignee');
  sel.innerHTML='<option value="">Unassigned</option>';
  TEAM_MEMBERS.forEach(m=>{sel.innerHTML+=`<option value="${m.id}">${m.name}</option>`});
  document.getElementById('new-task-name').value='';
  document.getElementById('new-task-status').value='waiting';
  document.getElementById('new-task-notes').value='';
  openModal('modal-new-task');
  setTimeout(()=>document.getElementById('new-task-name').focus(),100);
}
function createTask(){
  const name=document.getElementById('new-task-name').value.trim();
  if(!name){toast('Task name required');return}
  const status=document.getElementById('new-task-status').value;
  const assignee=document.getElementById('new-task-assignee').value;
  const notes=document.getElementById('new-task-notes').value.trim();
  const task={name,status,assignee:assignee||''};
  localTasks.push(task);saveLocalTasks();
  const key=taskKey(task);
  if(assignee||notes){localState[key]={assignee,note:notes,done:status.includes('complet')};saveLocalState()}
  closeModal('modal-new-task');renderTasks();toast('Task created ‚úì');
}

/* DOCUMENTS */
function renderDocs(){
  const search=(document.getElementById('doc-search').value||'').toLowerCase();
  let html='',count=0;
  (docsData||[]).forEach(f=>{
    const files=(f.files||[]).filter(file=>{const n=typeof file==='string'?file:file.name||file.file||'';return!search||n.toLowerCase().includes(search)||(f.name||f.folder||'').toLowerCase().includes(search)});
    if(search&&!files.length&&!(f.name||f.folder||'').toLowerCase().includes(search))return;
    const id='doc-'+Math.random().toString(36).slice(2,8);count+=files.length;
    html+=`<div class="doc-folder"><div class="doc-folder-header" onclick="toggleFolder('${id}',this)"><span class="arrow">‚ñ∂</span> üìÅ ${esc(f.name||f.folder||'')} <span style="color:var(--text2);font-size:12px;margin-left:auto">${files.length} files</span></div><div class="doc-files" id="${id}">`;
    files.forEach(file=>{const n=typeof file==='string'?file:file.name||file.file||'';html+=`<div class="doc-file">üìÑ ${esc(n)}</div>`});
    html+='</div></div>';
  });
  document.getElementById('docs-list').innerHTML=html||emptyStateHTML(
    '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>',
    'No documents yet','Documents will appear here once synced from your workspace');
  document.getElementById('docs-badge').textContent=count;
}
function toggleFolder(id,el){el.classList.toggle('open');document.getElementById(id).classList.toggle('open')}

/* MEETINGS */
async function renderMeetings(){
  const data=await loadJSON('data/meetings.json');
  const meetings=data?.meetings||[];
  const now=new Date();const todayStr=now.toISOString().slice(0,10);
  const upcomingCount=meetings.filter(m=>new Date(m.datetime)>=now||m.datetime.slice(0,10)===todayStr).length;
  const badge=document.getElementById('meetings-badge');if(badge)badge.textContent=upcomingCount||'0';
  let html=`<h1 class="page-title">Meetings</h1><p class="page-sub">Upcoming meetings with AI-powered prep requests</p>`;
  if(!meetings.length){
    html+=emptyStateHTML('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>','No meetings synced yet','Connect your calendar to see upcoming meetings.');
  } else {
    const sorted=[...meetings].sort((a,b)=>new Date(a.datetime)-new Date(b.datetime));
    sorted.forEach((m,i)=>{
      const d=new Date(m.datetime);const mDate=m.datetime.slice(0,10);const isToday=mDate===todayStr;const isPast=d<now&&!isToday;
      const badgeClass=isToday?'today-badge':isPast?'past-badge':'upcoming-badge';const badgeText=isToday?'Today':isPast?'Past':'Upcoming';
      const timeStr=d.toLocaleString('en-US',{weekday:'short',month:'short',day:'numeric',hour:'numeric',minute:'2-digit'});
      const lsKey=`meeting_prep_${m.id}`;const localPrep=JSON.parse(localStorage.getItem(lsKey)||'[]');const allPrep=[...(m.prep||[]),...localPrep];
      html+=`<div class="meeting-card ${isToday?'today':''}${isPast?' past':''}" style="animation-delay:${i*0.06}s" onclick="this.classList.toggle('expanded')">
        <div style="display:flex;align-items:flex-start;justify-content:space-between;gap:12px">
          <div>
            <div class="meeting-title">${esc(m.title)}</div>
            <div class="meeting-meta"><span>üìÖ ${timeStr}</span><span>‚è± ${esc(m.duration)}</span>${m.location?`<span>üìç ${esc(m.location)}</span>`:''}</div>
            <div class="meeting-attendees">${(m.attendees||[]).map(a=>`<span class="meeting-attendee">${esc(a)}</span>`).join('')}</div>
          </div>
          <span class="meeting-badge ${badgeClass}">${badgeText}</span>
        </div>
        <div class="meeting-details">
          <div class="meeting-prep">
            <h4>Prep Requests</h4>
            <div id="prep-list-${m.id}">${allPrep.length?allPrep.map(p=>`<div class="prep-item"><span class="prep-dot ${p.status}"></span><div>${esc(p.request)}</div></div>`).join(''):'<div style="font-size:12px;color:var(--text2)">No prep requests yet</div>'}</div>
            <div class="prep-input-wrap">
              <input class="prep-input" id="prep-input-${m.id}" placeholder="Add a prep request..." onclick="event.stopPropagation()" onkeydown="if(event.key==='Enter'){event.stopPropagation();submitPrep('${m.id}')}">
              <button class="prep-submit" onclick="event.stopPropagation();submitPrep('${m.id}')">Submit</button>
            </div>
          </div>
        </div>
      </div>`;
    });
  }
  document.getElementById('sec-meetings').innerHTML=html;
}
function submitPrep(meetingId){const input=document.getElementById('prep-input-'+meetingId);if(!input||!input.value.trim())return;const req={request:input.value.trim(),status:'pending'};const lsKey=`meeting_prep_${meetingId}`;const existing=JSON.parse(localStorage.getItem(lsKey)||'[]');existing.push(req);localStorage.setItem(lsKey,JSON.stringify(existing));document.getElementById('prep-list-'+meetingId).innerHTML+=`<div class="prep-item"><span class="prep-dot pending"></span><div>${esc(req.request)}</div></div>`;input.value='';toast('Prep request submitted')}

/* SECURITY */
async function renderSecurity(){
  const sec=await loadJSON('data/security.json');
  if(sec){
    const status=sec.status||'ok';
    const badgeClass=status==='ok'?'ok':status==='warn'?'warn':'alert';
    const badgeText=status==='ok'?'All Clear':status==='warn'?'Warning':'Alert';
    let html=`<div class="security-card"><span class="security-status-badge ${badgeClass}">üõ° ${badgeText}</span>`;
    if(sec.lastCheck)html+=`<div style="font-size:12px;color:var(--text2);margin-bottom:12px">Last check: ${esc(sec.lastCheck)}</div>`;
    if(sec.details)html+=`<div style="font-size:14px;line-height:1.7">${marked.parse(sec.details)}</div>`;
    if(sec.checks&&Array.isArray(sec.checks)){html+='<div style="margin-top:12px">';sec.checks.forEach(c=>{html+=`<div style="padding:6px 0;font-size:13px;border-bottom:1px solid var(--border)">${c.pass?'‚úÖ':'‚ùå'} ${esc(c.name||'')} <span style="color:var(--text2);float:right">${esc(c.detail||'')}</span></div>`});html+='</div>';}
    html+='</div>';
    document.getElementById('security-feed').innerHTML=html;
  } else {
    document.getElementById('security-feed').innerHTML=emptyStateHTML(
      '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>',
      'No security data','Security checks will populate here when audits are run');
  }
}

/* INIT */
async function init(){
  loadLocalState();loadLocalTasks();buildFilterBar();updateClock();setInterval(updateClock,1000);

  // Dashboard sync status
  const dash=await loadJSON('data/dashboard.json');
  if(dash)updateSyncStatus(dash);

  // Tasks
  const tasks=await loadJSON('data/tasks.json');
  if(tasks)allTasks=tasks.tasks||tasks||[];
  renderTasks();

  // Meetings
  try{await renderMeetings()}catch(e){console.error('Meetings error:',e)}

  // Activity Feed
  try{
    const mem=await loadJSON('data/memory-recent.json');
    if(mem){
      const entries=mem.entries||mem;
      let html='';
      (Array.isArray(entries)?entries:[]).forEach(e=>{html+=`<div class="feed-item"><div class="feed-date">${esc(e.date||e.file||'')}</div><div class="feed-content">${marked.parse(e.content||e.text||'')}</div></div>`});
      document.getElementById('activity-feed').innerHTML=html||emptyStateHTML(
        '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>',
        'No recent activity','Activity will appear here as your agent logs daily updates');
    } else {
      document.getElementById('activity-feed').innerHTML=emptyStateHTML(
        '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>',
        'No activity data','Run a sync to populate the activity feed');
    }
  }catch(e){console.error('Activity error:',e)}

  // Documents
  try{
    const docs=await loadJSON('data/documents.json');
    if(docs){docsData=docs.folders||(docs.documents?[{name:'Documents',files:docs.documents.map(d=>({name:(d.title||d.name||'Untitled')+(d.type?'.'+d.type:'')}))}]:Array.isArray(docs)?docs:[]);renderDocs()}
    else renderDocs();
  }catch(e){console.error('Docs error:',e)}

  // Agents
  try{
    const agents=await loadJSON('data/agents.json');
    if(agents){
      let html='';
      (agents.agents||agents||[]).forEach(a=>{
        html+=`<div class="agent-card"><span class="agent-status ${(a.status||'active')==='active'?'active':'standby'}">${esc(a.status||'active')}</span><div class="agent-name">${esc(a.name||'')}</div><div class="agent-role">${esc(a.role||'')}</div><div class="agent-desc">${esc(a.description||a.desc||'')}</div></div>`;
      });
      document.getElementById('agents-grid').innerHTML=html;
      document.getElementById('stat-agents').textContent=(agents.agents||agents||[]).length;
    }
  }catch(e){console.error('Agents error:',e)}

  // Security
  try{await renderSecurity()}catch(e){console.error('Security error:',e)}

  // OPTIONAL PANELS ‚Äî each loads if the section exists
  // Calls
  try{
    const calls=await loadJSON('data/call-analyses.json');
    const el=document.getElementById('calls-content');if(!el)return;
    if(calls){const analyses=calls.analyses||calls||[];document.getElementById('calls-badge')?.textContent&&(document.getElementById('calls-badge').textContent=analyses.length||'');let html='';analyses.forEach((a,i)=>{html+=`<div class="feed-item"><div class="feed-date">üìû ${esc(a.contact||'')} ‚Äî ${esc(a.date||'')}</div><div class="feed-content">${(a.takeaways||[]).map(t=>`‚Ä¢ ${esc(t)}`).join('<br>')}</div></div>`});el.innerHTML=html||emptyStateHTML('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07 19.5 19.5 0 01-6-6 19.79 19.79 0 01-3.07-8.67A2 2 0 014.11 2h3a2 2 0 012 1.72 12.84 12.84 0 00.7 2.81 2 2 0 01-.45 2.11L8.09 9.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45 12.84 12.84 0 002.81.7A2 2 0 0122 16.92z"/></svg>','No call analyses yet','Send a recording or transcript to your agent via Telegram');}
  }catch(e){console.error('Calls error:',e)}

  // Intel
  try{
    const intel=await loadJSON('data/opportunity-intel.json');
    const el=document.getElementById('intel-feed');if(!el)return;
    if(intel){const items=intel.items||intel.opportunities||[];let html='';if(Array.isArray(items)&&items.length){items.forEach(i=>{html+=`<div class="feed-item"><div class="feed-date">${esc(i.title||'')}</div><div class="feed-content">${marked.parse(i.detail||i.content||i.summary||'')}</div></div>`});}else if(intel.content||intel.summary){html=`<div class="feed-item"><div class="feed-date">${esc(intel.date||'')}</div><div class="feed-content">${marked.parse(intel.content||intel.summary||'')}</div></div>`;}el.innerHTML=html||emptyStateHTML('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>','No opportunities found','Intel will populate here when opportunity scans are run');}
  }catch(e){console.error('Intel error:',e)}

  // Health
  try{
    const health=await loadJSON('data/health.json');
    const emptyEl=document.getElementById('health-empty');if(!emptyEl)return;
    if(health&&Object.keys(health).length>0){
      document.getElementById('health-stats').style.display='';
      if(health.sleep!==undefined)document.getElementById('health-sleep').textContent=health.sleep;
      if(health.hrv!==undefined)document.getElementById('health-hrv').textContent=health.hrv;
      if(health.readiness!==undefined)document.getElementById('health-readiness').textContent=health.readiness;
      if(health.steps!==undefined)document.getElementById('health-steps').textContent=(health.steps||0).toLocaleString();
    } else {
      emptyEl.innerHTML=emptyStateHTML('<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M20.84 4.61a5.5 5.5 0 00-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 00-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 000-7.78z"/></svg>','Health Tracking Not Active','Connect your Oura Ring, Apple Health, or Whoop to see metrics here.');
    }
  }catch(e){console.error('Health error:',e)}
}

if(localStorage.getItem(STORAGE_NS+'_auth')==='1'){document.getElementById('login').classList.add('hidden');init()}
</script>
</body>
</html>
